-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE OR REPLACE TEMPORARY VIEW basic_data AS SELECT * FROM VALUES
  ('Alice', 85),
  ('Bob', 92),
  ('Carol', 78),
  ('Dave', 95),
  ('Eve', 88)
AS basic_data(name, score)
-- !query schema
struct<>
-- !query output



-- !query
SELECT max_by(name, score, 3) FROM basic_data
-- !query schema
struct<max_by(name, score, 3):array<string>>
-- !query output
["Dave","Bob","Eve"]


-- !query
SELECT min_by(name, score, 3) FROM basic_data
-- !query schema
struct<min_by(name, score, 3):array<string>>
-- !query output
["Carol","Alice","Eve"]


-- !query
SELECT max_by(name, score, 1) FROM basic_data
-- !query schema
struct<max_by(name, score, 1):array<string>>
-- !query output
["Dave"]


-- !query
SELECT min_by(name, score, 1) FROM basic_data
-- !query schema
struct<min_by(name, score, 1):array<string>>
-- !query output
["Carol"]


-- !query
SELECT max_by(name, score, 10) FROM basic_data
-- !query schema
struct<max_by(name, score, 10):array<string>>
-- !query output
["Dave","Bob","Eve","Alice","Carol"]


-- !query
SELECT min_by(name, score, 10) FROM basic_data
-- !query schema
struct<min_by(name, score, 10):array<string>>
-- !query output
["Carol","Alice","Eve","Bob","Dave"]


-- !query
CREATE OR REPLACE TEMPORARY VIEW dept_data AS SELECT * FROM VALUES
  ('Eng', 'Alice', 120000),
  ('Eng', 'Bob', 95000),
  ('Eng', 'Carol', 110000),
  ('Sales', 'Dave', 80000),
  ('Sales', 'Eve', 75000),
  ('Sales', 'Frank', 85000)
AS dept_data(dept, emp, salary)
-- !query schema
struct<>
-- !query output



-- !query
SELECT dept, max_by(emp, salary, 2) FROM dept_data GROUP BY dept ORDER BY dept
-- !query schema
struct<dept:string,max_by(emp, salary, 2):array<string>>
-- !query output
Eng	["Alice","Carol"]
Sales	["Frank","Dave"]


-- !query
SELECT dept, min_by(emp, salary, 2) FROM dept_data GROUP BY dept ORDER BY dept
-- !query schema
struct<dept:string,min_by(emp, salary, 2):array<string>>
-- !query output
Eng	["Bob","Carol"]
Sales	["Eve","Dave"]


-- !query
CREATE OR REPLACE TEMPORARY VIEW null_data AS SELECT * FROM VALUES
  ('a', 10),
  ('b', NULL),
  ('c', 30),
  ('d', 20)
AS null_data(x, y)
-- !query schema
struct<>
-- !query output



-- !query
SELECT max_by(x, y, 2) FROM null_data
-- !query schema
struct<max_by(x, y, 2):array<string>>
-- !query output
["c","d"]


-- !query
SELECT min_by(x, y, 2) FROM null_data
-- !query schema
struct<min_by(x, y, 2):array<string>>
-- !query output
["a","d"]


-- !query
CREATE OR REPLACE TEMPORARY VIEW null_value_data AS SELECT * FROM VALUES
  (NULL, 10),
  ('b', 20),
  ('c', 30)
AS null_value_data(x, y)
-- !query schema
struct<>
-- !query output



-- !query
SELECT max_by(x, y, 2) FROM null_value_data
-- !query schema
struct<max_by(x, y, 2):array<string>>
-- !query output
["c","b"]


-- !query
SELECT min_by(x, y, 2) FROM null_value_data
-- !query schema
struct<min_by(x, y, 2):array<string>>
-- !query output
[null,"b"]


-- !query
CREATE OR REPLACE TEMPORARY VIEW typed_data AS SELECT * FROM VALUES
  ('a', 1.5),
  ('b', 2.5),
  ('c', 0.5)
AS typed_data(name, score)
-- !query schema
struct<>
-- !query output



-- !query
SELECT max_by(name, score, 2) FROM typed_data
-- !query schema
struct<max_by(name, score, 2):array<string>>
-- !query output
["b","a"]


-- !query
SELECT min_by(name, score, 2) FROM typed_data
-- !query schema
struct<min_by(name, score, 2):array<string>>
-- !query output
["c","a"]


-- !query
CREATE OR REPLACE TEMPORARY VIEW date_data AS SELECT * FROM VALUES
  ('event1', DATE '2024-01-15'),
  ('event2', DATE '2024-03-20'),
  ('event3', DATE '2024-02-10')
AS date_data(event, event_date)
-- !query schema
struct<>
-- !query output



-- !query
SELECT max_by(event, event_date, 2) FROM date_data
-- !query schema
struct<max_by(event, event_date, 2):array<string>>
-- !query output
["event2","event3"]


-- !query
SELECT min_by(event, event_date, 2) FROM date_data
-- !query schema
struct<min_by(event, event_date, 2):array<string>>
-- !query output
["event1","event3"]


-- !query
SELECT dept, emp, salary,
       max_by(emp, salary, 2) OVER (PARTITION BY dept) as top2,
       min_by(emp, salary, 2) OVER (PARTITION BY dept) as bottom2
FROM dept_data
ORDER BY dept, emp
-- !query schema
struct<dept:string,emp:string,salary:int,top2:array<string>,bottom2:array<string>>
-- !query output
Eng	Alice	120000	["Alice","Carol"]	["Bob","Carol"]
Eng	Bob	95000	["Alice","Carol"]	["Bob","Carol"]
Eng	Carol	110000	["Alice","Carol"]	["Bob","Carol"]
Sales	Dave	80000	["Frank","Dave"]	["Eve","Dave"]
Sales	Eve	75000	["Frank","Dave"]	["Eve","Dave"]
Sales	Frank	85000	["Frank","Dave"]	["Eve","Dave"]


-- !query
SELECT max_by(name, score, 0) FROM basic_data
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.VALUE_OUT_OF_RANGE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "currentValue" : "0",
    "exprName" : "`k`",
    "sqlExpr" : "\"max_by(name, score, 0)\"",
    "valueRange" : "[1, 100000]"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 29,
    "fragment" : "max_by(name, score, 0)"
  } ]
}


-- !query
SELECT max_by(name, score, -1) FROM basic_data
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.VALUE_OUT_OF_RANGE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "currentValue" : "-1",
    "exprName" : "`k`",
    "sqlExpr" : "\"max_by(name, score, -1)\"",
    "valueRange" : "[1, 100000]"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 30,
    "fragment" : "max_by(name, score, -1)"
  } ]
}


-- !query
SELECT max_by(name, score, 100001) FROM basic_data
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.VALUE_OUT_OF_RANGE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "currentValue" : "100001",
    "exprName" : "`k`",
    "sqlExpr" : "\"max_by(name, score, 100001)\"",
    "valueRange" : "[1, 100000]"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 34,
    "fragment" : "max_by(name, score, 100001)"
  } ]
}


-- !query
DROP VIEW basic_data
-- !query schema
struct<>
-- !query output



-- !query
DROP VIEW dept_data
-- !query schema
struct<>
-- !query output



-- !query
DROP VIEW null_data
-- !query schema
struct<>
-- !query output



-- !query
DROP VIEW null_value_data
-- !query schema
struct<>
-- !query output



-- !query
DROP VIEW typed_data
-- !query schema
struct<>
-- !query output



-- !query
DROP VIEW date_data
-- !query schema
struct<>
-- !query output

