-- Automatically generated by SQLQueryTestSuite
-- !query
SELECT vector_sum(col) FROM VALUES (array(1.0F, 2.0F, 3.0F)), (array(4.0F, 5.0F, 6.0F)) AS tab(col)
-- !query schema
struct<vector_sum(col):array<float>>
-- !query output
[5.0,7.0,9.0]


-- !query
SELECT vector_avg(col) FROM VALUES (array(1.0F, 2.0F, 3.0F)), (array(3.0F, 4.0F, 5.0F)) AS tab(col)
-- !query schema
struct<vector_avg(col):array<float>>
-- !query output
[2.0,3.0,4.0]


-- !query
SELECT category, vector_sum(embedding) AS sum_vector
FROM VALUES
    ('A', array(1.0F, 2.0F, 3.0F)),
    ('A', array(4.0F, 5.0F, 6.0F)),
    ('B', array(2.0F, 1.0F, 4.0F)),
    ('B', array(3.0F, 2.0F, 1.0F))
AS tab(category, embedding)
GROUP BY category
ORDER BY category
-- !query schema
struct<category:string,sum_vector:array<float>>
-- !query output
A	[5.0,7.0,9.0]
B	[5.0,3.0,5.0]


-- !query
SELECT category, vector_avg(embedding) AS avg_vector
FROM VALUES
    ('A', array(2.0F, 4.0F, 6.0F)),
    ('A', array(4.0F, 8.0F, 12.0F)),
    ('B', array(1.0F, 2.0F, 3.0F)),
    ('B', array(3.0F, 6.0F, 9.0F))
AS tab(category, embedding)
GROUP BY category
ORDER BY category
-- !query schema
struct<category:string,avg_vector:array<float>>
-- !query output
A	[3.0,6.0,9.0]
B	[2.0,4.0,6.0]


-- !query
SELECT vector_sum(col) FROM VALUES
    (array(1.0F, 2.0F)),
    (CAST(NULL AS ARRAY<FLOAT>)),
    (array(3.0F, 4.0F)) AS tab(col)
-- !query schema
struct<vector_sum(col):array<float>>
-- !query output
[4.0,6.0]


-- !query
SELECT vector_avg(col) FROM VALUES
    (array(1.0F, 2.0F)),
    (CAST(NULL AS ARRAY<FLOAT>)),
    (array(3.0F, 4.0F)) AS tab(col)
-- !query schema
struct<vector_avg(col):array<float>>
-- !query output
[2.0,3.0]


-- !query
SELECT vector_sum(col) FROM VALUES
    (CAST(NULL AS ARRAY<FLOAT>)),
    (CAST(NULL AS ARRAY<FLOAT>)) AS tab(col)
-- !query schema
struct<vector_sum(col):array<float>>
-- !query output
NULL


-- !query
SELECT vector_sum(col) FROM VALUES
    (CAST(array() AS ARRAY<FLOAT>)),
    (CAST(array() AS ARRAY<FLOAT>)) AS tab(col)
-- !query schema
struct<vector_sum(col):array<float>>
-- !query output
[]


-- !query
SELECT key, vector_sum(vec) OVER (PARTITION BY grp) as sum_vec
FROM VALUES
    ('a', 'g1', array(1.0F, 2.0F)),
    ('b', 'g1', array(3.0F, 4.0F)),
    ('c', 'g2', array(5.0F, 6.0F))
AS tab(key, grp, vec)
ORDER BY key
-- !query schema
struct<key:string,sum_vec:array<float>>
-- !query output
a	[4.0,6.0]
b	[4.0,6.0]
c	[5.0,6.0]


-- !query
SELECT key, vector_avg(vec) OVER (PARTITION BY grp) as avg_vec
FROM VALUES
    ('a', 'g1', array(1.0F, 2.0F)),
    ('b', 'g1', array(3.0F, 4.0F)),
    ('c', 'g2', array(5.0F, 6.0F))
AS tab(key, grp, vec)
ORDER BY key
-- !query schema
struct<key:string,avg_vec:array<float>>
-- !query output
a	[2.0,3.0]
b	[2.0,3.0]
c	[5.0,6.0]


-- !query
SELECT vector_sum(col) FROM VALUES
    (array(1.0F, 2.0F, 3.0F)),
    (array(1.0F, 2.0F)) AS tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "VECTOR_DIMENSION_MISMATCH",
  "sqlState" : "22000",
  "messageParameters" : {
    "functionName" : "`vector_sum`",
    "leftDim" : "3",
    "rightDim" : "2"
  }
}


-- !query
SELECT vector_avg(col) FROM VALUES
    (array(1.0F, 2.0F, 3.0F)),
    (array(1.0F, 2.0F)) AS tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "VECTOR_DIMENSION_MISMATCH",
  "sqlState" : "22000",
  "messageParameters" : {
    "functionName" : "`vector_avg`",
    "leftDim" : "3",
    "rightDim" : "2"
  }
}


-- !query
SELECT vector_sum(col) FROM VALUES (array(1.0D, 2.0D)), (array(3.0D, 4.0D)) AS tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col\"",
    "inputType" : "\"ARRAY<DOUBLE>\"",
    "paramIndex" : "first",
    "requiredType" : "\"ARRAY<FLOAT>\"",
    "sqlExpr" : "\"vector_sum(col)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 22,
    "fragment" : "vector_sum(col)"
  } ]
}


-- !query
SELECT vector_avg(col) FROM VALUES (array(1, 2)), (array(3, 4)) AS tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col\"",
    "inputType" : "\"ARRAY<INT>\"",
    "paramIndex" : "first",
    "requiredType" : "\"ARRAY<FLOAT>\"",
    "sqlExpr" : "\"vector_avg(col)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 22,
    "fragment" : "vector_avg(col)"
  } ]
}


-- !query
SELECT vector_sum(col) FROM VALUES ('not an array'), ('also not an array') AS tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "first",
    "requiredType" : "\"ARRAY<FLOAT>\"",
    "sqlExpr" : "\"vector_sum(col)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 22,
    "fragment" : "vector_sum(col)"
  } ]
}


-- !query
SELECT vector_avg(col) FROM VALUES (1.0F), (2.0F) AS tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col\"",
    "inputType" : "\"FLOAT\"",
    "paramIndex" : "first",
    "requiredType" : "\"ARRAY<FLOAT>\"",
    "sqlExpr" : "\"vector_avg(col)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 22,
    "fragment" : "vector_avg(col)"
  } ]
}
