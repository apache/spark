-- Automatically generated by SQLQueryTestSuite
-- !query
create temporary view hav as select * from values
  ("one", 1),
  ("two", 2),
  ("three", 3),
  ("one", 5)
  as hav(k, v)
-- !query schema
struct<>
-- !query output



-- !query
SELECT k, sum(v) FROM hav GROUP BY k HAVING sum(v) > 2
-- !query schema
struct<k:string,sum(v):bigint>
-- !query output
one	6
three	3


-- !query
SELECT count(k) FROM hav GROUP BY v + 1 HAVING v + 1 = 2
-- !query schema
struct<count(k):bigint>
-- !query output
1


-- !query
SELECT count(k) FROM hav GROUP BY v HAVING v = array(1)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.BINARY_OP_DIFF_TYPES",
  "sqlState" : "42K09",
  "messageParameters" : {
    "left" : "\"INT\"",
    "right" : "\"ARRAY<INT>\"",
    "sqlExpr" : "\"(v = array(1))\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 44,
    "stopIndex" : 55,
    "fragment" : "v = array(1)"
  } ]
}


-- !query
SELECT MIN(t.v) FROM (SELECT * FROM hav WHERE v > 0) t HAVING(COUNT(1) > 0)
-- !query schema
struct<min(v):int>
-- !query output
1


-- !query
SELECT a + b FROM VALUES (1L, 2), (3L, 4) AS T(a, b) GROUP BY a + b HAVING a + b > 1
-- !query schema
struct<(a + b):bigint>
-- !query output
3
7


-- !query
SELECT SUM(a) AS b, CAST('2020-01-01' AS DATE) AS fake FROM VALUES (1, 10), (2, 20) AS T(a, b) GROUP BY b HAVING b > 10
-- !query schema
struct<b:bigint,fake:date>
-- !query output
2	2020-01-01


-- !query
SELECT SUM(a) AS b FROM VALUES (1, 10), (2, 20) AS T(a, b) GROUP BY GROUPING SETS ((b), (a, b)) HAVING b > 10
-- !query schema
struct<b:bigint>
-- !query output
2
2


-- !query
SELECT SUM(a) AS b FROM VALUES (1, 10), (2, 20) AS T(a, b) GROUP BY CUBE(a, b) HAVING b > 10
-- !query schema
struct<b:bigint>
-- !query output
2
2


-- !query
SELECT SUM(a) AS b FROM VALUES (1, 10), (2, 20) AS T(a, b) GROUP BY ROLLUP(a, b) HAVING b > 10
-- !query schema
struct<b:bigint>
-- !query output
2


-- !query
SELECT c1 FROM VALUES (1, 2) as t(c1, c2) GROUP BY GROUPING SETS(t.c1) HAVING t.c1 = 1
-- !query schema
struct<c1:int>
-- !query output
1


-- !query
SELECT c1 FROM VALUES (1, 2) as t(c1, c2) GROUP BY CUBE(t.c1) HAVING t.c1 = 1
-- !query schema
struct<c1:int>
-- !query output
1


-- !query
SELECT c1 FROM VALUES (1, 2) as t(c1, c2) GROUP BY ROLLUP(t.c1) HAVING t.c1 = 1
-- !query schema
struct<c1:int>
-- !query output
1


-- !query
SELECT c1 FROM VALUES (1, 2) as t(c1, c2) GROUP BY t.c1 HAVING t.c1 = 1
-- !query schema
struct<c1:int>
-- !query output
1


-- !query
SELECT k, sum(v) FROM hav GROUP BY k HAVING sum(v) > 2 ORDER BY sum(v)
-- !query schema
struct<k:string,sum(v):bigint>
-- !query output
three	3
one	6


-- !query
SELECT k, sum(v) FROM hav GROUP BY k HAVING sum(v) > 2 ORDER BY avg(v)
-- !query schema
struct<k:string,sum(v):bigint>
-- !query output
one	6
three	3


-- !query
SELECT sum(v) FROM hav HAVING avg(try_add(v, 1)) = 1
-- !query schema
struct<sum(v):bigint>
-- !query output



-- !query
SELECT sum(v) FROM hav HAVING sum(try_add(v, 1)) = 1
-- !query schema
struct<sum(v):bigint>
-- !query output



-- !query
SELECT sum(v) FROM hav HAVING sum(ifnull(v, 1)) = 1
-- !query schema
struct<sum(v):bigint>
-- !query output



-- !query
SELECT sum(v) FROM hav GROUP BY ALL HAVING sum(ifnull(v, 1)) = 1
-- !query schema
struct<sum(v):bigint>
-- !query output



-- !query
SELECT sum(v) FROM hav GROUP BY v HAVING sum(ifnull(v, 1)) = 1
-- !query schema
struct<sum(v):bigint>
-- !query output
1


-- !query
SELECT v + 1 FROM hav GROUP BY ALL HAVING avg(try_add(v, 1)) = 1
-- !query schema
struct<(v + 1):int>
-- !query output



-- !query
SELECT v + 1 FROM hav GROUP BY ALL HAVING avg(try_add(v, 1) + 1) = 1
-- !query schema
struct<(v + 1):int>
-- !query output



-- !query
SELECT sum(v) FROM hav GROUP BY ifnull(v, 1) + 1 order by ifnull(v, 1) + 1
-- !query schema
struct<sum(v):bigint>
-- !query output
1
2
3
5


-- !query
SELECT 1 AS `2`, 2 FROM VALUES (2) t (`2`) GROUP BY `2` HAVING `2` > 2
-- !query schema
struct<2:int,2:int>
-- !query output



-- !query
SELECT 2, 1 AS `2` FROM VALUES (2) t (`2`) GROUP BY `2` HAVING `2` > 2
-- !query schema
struct<2:int,2:int>
-- !query output



-- !query
SELECT 1 AS `2` FROM VALUES (2) t (`2`) GROUP BY `2` HAVING `2` > 2
-- !query schema
struct<2:int>
-- !query output



-- !query
SELECT 2 FROM VALUES (2) t (`2`) GROUP BY `2` HAVING `2` > 2
-- !query schema
struct<2:int>
-- !query output



-- !query
SELECT SUM(v) + 1 FROM hav HAVING SUM(v) + 1
-- !query schema
struct<(sum(v) + 1):bigint>
-- !query output
12


-- !query
SELECT 1 + SUM(v) FROM hav HAVING SUM(v) + 1
-- !query schema
struct<(1 + sum(v)):bigint>
-- !query output
12


-- !query
SELECT SUM(v) + 1 FROM hav HAVING 1 + SUM(v)
-- !query schema
struct<(sum(v) + 1):bigint>
-- !query output
12


-- !query
SELECT MAX(v) + SUM(v) FROM hav HAVING SUM(v) + MAX(v)
-- !query schema
struct<(max(v) + sum(v)):bigint>
-- !query output
16


-- !query
SELECT SUM(v) + 1 + MIN(v) FROM hav HAVING 1 + 1 + 1 + MIN(v) + 1 + SUM(v)
-- !query schema
struct<((sum(v) + 1) + min(v)):bigint>
-- !query output
13


-- !query
SELECT col1 AS alias
FROM values(1)
GROUP BY col1
HAVING (
    SELECT col1 = 1
)
-- !query schema
struct<alias:int>
-- !query output
1


-- !query
SELECT col1 AS alias
FROM values(named_struct('a', 1))
GROUP BY col1
HAVING (
    SELECT col1.a = 1
)
-- !query schema
struct<alias:struct<a:int>>
-- !query output
{"a":1}


-- !query
SELECT col1 AS alias
FROM values(array(1))
GROUP BY col1
HAVING (
    SELECT col1[0] = 1
)
-- !query schema
struct<alias:array<int>>
-- !query output
[1]


-- !query
SELECT col1 AS alias
FROM values(map('a', 1))
GROUP BY col1
HAVING (
    SELECT col1[0] = 1
)
-- !query schema
struct<alias:map<string,int>>
-- !query output

