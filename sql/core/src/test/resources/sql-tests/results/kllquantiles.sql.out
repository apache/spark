-- Automatically generated by SQLQueryTestSuite
-- !query
DROP TABLE IF EXISTS t_int_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_int_1_5_through_7_11 AS
VALUES 
  (1, 5), (2, 6), (3, 7), (4, 8), (5, 9), (6, 10), (7, 11) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_long_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_long_1_5_through_7_11 AS
VALUES
  (1L, 5L), (2L, 6L), (3L, 7L), (4L, 8L), (5L, 9L), (6L, 10L), (7L, 11L) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_short_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_short_1_5_through_7_11 AS
VALUES
    (CAST(1 AS SMALLINT), CAST(5 AS SMALLINT)),
    (CAST(2 AS SMALLINT), CAST(6 AS SMALLINT)),
    (CAST(3 AS SMALLINT), CAST(7 AS SMALLINT)),
    (CAST(4 AS SMALLINT), CAST(8 AS SMALLINT)),
    (CAST(5 AS SMALLINT), CAST(9 AS SMALLINT)),
    (CAST(6 AS SMALLINT), CAST(10 AS SMALLINT)),
    (CAST(7 AS SMALLINT), CAST(11 AS SMALLINT))
    AS tab(col1, col2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_byte_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_byte_1_5_through_7_11 AS
VALUES
    (CAST(1 AS TINYINT), CAST(5 AS TINYINT)),
    (CAST(2 AS TINYINT), CAST(6 AS TINYINT)),
    (CAST(3 AS TINYINT), CAST(7 AS TINYINT)),
    (CAST(4 AS TINYINT), CAST(8 AS TINYINT)),
    (CAST(5 AS TINYINT), CAST(9 AS TINYINT)),
    (CAST(6 AS TINYINT), CAST(10 AS TINYINT)),
    (CAST(7 AS TINYINT), CAST(11 AS TINYINT))
    AS tab(col1, col2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_float_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_float_1_5_through_7_11 AS
VALUES
    (CAST(1 AS FLOAT), CAST(5 AS FLOAT)),
    (CAST(2 AS FLOAT), CAST(6 AS FLOAT)),
    (CAST(3 AS FLOAT), CAST(7 AS FLOAT)),
    (CAST(4 AS FLOAT), CAST(8 AS FLOAT)),
    (CAST(5 AS FLOAT), CAST(9 AS FLOAT)),
    (CAST(6 AS FLOAT), CAST(10 AS FLOAT)),
    (CAST(7 AS FLOAT), CAST(11 AS FLOAT)) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_double_1_5_through_7_11 AS
VALUES
    (CAST(1 AS DOUBLE), CAST(5 AS DOUBLE)),
    (CAST(2 AS DOUBLE), CAST(6 AS DOUBLE)),
    (CAST(3 AS DOUBLE), CAST(7 AS DOUBLE)),
    (CAST(4 AS DOUBLE), CAST(8 AS DOUBLE)),
    (CAST(5 AS DOUBLE), CAST(9 AS DOUBLE)),
    (CAST(6 AS DOUBLE), CAST(10 AS DOUBLE)),
    (CAST(7 AS DOUBLE), CAST(11 AS DOUBLE)) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output



-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_byte_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_int_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_short_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_float(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_float(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_float(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_byte_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_float(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_float(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_float(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_float(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_float(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_float(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_int_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_float(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_float(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_float(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_float(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_float(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_float(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_short_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_double(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_double(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_double(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_byte_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_double(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_double(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_double(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_double(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_double(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_double(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_double(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_double(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_double(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_int_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_double(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_double(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_double(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT split(kll_sketch_to_string_double(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_double(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_double(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_short_1_5_through_7_11
)
-- !query schema
struct<str_contains_kll:boolean,median_close_to_4:boolean,rank3_close_to_0_4:boolean>
-- !query output
true	true	true


-- !query
SELECT
  split(
    kll_sketch_to_string_bigint(
      kll_sketch_merge_bigint(
        kll_sketch_agg_bigint(col1),
        kll_sketch_agg_bigint(col1)
      )
    ),
    '\n'
  )[1] AS result
  FROM t_byte_1_5_through_7_11
-- !query schema
struct<result:string>
-- !query output
### KllDirectCompactKllLongsSketch Summary:


-- !query
SELECT
  split(
    kll_sketch_to_string_float(
      kll_sketch_merge_float(
        kll_sketch_agg_float(col1),
        kll_sketch_agg_float(col1)
      )
    ),
    '\n'
  )[1] AS result
FROM t_byte_1_5_through_7_11
-- !query schema
struct<result:string>
-- !query output
### KllDirectCompactKllFloatsSketch Summary:


-- !query
SELECT
  split(
    kll_sketch_to_string_double(
      kll_sketch_merge_double(
        kll_sketch_agg_double(col1),
        kll_sketch_agg_double(col1)
      )
    ),
    '\n'
  )[1] AS result
FROM t_byte_1_5_through_7_11
-- !query schema
struct<result:string>
-- !query output
### KllDirectCompactKllDoublesSketch Summary:


-- !query
SELECT abs(kll_sketch_get_quantile_bigint(agg_with_nulls, 0.5) - 
           kll_sketch_get_quantile_bigint(agg_without_nulls, 0.5)) < 1 AS medians_match,
       abs(kll_sketch_get_rank_bigint(agg_with_nulls, 4) - 
           kll_sketch_get_rank_bigint(agg_without_nulls, 4)) < 0.1 AS ranks_match
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg_with_nulls
    FROM (VALUES (1L), (CAST(NULL AS BIGINT)), (3L), (5L), (CAST(NULL AS BIGINT)), (7L)) AS tab(col1)
) WITH_NULLS,
(
    SELECT kll_sketch_agg_bigint(col1) AS agg_without_nulls
    FROM (VALUES (1L), (3L), (5L), (7L)) AS tab(col1)
) WITHOUT_NULLS
-- !query schema
struct<medians_match:boolean,ranks_match:boolean>
-- !query output
true	true


-- !query
SELECT abs(kll_sketch_get_quantile_float(agg_with_nulls, 0.5) - 
           kll_sketch_get_quantile_float(agg_without_nulls, 0.5)) < 0.5 AS medians_match,
       abs(kll_sketch_get_rank_float(agg_with_nulls, 4.0) - 
           kll_sketch_get_rank_float(agg_without_nulls, 4.0)) < 0.1 AS ranks_match
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg_with_nulls
    FROM (VALUES (1.0F), (CAST(NULL AS FLOAT)), (3.0F), (5.0F), (CAST(NULL AS FLOAT)), (7.0F)) AS tab(col1)
) WITH_NULLS,
(
    SELECT kll_sketch_agg_float(col1) AS agg_without_nulls
    FROM (VALUES (1.0F), (3.0F), (5.0F), (7.0F)) AS tab(col1)
) WITHOUT_NULLS
-- !query schema
struct<medians_match:boolean,ranks_match:boolean>
-- !query output
true	true


-- !query
SELECT abs(kll_sketch_get_quantile_double(agg_with_nulls, 0.5) - 
           kll_sketch_get_quantile_double(agg_without_nulls, 0.5)) < 0.5 AS medians_match,
       abs(kll_sketch_get_rank_double(agg_with_nulls, 4.0) - 
           kll_sketch_get_rank_double(agg_without_nulls, 4.0)) < 0.1 AS ranks_match
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg_with_nulls
    FROM (VALUES (1.0D), (CAST(NULL AS DOUBLE)), (3.0D), (5.0D), (CAST(NULL AS DOUBLE)), (7.0D)) AS tab(col1)
) WITH_NULLS,
(
    SELECT kll_sketch_agg_double(col1) AS agg_without_nulls
    FROM (VALUES (1.0D), (3.0D), (5.0D), (7.0D)) AS tab(col1)
) WITHOUT_NULLS
-- !query schema
struct<medians_match:boolean,ranks_match:boolean>
-- !query output
true	true


-- !query
SELECT kll_sketch_get_quantile_bigint(CAST(NULL AS BINARY), 0.5) AS null_sketch
-- !query schema
struct<null_sketch:bigint>
-- !query output
NULL


-- !query
SELECT kll_sketch_get_rank_float(CAST(NULL AS BINARY), 5.0) AS null_sketch
-- !query schema
struct<null_sketch:double>
-- !query output
NULL


-- !query
SELECT LENGTH(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1, 8))) > 0 AS k_min_value
FROM t_long_1_5_through_7_11
-- !query schema
struct<k_min_value:boolean>
-- !query output
true


-- !query
SELECT LENGTH(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1, 200))) > 0 AS k_default_value
FROM t_long_1_5_through_7_11
-- !query schema
struct<k_default_value:boolean>
-- !query output
true


-- !query
SELECT LENGTH(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1, 400))) > 0 AS k_custom_value
FROM t_long_1_5_through_7_11
-- !query schema
struct<k_custom_value:boolean>
-- !query output
true


-- !query
SELECT LENGTH(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1, 65535))) > 0 AS k_max_value
FROM t_long_1_5_through_7_11
-- !query schema
struct<k_max_value:boolean>
-- !query output
true


-- !query
SELECT LENGTH(kll_sketch_to_string_float(kll_sketch_agg_float(col1, 100))) > 0 AS k_float_sketch
FROM t_float_1_5_through_7_11
-- !query schema
struct<k_float_sketch:boolean>
-- !query output
true


-- !query
SELECT LENGTH(kll_sketch_to_string_double(kll_sketch_agg_double(col1, 300))) > 0 AS k_double_sketch
FROM t_double_1_5_through_7_11
-- !query schema
struct<k_double_sketch:boolean>
-- !query output
true


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"DOUBLE\"",
    "paramIndex" : "first",
    "requiredType" : "(\"TINYINT\" or \"INT\" or \"BIGINT\" or \"SMALLINT\")",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 273,
    "stopIndex" : 299,
    "fragment" : "kll_sketch_agg_bigint(col1)"
  } ]
}


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"FLOAT\"",
    "paramIndex" : "first",
    "requiredType" : "(\"TINYINT\" or \"INT\" or \"BIGINT\" or \"SMALLINT\")",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 273,
    "stopIndex" : 299,
    "fragment" : "kll_sketch_agg_bigint(col1)"
  } ]
}


-- !query
SELECT split(kll_sketch_to_string_float(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_float(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_float(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"DOUBLE\"",
    "paramIndex" : "first",
    "requiredType" : "(\"TINYINT\" or \"FLOAT\" or \"INT\" or \"BIGINT\" or \"SMALLINT\")",
    "sqlExpr" : "\"kll_sketch_agg_float(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 274,
    "stopIndex" : 299,
    "fragment" : "kll_sketch_agg_float(col1)"
  } ]
}


-- !query
SELECT kll_sketch_get_quantile_bigint(agg, -0.5) AS invalid_quantile
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "KLL_SKETCH_INVALID_QUANTILE_RANGE",
  "sqlState" : "22003",
  "messageParameters" : {
    "quantile" : "-0.5D"
  }
}


-- !query
SELECT kll_sketch_get_quantile_bigint(agg, 1.5) AS invalid_quantile
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "KLL_SKETCH_INVALID_QUANTILE_RANGE",
  "sqlState" : "22003",
  "messageParameters" : {
    "quantile" : "1.5D"
  }
}


-- !query
SELECT kll_sketch_get_quantile_float(agg, array(-0.1, 0.5, 1.5)) AS invalid_quantiles
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "KLL_SKETCH_INVALID_QUANTILE_RANGE",
  "sqlState" : "22003",
  "messageParameters" : {
    "quantile" : "-0.1D"
  }
}


-- !query
SELECT kll_sketch_get_rank_bigint(agg, 5) AS wrong_type
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "KLL_SKETCH_INVALID_INPUT",
  "sqlState" : "22000",
  "messageParameters" : {
    "reason" : "reqOffset: 40, reqLength: 56, (reqOff + reqLen): 96, allocSize: 60"
  }
}


-- !query
SELECT kll_sketch_merge_bigint(agg1, agg2) AS incompatible_merge
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg1,
           kll_sketch_agg_float(CAST(col1 AS FLOAT)) AS agg2
    FROM t_long_1_5_through_7_11
)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "KLL_SKETCH_INCOMPATIBLE_MERGE",
  "sqlState" : "22000",
  "messageParameters" : {
    "reason" : "reqOffset: 40, reqLength: 56, (reqOff + reqLen): 96, allocSize: 60"
  }
}


-- !query
SELECT kll_sketch_get_quantile_bigint(CAST('not_a_sketch' AS BINARY), 0.5) AS invalid_binary
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "KLL_SKETCH_INVALID_INPUT",
  "sqlState" : "22000",
  "messageParameters" : {
    "reason" : "Error combination of PreInts and SerVer: PreInts: 110, SerVer: 111"
  }
}


-- !query
SELECT kll_sketch_get_quantile_float(agg, 0.5) IS NOT NULL AS returns_value
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query schema
struct<returns_value:boolean>
-- !query output
true


-- !query
SELECT kll_sketch_to_string_double(agg) LIKE '%Kll%' AS contains_kll_header
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query schema
struct<contains_kll_header:boolean>
-- !query output
true


-- !query
SELECT kll_sketch_agg_bigint(col1, 7) AS k_too_small
FROM t_long_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.TYPE_CHECK_FAILURE_WITH_HINT",
  "sqlState" : "42K09",
  "messageParameters" : {
    "hint" : "",
    "msg" : "[KLL_SKETCH_K_OUT_OF_RANGE] The k parameter must be between 8 and 65535 (inclusive), but got 7. SQLSTATE: 22003",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1, 7)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 37,
    "fragment" : "kll_sketch_agg_bigint(col1, 7)"
  } ]
}


-- !query
SELECT kll_sketch_agg_bigint(col1, 65536) AS k_too_large
FROM t_long_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.TYPE_CHECK_FAILURE_WITH_HINT",
  "sqlState" : "42K09",
  "messageParameters" : {
    "hint" : "",
    "msg" : "[KLL_SKETCH_K_OUT_OF_RANGE] The k parameter must be between 8 and 65535 (inclusive), but got 65536. SQLSTATE: 22003",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1, 65536)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 41,
    "fragment" : "kll_sketch_agg_bigint(col1, 65536)"
  } ]
}


-- !query
SELECT kll_sketch_agg_float(col1, CAST(NULL AS INT)) AS k_is_null
FROM t_float_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_NULL",
  "sqlState" : "42K09",
  "messageParameters" : {
    "exprName" : "k",
    "sqlExpr" : "\"kll_sketch_agg_float(col1, CAST(NULL AS INT))\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 52,
    "fragment" : "kll_sketch_agg_float(col1, CAST(NULL AS INT))"
  } ]
}


-- !query
SELECT kll_sketch_agg_double(col1, CAST(col1 AS INT)) AS k_non_constant
FROM t_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.NON_FOLDABLE_INPUT",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputExpr" : "CAST(spark_catalog.default.t_double_1_5_through_7_11.col1 AS INT)",
    "inputName" : "k",
    "inputType" : "int",
    "sqlExpr" : "\"kll_sketch_agg_double(col1, CAST(col1 AS INT))\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 53,
    "fragment" : "kll_sketch_agg_double(col1, CAST(col1 AS INT))"
  } ]
}


-- !query
SELECT kll_sketch_agg_bigint(col1, '100') AS k_wrong_type
FROM t_long_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"100\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "second",
    "requiredType" : "\"INT\"",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1, 100)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 41,
    "fragment" : "kll_sketch_agg_bigint(col1, '100')"
  } ]
}


-- !query
DROP TABLE IF EXISTS t_int_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_long_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_short_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_byte_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_float_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output

