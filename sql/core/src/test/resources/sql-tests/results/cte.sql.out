-- Automatically generated by SQLQueryTestSuite
-- Number of queries: 27


-- !query
create temporary view t as select * from values 0, 1, 2 as t(id)
-- !query schema
struct<>
-- !query output



-- !query
create temporary view t2 as select * from values 0, 1 as t(id)
-- !query schema
struct<>
-- !query output



-- !query
WITH s AS (SELECT 1 FROM s) SELECT * FROM s
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Table or view not found: s; line 1 pos 25


-- !query
WITH r AS (SELECT (SELECT * FROM r))
SELECT * FROM r
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Table or view not found: r; line 1 pos 33


-- !query
WITH t AS (SELECT 1 FROM t) SELECT * FROM t
-- !query schema
struct<1:int>
-- !query output
1
1
1


-- !query
WITH s1 AS (SELECT 1 FROM s2), s2 AS (SELECT 1 FROM s1) SELECT * FROM s1, s2
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Table or view not found: s2; line 1 pos 26


-- !query
WITH t1 AS (SELECT * FROM t2), t2 AS (SELECT 2 FROM t1) SELECT * FROM t1 cross join t2
-- !query schema
struct<id:int,2:int>
-- !query output
0	2
0	2
1	2
1	2


-- !query
WITH CTE1 AS (
  SELECT b.id AS id
  FROM   T2 a
         CROSS JOIN (SELECT id AS id FROM T2) b
)
SELECT t1.id AS c1,
       t2.id AS c2
FROM   CTE1 t1
       CROSS JOIN CTE1 t2
-- !query schema
struct<c1:int,c2:int>
-- !query output
0	0
0	0
0	0
0	0
0	1
0	1
0	1
0	1
1	0
1	0
1	0
1	0
1	1
1	1
1	1
1	1


-- !query
WITH t(x) AS (SELECT 1)
SELECT * FROM t WHERE x = 1
-- !query schema
struct<x:int>
-- !query output
1


-- !query
WITH t(x, y) AS (SELECT 1, 2)
SELECT * FROM t WHERE x = 1 AND y = 2
-- !query schema
struct<x:int,y:int>
-- !query output
1	2


-- !query
WITH t(x, x) AS (SELECT 1, 2)
SELECT * FROM t
-- !query schema
struct<x:int,x:int>
-- !query output
1	2


-- !query
WITH t() AS (SELECT 1)
SELECT * FROM t
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.parser.ParseException

no viable alternative at input 'WITH t()'(line 1, pos 7)

== SQL ==
WITH t() AS (SELECT 1)
-------^^^
SELECT * FROM t


-- !query
WITH
  t(x) AS (SELECT 1),
  t(x) AS (SELECT 2)
SELECT * FROM t
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.parser.ParseException

CTE definition can't have duplicate names: 't'.(line 1, pos 0)

== SQL ==
WITH
^^^
  t(x) AS (SELECT 1),
  t(x) AS (SELECT 2)
SELECT * FROM t


-- !query
WITH t as (
  WITH t2 AS (SELECT 1)
  SELECT * FROM t2
)
SELECT * FROM t
-- !query schema
struct<1:int>
-- !query output
1


-- !query
SELECT max(c) FROM (
  WITH t(c) AS (SELECT 1)
  SELECT * FROM t
)
-- !query schema
struct<max(c):int>
-- !query output
1


-- !query
SELECT (
  WITH t AS (SELECT 1)
  SELECT * FROM t
)
-- !query schema
struct<scalarsubquery():int>
-- !query output
1


-- !query
WITH
  t AS (SELECT 1),
  t2 AS (
    WITH t AS (SELECT 2)
    SELECT * FROM t
  )
SELECT * FROM t2
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Name t is ambiguous in nested CTE. Please set spark.sql.legacy.ctePrecedencePolicy to CORRECTED so that name defined in inner CTE takes precedence. If set it to LEGACY, outer CTE definitions will take precedence. See more details in SPARK-28228.;


-- !query
WITH
  t(c) AS (SELECT 1),
  t2 AS (
    SELECT (
      SELECT max(c) FROM (
        WITH t(c) AS (SELECT 2)
        SELECT * FROM t
      )
    )
  )
SELECT * FROM t2
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Name t is ambiguous in nested CTE. Please set spark.sql.legacy.ctePrecedencePolicy to CORRECTED so that name defined in inner CTE takes precedence. If set it to LEGACY, outer CTE definitions will take precedence. See more details in SPARK-28228.;


-- !query
WITH
  t AS (SELECT 1),
  t2 AS (
    WITH t AS (SELECT 2),
    t2 AS (
      WITH t AS (SELECT 3)
      SELECT * FROM t
    )
    SELECT * FROM t2
  )
SELECT * FROM t2
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Name t is ambiguous in nested CTE. Please set spark.sql.legacy.ctePrecedencePolicy to CORRECTED so that name defined in inner CTE takes precedence. If set it to LEGACY, outer CTE definitions will take precedence. See more details in SPARK-28228.;


-- !query
WITH t(c) AS (SELECT 1)
SELECT max(c) FROM (
  WITH t(c) AS (SELECT 2)
  SELECT * FROM t
)
-- !query schema
struct<max(c):int>
-- !query output
2


-- !query
WITH t(c) AS (SELECT 1)
SELECT sum(c) FROM (
  SELECT max(c) AS c FROM (
    WITH t(c) AS (SELECT 2)
    SELECT * FROM t
  )
)
-- !query schema
struct<sum(c):bigint>
-- !query output
2


-- !query
WITH t(c) AS (SELECT 1)
SELECT sum(c) FROM (
  WITH t(c) AS (SELECT 2)
  SELECT max(c) AS c FROM (
    WITH t(c) AS (SELECT 3)
    SELECT * FROM t
  )
)
-- !query schema
struct<sum(c):bigint>
-- !query output
3


-- !query
WITH t AS (SELECT 1)
SELECT (
  WITH t AS (SELECT 2)
  SELECT * FROM t
)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Name t is ambiguous in nested CTE. Please set spark.sql.legacy.ctePrecedencePolicy to CORRECTED so that name defined in inner CTE takes precedence. If set it to LEGACY, outer CTE definitions will take precedence. See more details in SPARK-28228.;


-- !query
WITH t AS (SELECT 1)
SELECT (
  SELECT (
    WITH t AS (SELECT 2)
    SELECT * FROM t
  )
)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Name t is ambiguous in nested CTE. Please set spark.sql.legacy.ctePrecedencePolicy to CORRECTED so that name defined in inner CTE takes precedence. If set it to LEGACY, outer CTE definitions will take precedence. See more details in SPARK-28228.;


-- !query
WITH t AS (SELECT 1)
SELECT (
  WITH t AS (SELECT 2)
  SELECT (
    WITH t AS (SELECT 3)
    SELECT * FROM t
  )
)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Name t is ambiguous in nested CTE. Please set spark.sql.legacy.ctePrecedencePolicy to CORRECTED so that name defined in inner CTE takes precedence. If set it to LEGACY, outer CTE definitions will take precedence. See more details in SPARK-28228.;


-- !query
DROP VIEW IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
DROP VIEW IF EXISTS t2
-- !query schema
struct<>
-- !query output

