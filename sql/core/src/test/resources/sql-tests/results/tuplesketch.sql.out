-- Automatically generated by SQLQueryTestSuite
-- !query
DROP TABLE IF EXISTS t_int_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_int_double_1_5_through_7_11 AS
VALUES
  (1, 1.0D, 5, 5.0D), (2, 2.0D, 6, 6.0D), (3, 3.0D, 7, 7.0D),
  (4, 4.0D, 8, 8.0D), (5, 5.0D, 9, 9.0D), (6, 6.0D, 10, 10.0D),
  (7, 7.0D, 11, 11.0D) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_long_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_long_double_1_5_through_7_11 AS
VALUES
  (1L, 1.0D, 5L, 5.00D), (2L, 2.00D, 6L, 6.00D), (3L, 3.00D, 7L, 7.00D),
  (4L, 4.0D, 8L, 8.00D), (5L, 5.00D, 9L, 9.00D), (6L, 6.00D, 10L, 10.00D),
  (7L, 7.0D, 11L, 11.00D) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_double_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_double_double_1_1_1_4_through_1_5_1_8 AS
SELECT CAST(key1 AS DOUBLE) AS key1, CAST(val1 AS DOUBLE) AS val1,
       CAST(key2 AS DOUBLE) AS key2, CAST(val2 AS DOUBLE) AS val2
FROM VALUES
  (1.1, 1.0, 1.4, 4.0), (1.2, 2.0, 1.5, 5.0), (1.3, 3.0, 1.6, 6.0),
  (1.4, 4.0, 1.7, 7.0), (1.5, 5.0, 1.8, 8.0) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_float_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_float_double_1_1_1_4_through_1_5_1_8 AS
SELECT CAST(key1 AS FLOAT) key1, CAST(val1 AS DOUBLE) AS val1,
       CAST(key2 AS FLOAT) key2, CAST(val2 AS DOUBLE) AS val2
FROM VALUES
  (1.1, 1.0, 1.4, 4.0), (1.2, 2.0, 1.5, 5.0), (1.3, 3.0, 1.6, 6.0),
  (1.4, 4.0, 1.7, 7.0), (1.5, 5.0, 1.8, 8.0) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_string_double_a_d_through_e_h
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_string_double_a_d_through_e_h AS
VALUES
  ('a', 1.00D, 'd', 4.00D), ('b', 2.00D, 'e', 5.00D), ('c', 3.00D, 'f', 6.00D),
  ('d', 4.00D, 'g', 7.00D), ('e', 5.00D, 'h', 8.00D) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_binary_double_a_b_through_e_f
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_binary_double_a_b_through_e_f AS
VALUES
  (X'A', 1.00D, X'B', 2.00D), (X'B', 2.00D, X'C', 3.00D), (X'C', 3.00D, X'D', 4.00D),
  (X'D', 4.00D, X'E', 5.00D), (X'E', 5.00D, X'F', 6.00D) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_array_int_double_1_3_through_4_6
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_array_int_double_1_3_through_4_6 AS
VALUES
  (ARRAY(1), 1.00D, ARRAY(3), 3.00D),
  (ARRAY(2), 2.00D, ARRAY(4), 4.00D),
  (ARRAY(3), 3.00D, ARRAY(5), 5.00D),
  (ARRAY(4), 4.00D, ARRAY(6), 6.00D) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_array_long_double_1_3_through_4_6
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_array_long_double_1_3_through_4_6 AS
VALUES
  (ARRAY(1L), 1.00D, ARRAY(3L), 3.00D),
  (ARRAY(2L), 2.00D, ARRAY(4L), 4.00D),
  (ARRAY(3L), 3.00D, ARRAY(5L), 5.00D),
  (ARRAY(4L), 4.00D, ARRAY(6L), 6.00D) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_int_int_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_int_int_1_5_through_7_11 AS
VALUES
  (1, 1, 5, 5), (2, 2, 6, 6), (3, 3, 7, 7),
  (4, 4, 8, 8), (5, 5, 9, 9), (6, 6, 10, 10),
  (7, 7, 11, 11) AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_string_string_a_d_through_e_h
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_string_string_a_d_through_e_h AS
VALUES
  ('a', 'val_a', 'd', 'val_d'), ('b', 'val_b', 'e', 'val_e'),
  ('c', 'val_c', 'f', 'val_f'), ('d', 'val_d', 'g', 'val_g'),
  ('e', 'val_e', 'h', 'val_h') AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_string_array_string_a_d_through_e_h
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_string_array_string_a_d_through_e_h AS
VALUES
  ('a', array('val_a', 'extra_a'), 'd', array('val_d')), 
  ('b', array('val_b'), 'e', array('val_e', 'extra_e')),
  ('c', array('val_c1', 'val_c2', 'val_c3'), 'f', array('val_f')), 
  ('d', array('val_d'), 'g', array('val_g')),
  ('e', array('val_e'), 'h', array('val_h1', 'val_h2')) 
AS tab(key1, val1, key2, val2)
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_string_collation
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t_string_collation AS
VALUES
  ('', 1.00D), ('  ', 2.00D), (CAST(X'C1' AS STRING), 3.00D), (CAST(X'80' AS STRING), 4.00D),
  ('\uFFFD', 5.00D), ('Å', 6.00D), ('å', 7.00D), ('a\u030A', 8.00D), ('Å ', 9.00D), ('å  ', 10.00D),
  ('a\u030A   ', 11.00D) AS tab(key1, val1)
-- !query schema
struct<>
-- !query output



-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1))) AS result
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<result:double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'integer'), 'integer') AS result
FROM t_int_int_1_5_through_7_11
-- !query schema
struct<result:double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1)))
FROM t_array_int_double_1_3_through_4_6
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, sum), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key2, val2)))
FROM t_array_long_double_1_3_through_4_6
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key2, val2), 12, double, sum), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1)))
FROM t_binary_double_a_b_through_e_f
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, sum), double):double>
-- !query output
5.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1)))
FROM t_double_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, sum), double):double>
-- !query output
5.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key2, val2)))
FROM t_float_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key2, val2), 12, double, sum), double):double>
-- !query output
5.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 22))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 22, double, sum), double):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1)))
FROM t_long_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, sum), double):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1)))
FROM t_string_double_a_d_through_e_h
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, sum), double):double>
-- !query output
5.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'double'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, sum), double):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'integer'), 'integer')
FROM t_int_int_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, integer, sum), integer):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'string'), 'string')
FROM t_string_string_a_d_through_e_h
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, string, sum), string):double>
-- !query output
5.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'string'), 'string')
FROM t_string_array_string_a_d_through_e_h
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, string, sum), string):double>
-- !query output
5.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum'), 'double')
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, sum), double):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'min'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, min), double):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'max'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, max), double):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'alwaysone'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, double, alwaysone), double):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, double, sum), double, sum):double>
-- !query output
28.0


-- !query
SELECT tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'min'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, double, min), double, sum):double>
-- !query output
28.0


-- !query
SELECT tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'max'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, double, max), double, sum):double>
-- !query output
28.0


-- !query
SELECT tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'alwaysone'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, double, alwaysone), double, sum):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, 'integer', 'sum'), 'integer', 'sum')
FROM t_int_int_1_5_through_7_11
-- !query schema
struct<tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, integer, sum), integer, sum):double>
-- !query output
28.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), 12, double, sum), double):double>
-- !query output
11.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1), 15),
    tuple_sketch_agg(struct(key2, val2)), 15))
FROM t_long_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 15, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), 15, double, sum), double):double>
-- !query output
11.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_double_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), 12, double, sum), double):double>
-- !query output
8.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1), 6),
    tuple_sketch_agg(struct(key2, val2), 15), 15))
FROM t_float_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 6, double, sum), tuple_sketch_agg(struct(key2, val2), 15, double, sum), 15, double, sum), double):double>
-- !query output
8.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_string_double_a_d_through_e_h
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), 12, double, sum), double):double>
-- !query output
8.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2), 20), 20))
FROM t_binary_double_a_b_through_e_f
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 20, double, sum), 20, double, sum), double):double>
-- !query output
6.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_array_int_double_1_3_through_4_6
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), 12, double, sum), double):double>
-- !query output
6.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2), 13), 13))
FROM t_array_long_double_1_3_through_4_6
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 13, double, sum), 13, double, sum), double):double>
-- !query output
6.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union(
    tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum'),
    tuple_sketch_agg(struct(key2, val2), 12, 'double', 'sum'), 12, 'double', 'sum'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_union(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), 12, double, sum), double):double>
-- !query output
11.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union_theta(
    tuple_sketch_agg(struct(key1, val1)),
    theta_sketch_agg(key2)))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_union_theta(tuple_sketch_agg(struct(key1, val1), 12, double, sum), theta_sketch_agg(key2, 12), 12, double, sum), double):double>
-- !query output
11.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_union_theta(
    tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum'),
    theta_sketch_agg(key2, 12), 12, 'double', 'sum'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_union_theta(tuple_sketch_agg(struct(key1, val1), 12, double, sum), theta_sketch_agg(key2, 12), 12, double, sum), double):double>
-- !query output
11.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1), 5),
    tuple_sketch_agg(struct(key2, val2), 12)))
FROM t_long_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 5, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_double_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1), 5),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_float_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 5, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_string_double_a_d_through_e_h
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2), 22)))
FROM t_binary_double_a_b_through_e_f
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 22, double, sum), double, sum), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_array_int_double_1_3_through_4_6
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2), 10)))
FROM t_array_long_double_1_3_through_4_6
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 10, double, sum), double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection(
    tuple_sketch_agg(struct(key1, val1), 12, 'double', 'min'),
    tuple_sketch_agg(struct(key2, val2), 12, 'double', 'min'), 'double', 'min'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection(tuple_sketch_agg(struct(key1, val1), 12, double, min), tuple_sketch_agg(struct(key2, val2), 12, double, min), double, min), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection_theta(
    tuple_sketch_agg(struct(key1, val1)),
    theta_sketch_agg(key2)))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_theta(tuple_sketch_agg(struct(key1, val1), 12, double, sum), theta_sketch_agg(key2, 12), double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_intersection_theta(
    tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum'),
    theta_sketch_agg(key2, 12), 'double', 'sum'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_theta(tuple_sketch_agg(struct(key1, val1), 12, double, sum), theta_sketch_agg(key2, 12), double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2), 5)))
FROM t_long_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 5, double, sum), double), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_double_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1), 12),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_float_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_string_double_a_d_through_e_h
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1), 6),
    tuple_sketch_agg(struct(key2, val2), 8)))
FROM t_binary_double_a_b_through_e_f
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 6, double, sum), tuple_sketch_agg(struct(key2, val2), 8, double, sum), double), double):double>
-- !query output
1.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2))))
FROM t_array_int_double_1_3_through_4_6
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 12, double, sum), double), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1)),
    tuple_sketch_agg(struct(key2, val2), 4)))
FROM t_array_long_double_1_3_through_4_6
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 12, double, sum), tuple_sketch_agg(struct(key2, val2), 4, double, sum), double), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference(
    tuple_sketch_agg(struct(key1, val1), 12, 'integer', 'sum'),
    tuple_sketch_agg(struct(key2, val2), 12, 'integer', 'sum'), 'integer'), 'integer')
FROM t_int_int_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_difference(tuple_sketch_agg(struct(key1, val1), 12, integer, sum), tuple_sketch_agg(struct(key2, val2), 12, integer, sum), integer), integer):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference_theta(
    tuple_sketch_agg(struct(key1, val1)),
    theta_sketch_agg(key2)))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_difference_theta(tuple_sketch_agg(struct(key1, val1), 12, double, sum), theta_sketch_agg(key2, 12), double), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(
  tuple_difference_theta(
    tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum'),
    theta_sketch_agg(key2, 12), 'double'))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<tuple_sketch_estimate(tuple_difference_theta(tuple_sketch_agg(struct(key1, val1), 12, double, sum), theta_sketch_agg(key2, 12), double), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 15, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_int_double_1_5_through_7_11
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2), 20) as sketch FROM t_int_double_1_5_through_7_11)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 15, double, sum), double):double>
-- !query output
11.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 12, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_double_double_1_1_1_4_through_1_5_1_8
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_double_double_1_1_1_4_through_1_5_1_8)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 12, double, sum), double):double>
-- !query output
8.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 14, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_string_double_a_d_through_e_h
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_string_double_a_d_through_e_h)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 14, double, sum), double):double>
-- !query output
8.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 10, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_long_double_1_5_through_7_11
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_long_double_1_5_through_7_11)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 10, double, sum), double):double>
-- !query output
11.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 6, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_float_double_1_1_1_4_through_1_5_1_8
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_float_double_1_1_1_4_through_1_5_1_8)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 6, double, sum), double):double>
-- !query output
8.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 12, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_binary_double_a_b_through_e_f
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_binary_double_a_b_through_e_f)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 12, double, sum), double):double>
-- !query output
6.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 12, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_array_int_double_1_3_through_4_6
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_array_int_double_1_3_through_4_6)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 12, double, sum), double):double>
-- !query output
6.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 16, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_array_long_double_1_3_through_4_6
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_array_long_double_1_3_through_4_6)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 16, double, sum), double):double>
-- !query output
6.0


-- !query
SELECT tuple_sketch_estimate(tuple_union_agg(sketch, 12, 'integer', 'sum'), 'integer')
FROM (SELECT tuple_sketch_agg(struct(key1, val1), 12, 'integer', 'sum') as sketch FROM t_int_int_1_5_through_7_11
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2), 12, 'integer', 'sum') as sketch FROM t_int_int_1_5_through_7_11)
-- !query schema
struct<tuple_sketch_estimate(tuple_union_agg(sketch, 12, integer, sum), integer):double>
-- !query output
11.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_int_double_1_5_through_7_11
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_int_double_1_5_through_7_11)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_long_double_1_5_through_7_11
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_long_double_1_5_through_7_11)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_float_double_1_1_1_4_through_1_5_1_8
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_float_double_1_1_1_4_through_1_5_1_8)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_double_double_1_1_1_4_through_1_5_1_8
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_double_double_1_1_1_4_through_1_5_1_8)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_string_double_a_d_through_e_h
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_string_double_a_d_through_e_h)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_binary_double_a_b_through_e_f
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_binary_double_a_b_through_e_f)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, double, sum), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_array_int_double_1_3_through_4_6
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_array_int_double_1_3_through_4_6)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'double', 'sum'))
FROM (SELECT tuple_sketch_agg(struct(key1, val1)) as sketch FROM t_array_long_double_1_3_through_4_6
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2)) as sketch FROM t_array_long_double_1_3_through_4_6)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(tuple_intersection_agg(sketch, 'integer', 'sum'), 'integer')
FROM (SELECT tuple_sketch_agg(struct(key1, val1), 12, 'integer', 'sum') as sketch FROM t_int_int_1_5_through_7_11
      UNION ALL
      SELECT tuple_sketch_agg(struct(key2, val2), 12, 'integer', 'sum') as sketch FROM t_int_int_1_5_through_7_11)
-- !query schema
struct<tuple_sketch_estimate(tuple_intersection_agg(sketch, integer, sum), integer):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (1, 1.0D), (null, 2.0D), (2, 2.0D), (null, 3.0D), (3, 3.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES ('test', 1.0D), (null, 2.0D), ('null', 3.0D), (null, 4.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (100L, 1.0D), (null, 2.0D), (200L, 3.0D), (null, 4.0D), (300L, 5.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(CAST(key AS DOUBLE), val)))
FROM VALUES (1.1, 1.0D), (null, 2.0D), (2.2, 3.0D), (null, 4.0D), (3.3, 5.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(CAST(key AS DOUBLE), val), 12, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(CAST(key AS FLOAT), val)))
FROM VALUES (1.5, 1.0D), (null, 2.0D), (2.5, 3.0D), (null, 4.0D), (3.5, 5.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(CAST(key AS FLOAT), val), 12, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (X'AA', 1.0D), (null, 2.0D), (X'BB', 3.0D), (null, 4.0D), (X'CC', 5.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (ARRAY(1, 2), 1.0D), (null, 2.0D), (ARRAY(3, 4), 3.0D), (null, 4.0D), (ARRAY(5, 6), 5.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (ARRAY(10L, 20L), 1.0), (null, 2.0D), (ARRAY(30L, 40L), 3.0D), (null, 4.0D), (ARRAY(50L, 60L), 5.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (ARRAY(1, null), 1.0), (ARRAY(1), 2.0D), (ARRAY(2, null, 3), 3.0D), (ARRAY(4), 4.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (ARRAY(10L, null), 1.0D), (ARRAY(10L), 2.0D), (ARRAY(20L, null, 30L), 3.0D), (ARRAY(40L), 4.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
4.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (ARRAY(), 1.0D), (ARRAY(1, 2), 2.0D), (ARRAY(), 3.0D), (ARRAY(3, 4), 4.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
2.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES ('', 1.0D), ('a', 2.0D), ('', 3.0D), ('b', 4.0D), ('c', 5.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key, val)))
FROM VALUES (X'', 1.0D), (X'01', 2.0D), (X'02', 3.0D), (X'03', 4.0D), (CAST('  ' AS BINARY), 5.0D), (X'e280', 6.0D), (X'c1', 7.0D), (X'c120', 8.0D) tab(key, val)
-- !query schema
struct<tuple_sketch_estimate(tuple_sketch_agg(struct(key, val), 12, double, sum), double):double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1))) utf8_b FROM t_string_collation
-- !query schema
struct<utf8_b:double>
-- !query output
10.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1 COLLATE UTF8_LCASE, val1))) utf8_lc FROM t_string_collation
-- !query schema
struct<utf8_lc:double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1 COLLATE UNICODE, val1))) unicode FROM t_string_collation
-- !query schema
struct<unicode:double>
-- !query output
7.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1 COLLATE UNICODE_CI, val1))) unicode_ci FROM t_string_collation
-- !query schema
struct<unicode_ci:double>
-- !query output
6.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1 COLLATE UTF8_BINARY_RTRIM, val1))) utf8_b_rt FROM t_string_collation
-- !query schema
struct<utf8_b_rt:double>
-- !query output
6.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1 COLLATE UTF8_LCASE_RTRIM, val1))) utf8_lc_rt FROM t_string_collation
-- !query schema
struct<utf8_lc_rt:double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1 COLLATE UNICODE_RTRIM, val1))) unicode_rt FROM t_string_collation
-- !query schema
struct<unicode_rt:double>
-- !query output
3.0


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1 COLLATE UNICODE_CI_RTRIM, val1))) unicode_ci_rt FROM t_string_collation
-- !query schema
struct<unicode_ci_rt:double>
-- !query output
2.0


-- !query
WITH sketches AS (
  SELECT 'int_sketch' as sketch_type, tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum') as sketch
  FROM t_int_double_1_5_through_7_11
  UNION ALL
  SELECT 'long_sketch' as sketch_type, tuple_sketch_agg(struct(key1, val1), 15, 'double', 'sum') as sketch
  FROM t_long_double_1_5_through_7_11
  UNION ALL
  SELECT 'double_sketch' as sketch_type, tuple_sketch_agg(struct(key1, val1), 10, 'double', 'sum') as sketch
  FROM t_double_double_1_1_1_4_through_1_5_1_8
  UNION ALL
  SELECT 'string_sketch' as sketch_type, tuple_sketch_agg(struct(key1, val1), 14, 'double', 'sum') as sketch
  FROM t_string_double_a_d_through_e_h
),
union_result AS (
  SELECT tuple_union_agg(sketch, 16, 'double', 'sum') as union_sketch FROM sketches
),
individual_sketches AS (
  SELECT
    tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum') as sketch1,
    tuple_sketch_agg(struct(key2, val2), 12, 'double', 'sum') as sketch2
  FROM t_int_double_1_5_through_7_11
)
SELECT
  tuple_sketch_estimate((SELECT union_sketch FROM union_result)) as union_estimate,
  tuple_sketch_summary((SELECT union_sketch FROM union_result), 'double', 'sum') as union_summary,
  tuple_sketch_estimate(tuple_union(sketch1, sketch2, 15, 'double', 'sum')) as binary_union_estimate,
  tuple_sketch_estimate(tuple_intersection(sketch1, sketch2, 'double', 'sum')) as intersection_estimate,
  tuple_sketch_estimate(tuple_difference(sketch1, sketch2, 'double')) as difference_estimate
FROM individual_sketches
-- !query schema
struct<union_estimate:double,union_summary:double,binary_union_estimate:double,intersection_estimate:double,difference_estimate:double>
-- !query output
17.0	86.0	11.0	3.0	4.0


-- !query
SELECT tuple_sketch_agg(struct(col, val), 2)
FROM VALUES (50, 1.0D), (60, 2.0D), (60, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "THETA_INVALID_LG_NOM_ENTRIES",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_agg`",
    "max" : "26",
    "min" : "4",
    "value" : "2"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col, val), 40)
FROM VALUES (50, 1.0D), (60, 2.0D), (60, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "THETA_INVALID_LG_NOM_ENTRIES",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_agg`",
    "max" : "26",
    "min" : "4",
    "value" : "40"
  }
}


-- !query
SELECT tuple_union_agg(sketch, 3, 'double', 'sum')
FROM (SELECT tuple_sketch_agg(struct(col, val), 12) as sketch
        FROM VALUES (1, 1.0D) AS tab(col, val)
      UNION ALL
      SELECT tuple_sketch_agg(struct(col, val), 20) as sketch
        FROM VALUES (1, 1.0D) AS tab(col, val))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "THETA_INVALID_LG_NOM_ENTRIES",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_union_agg`",
    "max" : "26",
    "min" : "4",
    "value" : "3"
  }
}


-- !query
SELECT tuple_union_agg(sketch, 27, 'double', 'sum')
FROM (SELECT tuple_sketch_agg(struct(col, val), 12) as sketch
        FROM VALUES (1, 1.0D) AS tab(col, val)
      UNION ALL
      SELECT tuple_sketch_agg(struct(col, val), 20) as sketch
        FROM VALUES (1, 1.0D) AS tab(col, val))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "THETA_INVALID_LG_NOM_ENTRIES",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_union_agg`",
    "max" : "26",
    "min" : "4",
    "value" : "27"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col, val), CAST(NULL AS INT)) AS lg_nom_entries_is_null
FROM VALUES (15, 1.0D), (16, 2.0D), (17, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "THETA_INVALID_LG_NOM_ENTRIES",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_agg`",
    "max" : "26",
    "min" : "4",
    "value" : "0"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col, val), CAST(col AS INT)) AS lg_nom_entries_non_constant
FROM VALUES (15, 1.0D), (16, 2.0D), (17, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_SKETCH_PARAMETER_MUST_BE_CONSTANT",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_agg`",
    "parameter" : "lgNomEntries"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col, val), '15')
FROM VALUES (50, 1.0D), (60, 2.0D), (60, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"15\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "second",
    "requiredType" : "\"INT\"",
    "sqlExpr" : "\"tuple_sketch_agg(struct(col, val), 15, double, sum)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 47,
    "fragment" : "tuple_sketch_agg(struct(col, val), '15')"
  } ]
}


-- !query
SELECT tuple_sketch_agg(struct(col, val), 12, CAST(col AS STRING))
FROM VALUES (15, 1.0D), (16, 2.0D), (17, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_SKETCH_PARAMETER_MUST_BE_CONSTANT",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_agg`",
    "parameter" : "summaryType"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col, val), 12, 'invalid_type')
FROM VALUES (50, 1.0D), (60, 2.0D), (60, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_SKETCH_SUMMARY_TYPE",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_agg`",
    "summaryType" : "invalid_type",
    "validTypes" : "double, integer, string"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col, val), 12, 'double', CAST(col AS STRING))
FROM VALUES (15, 1.0D), (16, 2.0D), (17, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_SKETCH_PARAMETER_MUST_BE_CONSTANT",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_agg`",
    "parameter" : "mode"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col, val), 12, 'double', 'invalid_mode')
FROM VALUES (50, 1.0D), (60, 2.0D), (60, 3.0D) tab(col, val)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_SKETCH_MODE",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_agg`",
    "mode" : "invalid_mode",
    "validModes" : "sum, min, max, alwaysone"
  }
}


-- !query
SELECT tuple_union(1, 2)
FROM VALUES
  (1, 4),
  (2, 5),
  (3, 6) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"tuple_union(1, 2, 12, double, sum)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 24,
    "fragment" : "tuple_union(1, 2)"
  } ]
}


-- !query
SELECT tuple_intersection(1, 2)
FROM VALUES
  (1, 4),
  (2, 5),
  (3, 6) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"tuple_intersection(1, 2, double, sum)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 31,
    "fragment" : "tuple_intersection(1, 2)"
  } ]
}


-- !query
SELECT tuple_difference(1, 2)
FROM VALUES
  (1, 4),
  (2, 5),
  (3, 6) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"tuple_difference(1, 2, double)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 29,
    "fragment" : "tuple_difference(1, 2)"
  } ]
}


-- !query
SELECT tuple_union(
    tuple_sketch_agg(struct(col1, 1.0D)),
    tuple_sketch_agg(struct(col2, 2.0D)), 'invalid')
FROM VALUES
  (1, 4),
  (2, 5),
  (3, 6) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"invalid\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "third",
    "requiredType" : "\"INT\"",
    "sqlExpr" : "\"tuple_union(tuple_sketch_agg(struct(col1, 1.0), 12, double, sum), tuple_sketch_agg(struct(col2, 2.0), 12, double, sum), invalid, double, sum)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 114,
    "fragment" : "tuple_union(\n    tuple_sketch_agg(struct(col1, 1.0D)),\n    tuple_sketch_agg(struct(col2, 2.0D)), 'invalid')"
  } ]
}


-- !query
SELECT tuple_intersection(
    tuple_sketch_agg(struct(col1, 1.0)),
    'invalid_sketch')
FROM VALUES
  (1, 4),
  (2, 5),
  (3, 6) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"invalid_sketch\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "second",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"tuple_intersection(tuple_sketch_agg(struct(col1, 1.0), 12, double, sum), invalid_sketch, double, sum)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 89,
    "fragment" : "tuple_intersection(\n    tuple_sketch_agg(struct(col1, 1.0)),\n    'invalid_sketch')"
  } ]
}


-- !query
SELECT tuple_sketch_estimate(CAST('abc' AS BINARY))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_estimate`",
    "reason" : "reqOffset: 3, reqLength: 1, (reqOff + reqLen): 4, allocSize: 3"
  }
}


-- !query
SELECT tuple_union(CAST('abc' AS BINARY), CAST('def' AS BINARY))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_union`",
    "reason" : "reqOffset: 3, reqLength: 1, (reqOff + reqLen): 4, allocSize: 3"
  }
}


-- !query
SELECT tuple_intersection(CAST('abc' AS BINARY), CAST('def' AS BINARY))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_intersection`",
    "reason" : "reqOffset: 3, reqLength: 1, (reqOff + reqLen): 4, allocSize: 3"
  }
}


-- !query
SELECT tuple_difference(CAST('abc' AS BINARY), CAST('def' AS BINARY))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_difference`",
    "reason" : "reqOffset: 3, reqLength: 1, (reqOff + reqLen): 4, allocSize: 3"
  }
}


-- !query
SELECT tuple_union_agg(buffer, 15, 'double', 'sum')
FROM (SELECT CAST('abc' AS BINARY) AS buffer)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_union_agg`",
    "reason" : "reqOffset: 3, reqLength: 1, (reqOff + reqLen): 4, allocSize: 3"
  }
}


-- !query
SELECT tuple_intersection_agg(buffer, 'double', 'sum')
FROM (SELECT CAST('abc' AS BINARY) AS buffer)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_intersection_agg`",
    "reason" : "reqOffset: 3, reqLength: 1, (reqOff + reqLen): 4, allocSize: 3"
  }
}


-- !query
SELECT tuple_sketch_summary(tuple_sketch_agg(struct(key1, val1), 12, 'string', 'sum'), 'string', 'sum')
FROM t_string_string_a_d_through_e_h
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_SUMMARY_TYPE_OPERATION",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_summary`",
    "summaryType" : "string"
  }
}


-- !query
SELECT tuple_union_theta(
    theta_sketch_agg(key1),
    tuple_sketch_agg(struct(key2, val2)))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_union_theta`",
    "reason" : "Invalid Sketch Type 62"
  }
}


-- !query
SELECT tuple_intersection_theta(
    theta_sketch_agg(key1),
    tuple_sketch_agg(struct(key2, val2)))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_intersection_theta`",
    "reason" : "Invalid Sketch Type 62"
  }
}


-- !query
SELECT tuple_difference_theta(
    theta_sketch_agg(key1),
    tuple_sketch_agg(struct(key2, val2)))
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_difference_theta`",
    "reason" : "Invalid Sketch Type 62"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col1, col2), 12, 'double', 'sum')
FROM VALUES (1, 'invalid'), (2, 'invalid') AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_SKETCH_SUMMARY_VALUE_TYPE",
  "sqlState" : "22546",
  "messageParameters" : {
    "actualType" : "UTF8String",
    "function" : "`tuple_sketch_agg`",
    "summaryType" : "double"
  }
}


-- !query
SELECT tuple_sketch_agg(struct(col1, col2), 12, 'integer', 'sum')
FROM VALUES (1, 1.5D), (2, 2.5D) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_SKETCH_SUMMARY_VALUE_TYPE",
  "sqlState" : "22546",
  "messageParameters" : {
    "actualType" : "Double",
    "function" : "`tuple_sketch_agg`",
    "summaryType" : "integer"
  }
}


-- !query
SELECT tuple_sketch_estimate(tuple_sketch_agg(struct(key1, val1), 12, 'double', 'sum'), 'integer')
FROM t_int_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "TUPLE_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`tuple_sketch_estimate`",
    "reason" : "Index 70 out of bounds for length 4"
  }
}


-- !query
DROP TABLE IF EXISTS t_int_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_long_double_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_double_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_float_double_1_1_1_4_through_1_5_1_8
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_string_double_a_d_through_e_h
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_binary_double_a_b_through_e_f
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_array_int_double_1_3_through_4_6
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_array_long_double_1_3_through_4_6
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_int_int_1_5_through_7_11
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_string_string_a_d_through_e_h
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t_string_collation
-- !query schema
struct<>
-- !query output

