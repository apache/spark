-- Automatically generated by SQLQueryTestSuite
-- !query
DROP TABLE IF EXISTS t1
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t1 USING JSON AS VALUES (0), (1), (2), (2), (2), (3), (4) as tab(col)
-- !query schema
struct<>
-- !query output



-- !query
SELECT hll_sketch_estimate(hll_sketch_agg(col)) AS result FROM t1
-- !query schema
struct<result:bigint>
-- !query output
5


-- !query
SELECT hll_sketch_estimate(hll_sketch_agg(col, 12))
FROM VALUES (50), (60), (60), (60), (75), (100) tab(col)
-- !query schema
struct<hll_sketch_estimate(hll_sketch_agg(col, 12)):bigint>
-- !query output
4


-- !query
SELECT hll_sketch_estimate(hll_sketch_agg(col))
FROM VALUES ('abc'), ('def'), ('abc'), ('ghi'), ('abc') tab(col)
-- !query schema
struct<hll_sketch_estimate(hll_sketch_agg(col, 12)):bigint>
-- !query output
3


-- !query
SELECT hll_sketch_estimate(
  hll_union(
    hll_sketch_agg(col1),
    hll_sketch_agg(col2)))
  FROM VALUES
    (1, 4),
    (1, 4),
    (2, 5),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query schema
struct<hll_sketch_estimate(hll_union(hll_sketch_agg(col1, 12), hll_sketch_agg(col2, 12), false)):bigint>
-- !query output
6


-- !query
SELECT hll_sketch_estimate(hll_union_agg(sketch, true))
    FROM (SELECT hll_sketch_agg(col) as sketch
            FROM VALUES (1) AS tab(col)
          UNION ALL
          SELECT hll_sketch_agg(col, 20) as sketch
            FROM VALUES (1) AS tab(col))
-- !query schema
struct<hll_sketch_estimate(hll_union_agg(sketch, true)):bigint>
-- !query output
1


-- !query
SELECT hll_sketch_agg(col)
FROM VALUES (ARRAY(1, 2)), (ARRAY(3, 4)) tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col\"",
    "inputType" : "\"ARRAY<INT>\"",
    "paramIndex" : "first",
    "requiredType" : "(\"INT\" or \"BIGINT\" or \"STRING\" or \"BINARY\")",
    "sqlExpr" : "\"hll_sketch_agg(col, 12)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 26,
    "fragment" : "hll_sketch_agg(col)"
  } ]
}


-- !query
SELECT hll_sketch_agg(col, 2)
FROM VALUES (50), (60), (60) tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "HLL_INVALID_LG_K",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`hll_sketch_agg`",
    "max" : "21",
    "min" : "4",
    "value" : "2"
  }
}


-- !query
SELECT hll_sketch_agg(col, 40)
FROM VALUES (50), (60), (60) tab(col)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "HLL_INVALID_LG_K",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`hll_sketch_agg`",
    "max" : "21",
    "min" : "4",
    "value" : "40"
  }
}


-- !query
SELECT hll_union(
    hll_sketch_agg(col1, 12),
    hll_sketch_agg(col2, 13))
  FROM VALUES
    (1, 4),
    (1, 4),
    (2, 5),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "HLL_UNION_DIFFERENT_LG_K",
  "sqlState" : "22000",
  "messageParameters" : {
    "function" : "`hll_union`",
    "left" : "12",
    "right" : "13"
  }
}


-- !query
SELECT hll_union_agg(sketch, false)
FROM (SELECT hll_sketch_agg(col, 12) as sketch
        FROM VALUES (1) AS tab(col)
      UNION ALL
      SELECT hll_sketch_agg(col, 20) as sketch
        FROM VALUES (1) AS tab(col))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "HLL_UNION_DIFFERENT_LG_K",
  "sqlState" : "22000",
  "messageParameters" : {
    "function" : "`hll_union_agg`",
    "left" : "12",
    "right" : "20"
  }
}


-- !query
SELECT hll_union(1, 2)
  FROM VALUES
    (1, 4),
    (1, 4),
    (2, 5),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"hll_union(1, 2, false)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 22,
    "fragment" : "hll_union(1, 2)"
  } ]
}


-- !query
SELECT hll_sketch_estimate(CAST ('abc' AS BINARY))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "HLL_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`hll_sketch_estimate`"
  }
}


-- !query
SELECT hll_union(CAST ('abc' AS BINARY), CAST ('def' AS BINARY))
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "HLL_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`hll_union`"
  }
}


-- !query
SELECT hll_union_agg(buffer, false)
FROM (SELECT CAST('abc' AS BINARY) AS buffer)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "HLL_INVALID_INPUT_SKETCH_BUFFER",
  "sqlState" : "22546",
  "messageParameters" : {
    "function" : "`hll_union_agg`"
  }
}


-- !query
DROP TABLE IF EXISTS t1
-- !query schema
struct<>
-- !query output

