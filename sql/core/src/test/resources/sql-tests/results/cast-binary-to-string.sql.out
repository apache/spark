-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE TEMPORARY VIEW valid_utf8 AS VALUES
  (X'48656C6C6F', 'ASCII Hello'),
  (X'436166C3A9', 'Latin-1: Café'),
  (X'E282AC313030', 'Symbol: €100')
AS data(binary_col, description)
-- !query schema
struct<>
-- !query output



-- !query
SELECT description, CAST(binary_col AS STRING) AS result FROM valid_utf8
-- !query schema
struct<description:string,result:string>
-- !query output
ASCII Hello	Hello
Latin-1: Café	Café
Symbol: €100	€100


-- !query
SET spark.sql.ansi.enabled=false
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.ansi.enabled	false


-- !query
CREATE TEMPORARY VIEW invalid_utf8 AS VALUES
  (X'80', 'Invalid continuation byte'),
  (X'C1', 'Invalid start byte'),
  (X'FF', 'Invalid UTF-8 byte'),
  (X'C080', 'Overlong encoding'),
  (X'E28000', 'Incomplete 3-byte sequence')
AS data(binary_col, description)
-- !query schema
struct<>
-- !query output



-- !query
SELECT description, CAST(binary_col AS STRING) AS result FROM invalid_utf8
-- !query schema
struct<description:string,result:string>
-- !query output
Incomplete 3-byte sequence	NULL
Invalid UTF-8 byte	NULL
Invalid continuation byte	NULL
Invalid start byte	NULL
Overlong encoding	NULL


-- !query
SET spark.sql.ansi.enabled=true
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.ansi.enabled	true


-- !query
SELECT CAST(X'80' AS STRING)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkRuntimeException
{
  "errorClass" : "CAST_INVALID_INPUT",
  "sqlState" : "22018",
  "messageParameters" : {
    "ansiConfig" : "\"spark.sql.ansi.enabled\"",
    "expression" : "\\x80",
    "sourceType" : "\"BINARY\"",
    "targetType" : "\"STRING\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 28,
    "fragment" : "CAST(X'80' AS STRING)"
  } ]
}


-- !query
SET spark.sql.ansi.enabled=false
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.ansi.enabled	false


-- !query
SELECT
  try_cast(X'48656C6C6F' AS STRING) AS valid_result,
  try_cast(X'80' AS STRING) AS invalid_result
-- !query schema
struct<valid_result:string,invalid_result:string>
-- !query output
Hello	NULL


-- !query
SET spark.sql.castBinaryToString.validateUtf8=false
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.castBinaryToString.validateUtf8	false


-- !query
SELECT
  CAST(X'80' AS STRING) IS NOT NULL AS invalid_has_value,
  CAST(X'48656C6C6F' AS STRING) AS valid_value
-- !query schema
struct<invalid_has_value:boolean,valid_value:string>
-- !query output
true	Hello


-- !query
SET spark.sql.castBinaryToString.validateUtf8=true
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.castBinaryToString.validateUtf8	true


-- !query
SELECT CAST(X'48656C6C6F' AS STRING) AS with_validation
-- !query schema
struct<with_validation:string>
-- !query output
Hello


-- !query
SET spark.sql.castBinaryToString.validateUtf8=false
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.castBinaryToString.validateUtf8	false


-- !query
SELECT CAST(X'48656C6C6F' AS STRING) AS without_validation
-- !query schema
struct<without_validation:string>
-- !query output
Hello


-- !query
DROP VIEW IF EXISTS valid_utf8
-- !query schema
struct<>
-- !query output



-- !query
DROP VIEW IF EXISTS invalid_utf8
-- !query schema
struct<>
-- !query output

