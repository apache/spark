-- Automatically generated by SQLQueryTestSuite
-- !query
SELECT explode(explode(array(array(1, 2, 3))))
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNSUPPORTED_GENERATOR.NESTED_IN_EXPRESSIONS",
  "sqlState" : "42K0E",
  "messageParameters" : {
    "expression" : "\"explode(explode(array(array(1, 2, 3))))\""
  }
}


-- !query
SELECT 1 + explode(array(1, 2, 3))
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNSUPPORTED_GENERATOR.NESTED_IN_EXPRESSIONS",
  "sqlState" : "42K0E",
  "messageParameters" : {
    "expression" : "\"(1 + explode(array(1, 2, 3)))\""
  }
}


-- !query
SELECT explode(array(0, 1, 2)), explode(array(10, 20))
-- !query schema
struct<col:int,col:int>
-- !query output
0	10
0	20
1	10
1	20
2	10
2	20


-- !query
SELECT explode(array(sin(0), 1, 2)), explode(array(10, 20))
-- !query schema
struct<col:double,col:int>
-- !query output
0.0	10
0.0	20
1.0	10
1.0	20
2.0	10
2.0	20


-- !query
SELECT explode(array(1, 2)), explode(array(3, 4)), count(*)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNSUPPORTED_GENERATOR.MULTI_GENERATOR",
  "sqlState" : "42K0E",
  "messageParameters" : {
    "generators" : "\"explode(array(1, 2))\", \"explode(array(3, 4))\"",
    "num" : "2"
  }
}


-- !query
SELECT explode(array(1, 2)) AS a, posexplode(array('x', 'y', 'z')) AS (pos, b)
-- !query schema
struct<a:int,pos:int,b:string>
-- !query output
1	0	x
1	1	y
1	2	z
2	0	x
2	1	y
2	2	z


-- !query
SELECT explode(collect_list(id)) AS val FROM range(5)
-- !query schema
struct<val:bigint>
-- !query output
0
1
2
3
4


-- !query
SELECT explode(collect_list(id)) AS val, count(*) AS cnt FROM range(3)
-- !query schema
struct<val:bigint,cnt:bigint>
-- !query output
0	3
1	3
2	3


-- !query
SELECT id, explode(array(1, 2, 3)) AS array_element
FROM (VALUES (1), (2)) AS t(id)
GROUP BY id, array_element
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "UNRESOLVED_COLUMN.WITH_SUGGESTION",
  "sqlState" : "42703",
  "messageParameters" : {
    "objectName" : "`array_element`",
    "proposal" : "`id`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 98,
    "stopIndex" : 110,
    "fragment" : "array_element"
  } ]
}


-- !query
SELECT id, posexplode_outer(CASE WHEN id = 1 THEN array('a', 'b') ELSE null END) AS (pos, val)
FROM range(3)
-- !query schema
struct<id:bigint,pos:int,val:string>
-- !query output
0	NULL	NULL
1	0	a
1	1	b
2	NULL	NULL


-- !query
WITH cte AS (SELECT explode(array(1, 2, 3)) AS col)
SELECT * FROM cte
UNION ALL
SELECT * FROM cte
-- !query schema
struct<col:int>
-- !query output
1
1
2
2
3
3


-- !query
WITH cte AS (SELECT explode(array(1, 2)) AS col)
SELECT t1.col, t2.col FROM cte t1 JOIN cte t2 ON t1.col = t2.col
-- !query schema
struct<col:int,col:int>
-- !query output
1	1
2	2


-- !query
SELECT * FROM (SELECT explode(array(1, 2, 3)) AS val) t WHERE val > 1
-- !query schema
struct<val:int>
-- !query output
2
3


-- !query
SELECT *
FROM (SELECT * FROM (SELECT explode(array(1, 2, 3, 4, 5)) AS val) WHERE val > 1)
WHERE val < 5
-- !query schema
struct<val:int>
-- !query output
2
3
4


-- !query
SELECT explode(arr) AS package
FROM (VALUES(array('a', 'b'))) AS t(arr)
GROUP BY ALL
-- !query schema
struct<package:string>
-- !query output
a
b


-- !query
SELECT explode(collect_list(a)) AS val
FROM (VALUES ('a'), ('b')) AS t(a)
GROUP BY ALL
-- !query schema
struct<val:string>
-- !query output
a
b


-- !query
SELECT stack(2, id + 10L, count(val))
FROM (VALUES (1,'a'), (1,'b'), (2, 'c')) AS t(id, val)
GROUP BY ALL
-- !query schema
struct<col0:bigint>
-- !query output
1
11
12
2


-- !query
SELECT id, explode(arr)
FROM (VALUES(42, array('a', 'b', 'c'))) AS t(id, arr)
GROUP BY id, 2
-- !query schema
struct<id:int,col:string>
-- !query output
42	a
42	b
42	c


-- !query
SELECT stack(2, 'first', count(*), arr,
             'second', 0L, array('1', '2', '3')) AS (x1, x2, x3), id
FROM (VALUES (1, array('a', 'b'))) AS t(id, arr)
GROUP BY 2, 3
-- !query schema
struct<x1:string,x2:bigint,x3:array<string>,id:int>
-- !query output
first	1	["a","b"]	1
second	0	["1","2","3"]	1


-- !query
SELECT stack(2, 'first', count(*), arr,
             'second', 0L, array('1', '2', '3')) AS (x1, x2, x3), id
FROM (VALUES (1, array('a', 'b'))) AS t(id, arr)
GROUP BY _gen_input_3, id
-- !query schema
struct<x1:string,x2:bigint,x3:array<string>,id:int>
-- !query output
first	1	["a","b"]	1
second	0	["1","2","3"]	1


-- !query
SELECT stack(2, 'first', count(*), arr,
             'second', 0L, array('1', '2', '3')) AS (x1, x2, x3), id
FROM (VALUES (1, array('a', 'b'))) AS t(id, arr)
GROUP BY _gen_input_3, id
HAVING size (_gen_input_3) > 0
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "UNRESOLVED_COLUMN.WITH_SUGGESTION",
  "sqlState" : "42703",
  "messageParameters" : {
    "objectName" : "`_gen_input_3`",
    "proposal" : "`t`.`id`, `x1`, `x2`, `x3`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 198,
    "stopIndex" : 209,
    "fragment" : "_gen_input_3"
  } ]
}


-- !query
SELECT explode(array(t1.c1, t2.c1)) AS x1
FROM (VALUES (1), (2)) AS t1(c1)
         FULL OUTER JOIN (VALUES (2), (3)) AS t2(c1)
                         USING (c1)
-- !query schema
struct<x1:int>
-- !query output
1
2
2
3
NULL
NULL


-- !query
SELECT explode(array(t1.c1, t2.c1)) AS x1, explode(array(t1.c1)) AS x2
FROM (VALUES (1), (2), (3)) AS t1(c1)
         FULL OUTER JOIN (VALUES (2), (3), (4)) AS t2(c1)
                         USING (c1)
-- !query schema
struct<x1:int,x2:int>
-- !query output
1	1
2	2
2	2
3	3
3	3
4	NULL
NULL	1
NULL	NULL


-- !query
SELECT id, posexplode(arr) AS (index, value), index, value
FROM (VALUES (42, array('a', 'b', 'c')), (42, array('t'))) AS t(id, arr)
-- !query schema
struct<id:int,index:int,value:string,index:int,value:string>
-- !query output
42	0	a	0	a
42	0	t	0	t
42	1	b	1	b
42	2	c	2	c


-- !query
SELECT array(1, 2, 3) as arr, explode(arr) as col
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkException
{
  "errorClass" : "INTERNAL_ERROR",
  "sqlState" : "XX000",
  "messageParameters" : {
    "message" : "Resolved plan should not contain any LateralColumnAliasReference.\nDebugging information: plan:\nGenerate explode(lateralAliasReference(arr)), false, [col#x]\n+- OneRowRelation\n"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 39,
    "stopIndex" : 41,
    "fragment" : "arr"
  } ]
}


-- !query
SELECT array(1, 2, 3) as arr, explode(arr) as col, count(*)
-- !query schema
struct<arr:array<int>,col:int,count(1):bigint>
-- !query output
[1,2,3]	1	1
[1,2,3]	2	1
[1,2,3]	3	1


-- !query
SELECT array(1, 2, 3) as arr, explode(arr) as col, count(*), col + 1 as col2
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "UNRESOLVED_COLUMN.WITHOUT_SUGGESTION",
  "sqlState" : "42703",
  "messageParameters" : {
    "objectName" : "`col`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 62,
    "stopIndex" : 64,
    "fragment" : "col"
  } ]
}


-- !query
SELECT explode(array(1, 2, 3)) as col, col + 1 as col2, count(*)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "UNRESOLVED_COLUMN.WITHOUT_SUGGESTION",
  "sqlState" : "42703",
  "messageParameters" : {
    "objectName" : "`col`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 40,
    "stopIndex" : 42,
    "fragment" : "col"
  } ]
}


-- !query
SELECT array(1, 2, 3) as arr, explode(arr) as col, col + 1 as col2
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkException
{
  "errorClass" : "INTERNAL_ERROR",
  "sqlState" : "XX000",
  "messageParameters" : {
    "message" : "Resolved plan should not contain any LateralColumnAliasReference.\nDebugging information: plan:\nGenerate explode(lateralAliasReference(arr)), false, [col#x]\n+- OneRowRelation\n"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 39,
    "stopIndex" : 41,
    "fragment" : "arr"
  } ]
}


-- !query
SELECT explode(array(1, 2, 3)) as col, col + 1 as col2
-- !query schema
struct<col:int,col2:int>
-- !query output
1	2
2	3
3	4


-- !query
SELECT explode(array(1, 2, 3)) as col, count(*) OVER ()
-- !query schema
struct<col:int,count(1) OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING):bigint>
-- !query output
1	3
2	3
3	3


-- !query
SELECT explode(array(1, 2, 3)), count(*) OVER (), count(*)
-- !query schema
struct<col:int,count(1) OVER (ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING):bigint,count(1):bigint>
-- !query output
1	1	1
2	1	1
3	1	1
