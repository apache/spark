-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE TABLE empsalary (
    depname string,
    empno integer,
    salary int,
    enroll_date date
) USING parquet
-- !query schema
struct<>
-- !query output



-- !query
INSERT INTO empsalary VALUES
  ('develop', 10, 5200, date '2007-08-01'),
  ('sales', 1, 5000, date '2006-10-01'),
  ('personnel', 5, 3500, date '2007-12-10'),
  ('sales', 4, 4800, date '2007-08-08'),
  ('personnel', 2, 3900, date '2006-12-23'),
  ('develop', 7, 4200, date '2008-01-01'),
  ('develop', 9, 4500, date '2008-01-01'),
  ('sales', 3, 4800, date '2007-08-01'),
  ('develop', 8, 6000, date '2006-10-01'),
  ('develop', 11, 5200, date '2007-08-15')
-- !query schema
struct<>
-- !query output



-- !query
SELECT sum(unique1) over (order by four range between 2 preceding and 1 preceding),
unique1, four
FROM tenk1 WHERE unique1 < 10
-- !query schema
struct<sum(unique1) OVER (ORDER BY four ASC NULLS FIRST RANGE BETWEEN 2 PRECEDING AND 1 PRECEDING):bigint,unique1:int,four:int>
-- !query output
12	1	1
12	5	1
12	9	1
23	3	3
23	7	3
27	2	2
27	6	2
NULL	0	0
NULL	4	0
NULL	8	0


-- !query
SELECT sum(unique1) over (order by four desc range between 2 preceding and 1 preceding),
unique1, four
FROM tenk1 WHERE unique1 < 10
-- !query schema
struct<sum(unique1) OVER (ORDER BY four DESC NULLS LAST RANGE BETWEEN 2 PRECEDING AND 1 PRECEDING):bigint,unique1:int,four:int>
-- !query output
10	2	2
10	6	2
18	1	1
18	5	1
18	9	1
23	0	0
23	4	0
23	8	0
NULL	3	3
NULL	7	3


-- !query
SELECT sum(unique1) over (partition by four order by unique1 range between 5 preceding and 6 following),
unique1, four
FROM tenk1 WHERE unique1 < 10
-- !query schema
struct<sum(unique1) OVER (PARTITION BY four ORDER BY unique1 ASC NULLS FIRST RANGE BETWEEN 5 PRECEDING AND 6 FOLLOWING):bigint,unique1:int,four:int>
-- !query output
10	3	3
10	7	3
12	4	0
12	8	0
14	9	1
15	5	1
4	0	0
6	1	1
8	2	2
8	6	2


-- !query
select ss.id, ss.y,
       first(ss.y) over w,
       last(ss.y) over w
from
  (select x.id, x.id as y from range(1,6) as x
   union all select null, 42
   union all select null, 43) ss
window w as
  (order by ss.id asc nulls first range between 2 preceding and 2 following)
-- !query schema
struct<id:bigint,y:bigint,first(y) OVER (ORDER BY id ASC NULLS FIRST RANGE BETWEEN (- 2) FOLLOWING AND 2 FOLLOWING):bigint,last(y) OVER (ORDER BY id ASC NULLS FIRST RANGE BETWEEN (- 2) FOLLOWING AND 2 FOLLOWING):bigint>
-- !query output
1	1	1	3
2	2	1	4
3	3	1	5
4	4	2	5
5	5	3	5
NULL	42	42	43
NULL	43	42	43


-- !query
select ss.id, ss.y,
       first(ss.y) over w,
       last(ss.y) over w
from
  (select x.id, x.id as y from range(1,6) as x
   union all select null, 42
   union all select null, 43) ss
window w as
  (order by ss.id asc nulls last range between 2 preceding and 2 following)
-- !query schema
struct<id:bigint,y:bigint,first(y) OVER (ORDER BY id ASC NULLS LAST RANGE BETWEEN (- 2) FOLLOWING AND 2 FOLLOWING):bigint,last(y) OVER (ORDER BY id ASC NULLS LAST RANGE BETWEEN (- 2) FOLLOWING AND 2 FOLLOWING):bigint>
-- !query output
1	1	1	3
2	2	1	4
3	3	1	5
4	4	2	5
5	5	3	5
NULL	42	42	43
NULL	43	42	43


-- !query
select ss.id, ss.y,
       first(ss.y) over w,
       last(ss.y) over w
from
  (select x.id, x.id as y from range(1,6) as x
   union all select null, 42
   union all select null, 43) ss
window w as
  (order by ss.id desc nulls first range between 2 preceding and 2 following)
-- !query schema
struct<id:bigint,y:bigint,first(y) OVER (ORDER BY id DESC NULLS FIRST RANGE BETWEEN (- 2) FOLLOWING AND 2 FOLLOWING):bigint,last(y) OVER (ORDER BY id DESC NULLS FIRST RANGE BETWEEN (- 2) FOLLOWING AND 2 FOLLOWING):bigint>
-- !query output
1	1	3	1
2	2	4	1
3	3	5	1
4	4	5	2
5	5	5	3
NULL	42	42	43
NULL	43	42	43


-- !query
select ss.id, ss.y,
       first(ss.y) over w,
       last(ss.y) over w
from
  (select x.id, x.id as y from range(1,6) as x
   union all select null, 42
   union all select null, 43) ss
window w as
  (order by ss.id desc nulls last range between 2 preceding and 2 following)
-- !query schema
struct<id:bigint,y:bigint,first(y) OVER (ORDER BY id DESC NULLS LAST RANGE BETWEEN (- 2) FOLLOWING AND 2 FOLLOWING):bigint,last(y) OVER (ORDER BY id DESC NULLS LAST RANGE BETWEEN (- 2) FOLLOWING AND 2 FOLLOWING):bigint>
-- !query output
1	1	3	1
2	2	4	1
3	3	5	1
4	4	5	2
5	5	5	3
NULL	42	42	43
NULL	43	42	43


-- !query
select x.id, last(x.id) over (order by x.id range between current row and 2147450884 following)
from range(32764, 32767) x
-- !query schema
struct<id:bigint,last(id) OVER (ORDER BY id ASC NULLS FIRST RANGE BETWEEN CURRENT ROW AND 2147450884 FOLLOWING):bigint>
-- !query output
32764	32766
32765	32766
32766	32766


-- !query
select x.id, last(x.id) over (order by x.id desc range between current row and 2147450885 following)
from range(-32766, -32765) x
-- !query schema
struct<id:bigint,last(id) OVER (ORDER BY id DESC NULLS LAST RANGE BETWEEN CURRENT ROW AND 2147450885 FOLLOWING):bigint>
-- !query output
-32766	-32766


-- !query
select x.id, last(x.id) over (order by x.id range between current row and 4 following)
from range(2147483644, 2147483647) x
-- !query schema
struct<id:bigint,last(id) OVER (ORDER BY id ASC NULLS FIRST RANGE BETWEEN CURRENT ROW AND 4 FOLLOWING):bigint>
-- !query output
2147483644	2147483646
2147483645	2147483646
2147483646	2147483646


-- !query
select x.id, last(x.id) over (order by x.id desc range between current row and 5 following)
from range(-2147483646, -2147483645) x
-- !query schema
struct<id:bigint,last(id) OVER (ORDER BY id DESC NULLS LAST RANGE BETWEEN CURRENT ROW AND 5 FOLLOWING):bigint>
-- !query output
-2147483646	-2147483646


-- !query
select x.id, last(x.id) over (order by x.id range between current row and 4 following)
from range(9223372036854775804, 9223372036854775807) x
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkArithmeticException
{
  "errorClass" : "ARITHMETIC_OVERFLOW",
  "sqlState" : "22003",
  "messageParameters" : {
    "alternative" : " Use 'try_add' to tolerate overflow and return NULL instead.",
    "config" : "\"spark.sql.ansi.enabled\"",
    "message" : "long overflow"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "fragment" : ""
  } ]
}


-- !query
select x.id, last(x.id) over (order by x.id desc range between current row and 5 following)
from range(-9223372036854775806, -9223372036854775805) x
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkArithmeticException
{
  "errorClass" : "ARITHMETIC_OVERFLOW",
  "sqlState" : "22003",
  "messageParameters" : {
    "alternative" : " Use 'try_add' to tolerate overflow and return NULL instead.",
    "config" : "\"spark.sql.ansi.enabled\"",
    "message" : "long overflow"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "fragment" : ""
  } ]
}


-- !query
create table numerics (
    id int,
    f_float4 float,
    f_float8 float,
    f_numeric int
) using parquet
-- !query schema
struct<>
-- !query output



-- !query
insert into numerics values
(1, -3, -3, -3),
(2, -1, -1, -1),
(3, 0, 0, 0),
(4, 1.1, 1.1, 1.1),
(5, 1.12, 1.12, 1.12),
(6, 2, 2, 2),
(7, 100, 100, 100)
-- !query schema
struct<>
-- !query output



-- !query
select id, f_float4, first(id) over w, last(id) over w
from numerics
window w as (order by f_float4 range between
             1 preceding and 1 following)
-- !query schema
struct<id:int,f_float4:float,first(id) OVER (ORDER BY f_float4 ASC NULLS FIRST RANGE BETWEEN (- 1) FOLLOWING AND 1 FOLLOWING):int,last(id) OVER (ORDER BY f_float4 ASC NULLS FIRST RANGE BETWEEN (- 1) FOLLOWING AND 1 FOLLOWING):int>
-- !query output
1	-3.0	1	1
2	-1.0	2	3
3	0.0	2	3
4	1.1	4	6
5	1.12	4	6
6	2.0	4	6
7	100.0	7	7


-- !query
select id, f_float4, first(id) over w, last(id) over w
from numerics
window w as (order by f_float4 range between
             1 preceding and 1.1 following)
-- !query schema
struct<id:int,f_float4:float,first(id) OVER (ORDER BY f_float4 ASC NULLS FIRST RANGE BETWEEN (- 1) FOLLOWING AND 1.1 FOLLOWING):int,last(id) OVER (ORDER BY f_float4 ASC NULLS FIRST RANGE BETWEEN (- 1) FOLLOWING AND 1.1 FOLLOWING):int>
-- !query output
1	-3.0	1	1
2	-1.0	2	3
3	0.0	2	4
4	1.1	4	6
5	1.12	4	6
6	2.0	4	6
7	100.0	7	7


-- !query
select id, f_float4, first(id) over w, last(id) over w
from numerics
window w as (order by f_float4 range between
             'inf' preceding and 'inf' following)
-- !query schema
struct<id:int,f_float4:float,first(id) OVER (ORDER BY f_float4 ASC NULLS FIRST RANGE BETWEEN (- inf) FOLLOWING AND inf FOLLOWING):int,last(id) OVER (ORDER BY f_float4 ASC NULLS FIRST RANGE BETWEEN (- inf) FOLLOWING AND inf FOLLOWING):int>
-- !query output
1	-3.0	1	7
2	-1.0	1	7
3	0.0	1	7
4	1.1	1	7
5	1.12	1	7
6	2.0	1	7
7	100.0	1	7


-- !query
select id, f_float4, first(id) over w, last(id) over w
from numerics
window w as (order by f_float4 range between
             1.1 preceding and 'NaN' following)
-- !query schema
struct<id:int,f_float4:float,first(id) OVER (ORDER BY f_float4 ASC NULLS FIRST RANGE BETWEEN (- 1.1) FOLLOWING AND NaN FOLLOWING):int,last(id) OVER (ORDER BY f_float4 ASC NULLS FIRST RANGE BETWEEN (- 1.1) FOLLOWING AND NaN FOLLOWING):int>
-- !query output
1	-3.0	1	7
2	-1.0	2	7
3	0.0	2	7
4	1.1	3	7
5	1.12	4	7
6	2.0	4	7
7	100.0	7	7


-- !query
select id, f_float8, first(id) over w, last(id) over w
from numerics
window w as (order by f_float8 range between
             1 preceding and 1 following)
-- !query schema
struct<id:int,f_float8:float,first(id) OVER (ORDER BY f_float8 ASC NULLS FIRST RANGE BETWEEN (- 1) FOLLOWING AND 1 FOLLOWING):int,last(id) OVER (ORDER BY f_float8 ASC NULLS FIRST RANGE BETWEEN (- 1) FOLLOWING AND 1 FOLLOWING):int>
-- !query output
1	-3.0	1	1
2	-1.0	2	3
3	0.0	2	3
4	1.1	4	6
5	1.12	4	6
6	2.0	4	6
7	100.0	7	7


-- !query
select id, f_float8, first(id) over w, last(id) over w
from numerics
window w as (order by f_float8 range between
             1 preceding and 1.1 following)
-- !query schema
struct<id:int,f_float8:float,first(id) OVER (ORDER BY f_float8 ASC NULLS FIRST RANGE BETWEEN (- 1) FOLLOWING AND 1.1 FOLLOWING):int,last(id) OVER (ORDER BY f_float8 ASC NULLS FIRST RANGE BETWEEN (- 1) FOLLOWING AND 1.1 FOLLOWING):int>
-- !query output
1	-3.0	1	1
2	-1.0	2	3
3	0.0	2	4
4	1.1	4	6
5	1.12	4	6
6	2.0	4	6
7	100.0	7	7


-- !query
select id, f_float8, first(id) over w, last(id) over w
from numerics
window w as (order by f_float8 range between
             'inf' preceding and 'inf' following)
-- !query schema
struct<id:int,f_float8:float,first(id) OVER (ORDER BY f_float8 ASC NULLS FIRST RANGE BETWEEN (- inf) FOLLOWING AND inf FOLLOWING):int,last(id) OVER (ORDER BY f_float8 ASC NULLS FIRST RANGE BETWEEN (- inf) FOLLOWING AND inf FOLLOWING):int>
-- !query output
1	-3.0	1	7
2	-1.0	1	7
3	0.0	1	7
4	1.1	1	7
5	1.12	1	7
6	2.0	1	7
7	100.0	1	7


-- !query
select id, f_float8, first(id) over w, last(id) over w
from numerics
window w as (order by f_float8 range between
             1.1 preceding and 'NaN' following)
-- !query schema
struct<id:int,f_float8:float,first(id) OVER (ORDER BY f_float8 ASC NULLS FIRST RANGE BETWEEN (- 1.1) FOLLOWING AND NaN FOLLOWING):int,last(id) OVER (ORDER BY f_float8 ASC NULLS FIRST RANGE BETWEEN (- 1.1) FOLLOWING AND NaN FOLLOWING):int>
-- !query output
1	-3.0	1	7
2	-1.0	2	7
3	0.0	2	7
4	1.1	3	7
5	1.12	4	7
6	2.0	4	7
7	100.0	7	7


-- !query
select id, f_numeric, first(id) over w, last(id) over w
from numerics
window w as (order by f_numeric range between
             1 preceding and 1 following)
-- !query schema
struct<id:int,f_numeric:int,first(id) OVER (ORDER BY f_numeric ASC NULLS FIRST RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING):int,last(id) OVER (ORDER BY f_numeric ASC NULLS FIRST RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING):int>
-- !query output
1	-3	1	1
2	-1	2	3
3	0	2	5
4	1	3	6
5	1	3	6
6	2	4	6
7	100	7	7


-- !query
select id, f_numeric, first(id) over w, last(id) over w
from numerics
window w as (order by f_numeric range between
             1 preceding and 1.1 following)
-- !query schema
struct<id:int,f_numeric:int,first(id) OVER (ORDER BY f_numeric ASC NULLS FIRST RANGE BETWEEN 1 PRECEDING AND 1.1 FOLLOWING):int,last(id) OVER (ORDER BY f_numeric ASC NULLS FIRST RANGE BETWEEN 1 PRECEDING AND 1.1 FOLLOWING):int>
-- !query output
1	-3	1	1
2	-1	2	3
3	0	2	5
4	1	3	6
5	1	3	6
6	2	4	6
7	100	7	7


-- !query
select id, f_numeric, first(id) over w, last(id) over w
from numerics
window w as (order by f_numeric range between
             1 preceding and 1.1 following)
-- !query schema
struct<id:int,f_numeric:int,first(id) OVER (ORDER BY f_numeric ASC NULLS FIRST RANGE BETWEEN 1 PRECEDING AND 1.1 FOLLOWING):int,last(id) OVER (ORDER BY f_numeric ASC NULLS FIRST RANGE BETWEEN 1 PRECEDING AND 1.1 FOLLOWING):int>
-- !query output
1	-3	1	1
2	-1	2	3
3	0	2	5
4	1	3	6
5	1	3	6
6	2	4	6
7	100	7	7


-- !query
select id, f_numeric, first(id) over w, last(id) over w
from numerics
window w as (order by f_numeric range between
             1.1 preceding and 'NaN' following)
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkNumberFormatException
{
  "errorClass" : "CAST_INVALID_INPUT",
  "sqlState" : "22018",
  "messageParameters" : {
    "ansiConfig" : "\"spark.sql.ansi.enabled\"",
    "expression" : "'NaN'",
    "sourceType" : "\"STRING\"",
    "targetType" : "\"INT\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 83,
    "stopIndex" : 163,
    "fragment" : "(order by f_numeric range between\n             1.1 preceding and 'NaN' following)"
  } ]
}


-- !query
drop table empsalary
-- !query schema
struct<>
-- !query output



-- !query
drop table numerics
-- !query schema
struct<>
-- !query output

