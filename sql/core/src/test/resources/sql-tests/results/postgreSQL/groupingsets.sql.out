-- Automatically generated by SQLQueryTestSuite
-- !query
create temp view gstest1(a,b,v)
  as values (1,1,10),(1,1,11),(1,2,12),(1,2,13),(1,3,14),
            (2,3,15),
            (3,3,16),(3,4,17),
            (4,1,18),(4,1,19)
-- !query schema
struct<>
-- !query output



-- !query
create table gstest2 (a integer, b integer, c integer, d integer,
                      e integer, f integer, g integer, h integer) using parquet
-- !query schema
struct<>
-- !query output



-- !query
insert into gstest2 values
  (1, 1, 1, 1, 1, 1, 1, 1),
  (1, 1, 1, 1, 1, 1, 1, 2),
  (1, 1, 1, 1, 1, 1, 2, 2),
  (1, 1, 1, 1, 1, 2, 2, 2),
  (1, 1, 1, 1, 2, 2, 2, 2),
  (1, 1, 1, 2, 2, 2, 2, 2),
  (1, 1, 2, 2, 2, 2, 2, 2),
  (1, 2, 2, 2, 2, 2, 2, 2),
  (2, 2, 2, 2, 2, 2, 2, 2)
-- !query schema
struct<>
-- !query output



-- !query
create table gstest3 (a integer, b integer, c integer, d integer) using parquet
-- !query schema
struct<>
-- !query output



-- !query
insert into gstest3 values
  (1, 1, 1, 1),
  (2, 2, 2, 2)
-- !query schema
struct<>
-- !query output



-- !query
create table gstest4(id integer, v integer,
                     unhashable_col /* bit(4) */ byte, unsortable_col /* xid */ integer) using parquet
-- !query schema
struct<>
-- !query output



-- !query
insert into gstest4
values (1,1,tinyint('0'),1), (2,2,tinyint('1'),1),
       (3,4,tinyint('2'),2), (4,8,tinyint('3'),2),
       (5,16,tinyint('0'),2), (6,32,tinyint('1'),2),
       (7,64,tinyint('2'),1), (8,128,tinyint('3'),1)
-- !query schema
struct<>
-- !query output



-- !query
create table gstest_empty (a integer, b integer, v integer) using parquet
-- !query schema
struct<>
-- !query output



-- !query
select a, b, grouping(a), grouping(b), sum(v), count(*), max(v)
  from gstest1 group by rollup (a,b)
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,count(1):bigint,max(v):int>
-- !query output
1	1	0	0	21	2	11
1	2	0	0	25	2	13
1	3	0	0	14	1	14
1	NULL	0	1	60	5	14
2	3	0	0	15	1	15
2	NULL	0	1	15	1	15
3	3	0	0	16	1	16
3	4	0	0	17	1	17
3	NULL	0	1	33	2	17
4	1	0	0	37	2	19
4	NULL	0	1	37	2	19
NULL	NULL	1	1	145	10	19


-- !query
select a, b, grouping(a), grouping(b), sum(v), count(*), max(v)
  from gstest1 group by rollup (a,b) order by a,b
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,count(1):bigint,max(v):int>
-- !query output
NULL	NULL	1	1	145	10	19
1	NULL	0	1	60	5	14
1	1	0	0	21	2	11
1	2	0	0	25	2	13
1	3	0	0	14	1	14
2	NULL	0	1	15	1	15
2	3	0	0	15	1	15
3	NULL	0	1	33	2	17
3	3	0	0	16	1	16
3	4	0	0	17	1	17
4	NULL	0	1	37	2	19
4	1	0	0	37	2	19


-- !query
select a, b, grouping(a), grouping(b), sum(v), count(*), max(v)
  from gstest1 group by rollup (a,b) order by b desc, a
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,count(1):bigint,max(v):int>
-- !query output
3	4	0	0	17	1	17
1	3	0	0	14	1	14
2	3	0	0	15	1	15
3	3	0	0	16	1	16
1	2	0	0	25	2	13
1	1	0	0	21	2	11
4	1	0	0	37	2	19
NULL	NULL	1	1	145	10	19
1	NULL	0	1	60	5	14
2	NULL	0	1	15	1	15
3	NULL	0	1	33	2	17
4	NULL	0	1	37	2	19


-- !query
select a, b, grouping(a), grouping(b), sum(v), count(*), max(v)
  from gstest1 group by rollup (a,b) order by coalesce(a,0)+coalesce(b,0), a
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,count(1):bigint,max(v):int>
-- !query output
NULL	NULL	1	1	145	10	19
1	NULL	0	1	60	5	14
1	1	0	0	21	2	11
2	NULL	0	1	15	1	15
1	2	0	0	25	2	13
3	NULL	0	1	33	2	17
1	3	0	0	14	1	14
4	NULL	0	1	37	2	19
2	3	0	0	15	1	15
4	1	0	0	37	2	19
3	3	0	0	16	1	16
3	4	0	0	17	1	17


-- !query
select a, b, sum(c), sum(sum(c)) over (order by a,b) as rsum
  from gstest2 group by rollup (a,b) order by rsum, a, b
-- !query schema
struct<a:int,b:int,sum(c):bigint,rsum:bigint>
-- !query output
NULL	NULL	12	12
1	NULL	10	22
1	1	8	30
1	2	2	32
2	NULL	2	34
2	2	2	36


-- !query
select a, b, sum(v), count(*) from gstest_empty group by grouping sets ((a,b),a)
-- !query schema
struct<a:int,b:int,sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select a, b, sum(v), count(*) from gstest_empty group by grouping sets ((a,b),())
-- !query schema
struct<a:int,b:int,sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select a, b, sum(v), count(*) from gstest_empty group by grouping sets ((a,b),(),(),())
-- !query schema
struct<a:int,b:int,sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select sum(v), count(*) from gstest_empty group by grouping sets ((),(),())
-- !query schema
struct<sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select t1.a, t2.b, sum(t1.v), count(*) from gstest_empty t1, gstest_empty t2
 group by grouping sets ((t1.a,t2.b),())
-- !query schema
struct<a:int,b:int,sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select t1.a, t2.b, grouping(t1.a), grouping(t2.b), sum(t1.v), max(t2.a)
  from gstest1 t1, gstest2 t2
 group by grouping sets ((t1.a, t2.b), ())
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,max(a):int>
-- !query output
1	1	0	0	420	1
1	2	0	0	120	2
2	1	0	0	105	1
2	2	0	0	30	2
3	1	0	0	231	1
3	2	0	0	66	2
4	1	0	0	259	1
4	2	0	0	74	2
NULL	NULL	1	1	1305	2


-- !query
select t1.a, t2.b, grouping(t1.a), grouping(t2.b), sum(t1.v), max(t2.a)
  from gstest1 t1 join gstest2 t2 on (t1.a=t2.a)
 group by grouping sets ((t1.a, t2.b), ())
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,max(a):int>
-- !query output
1	1	0	0	420	1
1	2	0	0	60	1
2	2	0	0	15	2
NULL	NULL	1	1	495	2


-- !query
select a, b, grouping(a), grouping(b), sum(t1.v), max(t2.c)
  from gstest1 t1 join gstest2 t2 using (a,b)
 group by grouping sets ((a, b), ())
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,max(c):int>
-- !query output
1	1	0	0	147	2
1	2	0	0	25	2
NULL	NULL	1	1	172	2


-- !query
select four, x
  from (select four, ten, 'foo' as x from tenk1) as t
  group by grouping sets (four, x)
  having x = 'foo'
-- !query schema
struct<four:int,x:string>
-- !query output
NULL	foo


-- !query
select four, x || 'x'
  from (select four, ten, 'foo' as x from tenk1) as t
  group by grouping sets (four, x)
  order by four
-- !query schema
struct<four:int,concat(x, x):string>
-- !query output
NULL	foox
0	NULL
1	NULL
2	NULL
3	NULL


-- !query
select (x+y)*1, sum(z)
 from (select 1 as x, 2 as y, 3 as z) s
 group by grouping sets (x+y, x)
-- !query schema
struct<((x + y) * 1):int,sum(z):bigint>
-- !query output
3	3
NULL	3


-- !query
CREATE TEMP VIEW int8_tbl AS SELECT * FROM VALUES
  (123L, 456L),
  (123L, 4567890123456789L),
  (4567890123456789L, 123L),
  (4567890123456789L, 4567890123456789L),
  (4567890123456789L, -4567890123456789L) as int8_tbl(q1, q2)
-- !query schema
struct<>
-- !query output



-- !query
select x, not x as not_x, q2 from
  (select *, q1 = 1 as x from int8_tbl i1) as t
  group by grouping sets(x, q2)
  order by x, q2
-- !query schema
struct<x:boolean,not_x:boolean,q2:bigint>
-- !query output
NULL	NULL	-4567890123456789
NULL	NULL	123
NULL	NULL	456
NULL	NULL	4567890123456789
false	true	NULL


-- !query
DROP VIEW int8_tbl
-- !query schema
struct<>
-- !query output



-- !query
select ten, sum(distinct four) from onek a
group by grouping sets((ten,four),(ten))
having exists (select 1 from onek b where sum(distinct a.four) = b.four)
-- !query schema
struct<ten:int,sum(DISTINCT four):bigint>
-- !query output
0	0
0	2
0	2
1	1
1	3
2	0
2	2
2	2
3	1
3	3
4	0
4	2
4	2
5	1
5	3
6	0
6	2
6	2
7	1
7	3
8	0
8	2
8	2
9	1
9	3


-- !query
select a,count(*) from gstest2 group by rollup(a) order by a
-- !query schema
struct<a:int,count(1):bigint>
-- !query output
NULL	9
1	8
2	1


-- !query
select a,count(*) from gstest2 group by rollup(a) having a is distinct from 1 order by a
-- !query schema
struct<a:int,count(1):bigint>
-- !query output
NULL	9
2	1


-- !query
select ten, grouping(ten) from onek
group by grouping sets(ten) having grouping(ten) >= 0
order by 2,1
-- !query schema
struct<ten:int,grouping(ten):tinyint>
-- !query output
0	0
1	0
2	0
3	0
4	0
5	0
6	0
7	0
8	0
9	0


-- !query
select ten, grouping(ten) from onek
group by grouping sets(ten, four) having grouping(ten) > 0
order by 2,1
-- !query schema
struct<ten:int,grouping(ten):tinyint>
-- !query output
NULL	1
NULL	1
NULL	1
NULL	1


-- !query
select ten, grouping(ten) from onek
group by rollup(ten) having grouping(ten) > 0
order by 2,1
-- !query schema
struct<ten:int,grouping(ten):tinyint>
-- !query output
NULL	1


-- !query
select ten, grouping(ten) from onek
group by cube(ten) having grouping(ten) > 0
order by 2,1
-- !query schema
struct<ten:int,grouping(ten):tinyint>
-- !query output
NULL	1


-- !query
select ten, sum(distinct four) filter (where string(four) like '123') from onek a
group by rollup(ten)
-- !query schema
struct<ten:int,sum(DISTINCT four) FILTER (WHERE four LIKE 123):bigint>
-- !query output
0	NULL
1	NULL
2	NULL
3	NULL
4	NULL
5	NULL
6	NULL
7	NULL
8	NULL
9	NULL
NULL	NULL


-- !query
select count(*) from gstest4 group by rollup(unhashable_col,unsortable_col)
-- !query schema
struct<count(1):bigint>
-- !query output
1
1
1
1
1
1
1
1
2
2
2
2
8


-- !query
select a, b, grouping(a), grouping(b), sum(v), count(*), max(v)
  from gstest1 group by grouping sets ((a),(b)) order by 3,4,1,2 /* 3,1,2 */
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,count(1):bigint,max(v):int>
-- !query output
1	NULL	0	1	60	5	14
2	NULL	0	1	15	1	15
3	NULL	0	1	33	2	17
4	NULL	0	1	37	2	19
NULL	1	1	0	58	4	19
NULL	2	1	0	25	2	13
NULL	3	1	0	45	3	16
NULL	4	1	0	17	1	17


-- !query
select a, b, grouping(a), grouping(b), sum(v), count(*), max(v)
  from gstest1 group by cube(a,b) order by 3,4,1,2 /* 3,1,2 */
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,count(1):bigint,max(v):int>
-- !query output
1	1	0	0	21	2	11
1	2	0	0	25	2	13
1	3	0	0	14	1	14
2	3	0	0	15	1	15
3	3	0	0	16	1	16
3	4	0	0	17	1	17
4	1	0	0	37	2	19
1	NULL	0	1	60	5	14
2	NULL	0	1	15	1	15
3	NULL	0	1	33	2	17
4	NULL	0	1	37	2	19
NULL	1	1	0	58	4	19
NULL	2	1	0	25	2	13
NULL	3	1	0	45	3	16
NULL	4	1	0	17	1	17
NULL	NULL	1	1	145	10	19


-- !query
select unsortable_col, count(*)
  from gstest4 group by grouping sets ((unsortable_col),(unsortable_col))
  order by string(unsortable_col)
-- !query schema
struct<unsortable_col:int,count(1):bigint>
-- !query output
1	4
1	4
2	4
2	4


-- !query
select unhashable_col, unsortable_col,
       grouping(unhashable_col), grouping(unsortable_col),
       count(*), sum(v)
  from gstest4 group by grouping sets ((unhashable_col),(unsortable_col))
 order by 3, 4, 6 /* 3, 5 */
-- !query schema
struct<unhashable_col:tinyint,unsortable_col:int,grouping(unhashable_col):tinyint,grouping(unsortable_col):tinyint,count(1):bigint,sum(v):bigint>
-- !query output
0	NULL	0	1	2	17
1	NULL	0	1	2	34
2	NULL	0	1	2	68
3	NULL	0	1	2	136
NULL	2	1	0	4	60
NULL	1	1	0	4	195


-- !query
select unhashable_col, unsortable_col,
       grouping(unhashable_col), grouping(unsortable_col),
       count(*), sum(v)
  from gstest4 group by grouping sets ((v,unhashable_col),(v,unsortable_col))
 order by 3, 4, 6 /* 3,5 */
-- !query schema
struct<unhashable_col:tinyint,unsortable_col:int,grouping(unhashable_col):tinyint,grouping(unsortable_col):tinyint,count(1):bigint,sum(v):bigint>
-- !query output
0	NULL	0	1	1	1
1	NULL	0	1	1	2
2	NULL	0	1	1	4
3	NULL	0	1	1	8
0	NULL	0	1	1	16
1	NULL	0	1	1	32
2	NULL	0	1	1	64
3	NULL	0	1	1	128
NULL	1	1	0	1	1
NULL	1	1	0	1	2
NULL	2	1	0	1	4
NULL	2	1	0	1	8
NULL	2	1	0	1	16
NULL	2	1	0	1	32
NULL	1	1	0	1	64
NULL	1	1	0	1	128


-- !query
select a, b, sum(v), count(*) from gstest_empty group by grouping sets ((a,b),a)
-- !query schema
struct<a:int,b:int,sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select a, b, sum(v), count(*) from gstest_empty group by grouping sets ((a,b),())
-- !query schema
struct<a:int,b:int,sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select a, b, sum(v), count(*) from gstest_empty group by grouping sets ((a,b),(),(),())
-- !query schema
struct<a:int,b:int,sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select sum(v), count(*) from gstest_empty group by grouping sets ((),(),())
-- !query schema
struct<sum(v):bigint,count(1):bigint>
-- !query output



-- !query
select a, b, grouping(a), grouping(b), sum(v), count(*), max(v)
  from gstest1 group by grouping sets ((a,b),(a+1,b+1),(a+2,b+2)) order by 3,4,7 /* 3,6 */
-- !query schema
struct<a:int,b:int,grouping(a):tinyint,grouping(b):tinyint,sum(v):bigint,count(1):bigint,max(v):int>
-- !query output
1	1	0	0	21	2	11
1	2	0	0	25	2	13
1	3	0	0	14	1	14
2	3	0	0	15	1	15
3	3	0	0	16	1	16
3	4	0	0	17	1	17
4	1	0	0	37	2	19
NULL	NULL	1	1	21	2	11
NULL	NULL	1	1	21	2	11
NULL	NULL	1	1	25	2	13
NULL	NULL	1	1	25	2	13
NULL	NULL	1	1	14	1	14
NULL	NULL	1	1	14	1	14
NULL	NULL	1	1	15	1	15
NULL	NULL	1	1	15	1	15
NULL	NULL	1	1	16	1	16
NULL	NULL	1	1	16	1	16
NULL	NULL	1	1	17	1	17
NULL	NULL	1	1	17	1	17
NULL	NULL	1	1	37	2	19
NULL	NULL	1	1	37	2	19


-- !query
select a, b, sum(c), sum(sum(c)) over (order by a,b) as rsum
  from gstest2 group by cube (a,b) order by rsum, a, b
-- !query schema
struct<a:int,b:int,sum(c):bigint,rsum:bigint>
-- !query output
NULL	NULL	12	12
NULL	1	8	20
NULL	2	4	24
1	NULL	10	34
1	1	8	42
1	2	2	44
2	NULL	2	46
2	2	2	48


-- !query
SELECT a, b, count(*), max(a), max(b) FROM gstest3 GROUP BY GROUPING SETS(a, b,()) ORDER BY a, b
-- !query schema
struct<a:int,b:int,count(1):bigint,max(a):int,max(b):int>
-- !query output
NULL	NULL	2	2	2
NULL	1	1	1	1
NULL	2	1	2	2
1	NULL	1	1	1
2	NULL	1	2	2


-- !query
select v||'a', case grouping(v||'a') when 1 then 1 else 0 end, count(*)
  from values (1, 'a'), (1, 'b') u(i,v)
 group by rollup(i, v||'a') order by 1,3
-- !query schema
struct<concat(v, a):string,CASE WHEN (grouping(concat(v, a)) = 1) THEN 1 ELSE 0 END:int,count(1):bigint>
-- !query output
NULL	1	2
NULL	1	2
aa	0	1
ba	0	1


-- !query
select v||'a', case when grouping(v||'a') = 1 then 1 else 0 end, count(*)
  from values (1, 'a'), (1, 'b') u(i,v)
 group by rollup(i, v||'a') order by 1,3
-- !query schema
struct<concat(v, a):string,CASE WHEN (grouping(concat(v, a)) = 1) THEN 1 ELSE 0 END:int,count(1):bigint>
-- !query output
NULL	1	2
NULL	1	2
aa	0	1
ba	0	1


-- !query
DROP VIEW gstest1
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE gstest2
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE gstest3
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE gstest4
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE gstest_empty
-- !query schema
struct<>
-- !query output

