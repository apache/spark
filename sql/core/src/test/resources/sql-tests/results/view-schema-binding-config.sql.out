-- Automatically generated by SQLQueryTestSuite
-- !query
SET spark.sql.legacy.viewSchemaBindingMode
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.legacy.viewSchemaBindingMode	true


-- !query
SET spark.sql.legacy.viewSchemaBindingMode = false
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.legacy.viewSchemaBindingMode	false


-- !query
CREATE OR REPLACE VIEW v WITH SCHEMA BINDING AS SELECT 1
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.parser.ParseException
{
  "errorClass" : "FEATURE_NOT_ENABLED",
  "sqlState" : "56038",
  "messageParameters" : {
    "configKey" : "spark.sql.legacy.viewSchemaBindingMode",
    "configValue" : "true",
    "featureName" : "VIEW ... WITH SCHEMA ..."
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 26,
    "stopIndex" : 44,
    "fragment" : "WITH SCHEMA BINDING"
  } ]
}


-- !query
CREATE OR REPLACE VIEW v WITH SCHEMA COMPENSATION AS SELECT 1
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.parser.ParseException
{
  "errorClass" : "FEATURE_NOT_ENABLED",
  "sqlState" : "56038",
  "messageParameters" : {
    "configKey" : "spark.sql.legacy.viewSchemaBindingMode",
    "configValue" : "true",
    "featureName" : "VIEW ... WITH SCHEMA ..."
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 26,
    "stopIndex" : 49,
    "fragment" : "WITH SCHEMA COMPENSATION"
  } ]
}


-- !query
CREATE OR REPLACE VIEW v WITH SCHEMA TYPE EVOLUTION AS SELECT 1
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.parser.ParseException
{
  "errorClass" : "FEATURE_NOT_ENABLED",
  "sqlState" : "56038",
  "messageParameters" : {
    "configKey" : "spark.sql.legacy.viewSchemaBindingMode",
    "configValue" : "true",
    "featureName" : "VIEW ... WITH SCHEMA ..."
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 26,
    "stopIndex" : 51,
    "fragment" : "WITH SCHEMA TYPE EVOLUTION"
  } ]
}


-- !query
CREATE OR REPLACE VIEW v WITH SCHEMA EVOLUTION AS SELECT 1
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.parser.ParseException
{
  "errorClass" : "FEATURE_NOT_ENABLED",
  "sqlState" : "56038",
  "messageParameters" : {
    "configKey" : "spark.sql.legacy.viewSchemaBindingMode",
    "configValue" : "true",
    "featureName" : "VIEW ... WITH SCHEMA ..."
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 26,
    "stopIndex" : 46,
    "fragment" : "WITH SCHEMA EVOLUTION"
  } ]
}


-- !query
CREATE OR REPLACE VIEW v AS SELECT 1
-- !query schema
struct<>
-- !query output



-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
1                   	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT 1            	                    
View Original Text  	SELECT 1            	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[1]


-- !query
SHOW TABLE EXTENDED LIKE 'v'
-- !query schema
struct<namespace:string,tableName:string,isTemporary:boolean,information:string>
-- !query output
default	v	false	Catalog: spark_catalog
Database: default
Table: v
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type: VIEW
View Text: SELECT 1
View Original Text: SELECT 1
View Catalog and Namespace: spark_catalog.default
View Query Output Columns: [1]
Schema: root
 |-- 1: integer (nullable = false)


-- !query
SHOW CREATE TABLE v
-- !query schema
struct<createtab_stmt:string>
-- !query output
CREATE VIEW default.v (
  `1`)
AS SELECT 1


-- !query
DROP VIEW IF EXISTS v
-- !query schema
struct<>
-- !query output



-- !query
CREATE OR REPLACE TEMPORARY VIEW v AS SELECT 1
-- !query schema
struct<>
-- !query output



-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
1                   	int


-- !query
SHOW TABLE EXTENDED LIKE 'v'
-- !query schema
struct<namespace:string,tableName:string,isTemporary:boolean,information:string>
-- !query output
	v	true	Table: v
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type: VIEW
View Text: SELECT 1
View Catalog and Namespace: spark_catalog.default
View Query Output Columns: [1]
Schema: root
 |-- 1: integer (nullable = false)


-- !query
DROP VIEW IF EXISTS v
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 INT NOT NULL) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
CREATE OR REPLACE VIEW v AS SELECT * FROM t
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<c1:int>
-- !query output



-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1]


-- !query
SHOW CREATE TABLE v
-- !query schema
struct<createtab_stmt:string>
-- !query output
CREATE VIEW default.v (
  c1)
AS SELECT * FROM t


-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 BIGINT NOT NULL) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<c1:int>
-- !query output



-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1]


-- !query
SET spark.sql.legacy.viewSchemaBindingMode = true
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.legacy.viewSchemaBindingMode	true


-- !query
SET spark.sql.legacy.viewSchemaCompensation = false
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.legacy.viewSchemaCompensation	false


-- !query
SET spark.sql.ansi.enabled = false
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.ansi.enabled	false


-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 INT NOT NULL) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
CREATE OR REPLACE VIEW v AS SELECT * FROM t
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<c1:int>
-- !query output



-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	BINDING             	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1]


-- !query
SHOW CREATE TABLE v
-- !query schema
struct<createtab_stmt:string>
-- !query output
CREATE VIEW default.v (
  c1)
WITH SCHEMA BINDING
AS SELECT * FROM t


-- !query
DROP TABLE t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 BIGINT NOT NULL) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
INSERT INTO t VALUES (1)
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "CANNOT_UP_CAST_DATATYPE",
  "sqlState" : "42846",
  "messageParameters" : {
    "details" : "The type path of the target object is:\n\nYou can either add an explicit cast to the input data or choose a higher precision type of the field in the target object",
    "expression" : "spark_catalog.default.t.c1",
    "sourceType" : "\"BIGINT\"",
    "targetType" : "\"INT\""
  }
}


-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	BINDING             	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1]


-- !query
SHOW CREATE TABLE v
-- !query schema
struct<createtab_stmt:string>
-- !query output
CREATE VIEW default.v (
  c1)
WITH SCHEMA BINDING
AS SELECT * FROM t


-- !query
SET spark.sql.legacy.viewSchemaCompensation = true
-- !query schema
struct<key:string,value:string>
-- !query output
spark.sql.legacy.viewSchemaCompensation	true


-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 INT NOT NULL) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
CREATE OR REPLACE VIEW v AS SELECT * FROM t
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<c1:int>
-- !query output



-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	COMPENSATION        	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1]


-- !query
SHOW CREATE TABLE v
-- !query schema
struct<createtab_stmt:string>
-- !query output
CREATE VIEW default.v (
  c1)
WITH SCHEMA COMPENSATION
AS SELECT * FROM t


-- !query
DROP TABLE t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 BIGINT NOT NULL) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
INSERT INTO t VALUES (1)
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<c1:int>
-- !query output
1


-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	COMPENSATION        	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1]


-- !query
SHOW CREATE TABLE v
-- !query schema
struct<createtab_stmt:string>
-- !query output
CREATE VIEW default.v (
  c1)
WITH SCHEMA COMPENSATION
AS SELECT * FROM t


-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 STRING NOT NULL, c2 INT) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
INSERT INTO t VALUES ('1', 2)
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<c1:int>
-- !query output
1


-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	COMPENSATION        	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1]


-- !query
INSERT INTO t VALUES ('a', 2)
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<>
-- !query output
org.apache.spark.SparkNumberFormatException
{
  "errorClass" : "CAST_INVALID_INPUT",
  "sqlState" : "22018",
  "messageParameters" : {
    "ansiConfig" : "\"spark.sql.ansi.enabled\"",
    "expression" : "'a'",
    "sourceType" : "\"STRING\"",
    "targetType" : "\"INT\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 15,
    "fragment" : "v"
  } ]
}


-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 MAP<STRING, STRING>, c2 INT) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.CAST_WITHOUT_SUGGESTION",
  "sqlState" : "42K09",
  "messageParameters" : {
    "sqlExpr" : "\"c1\"",
    "srcType" : "\"MAP<STRING, STRING>\"",
    "targetType" : "\"INT\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 15,
    "fragment" : "v"
  } ]
}


-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	COMPENSATION        	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1]


-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 INT, c2 INT) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
INSERT INTO t VALUES (1, 2)
-- !query schema
struct<>
-- !query output



-- !query
CREATE OR REPLACE VIEW v AS SELECT * FROM t
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<c1:int,c2:int>
-- !query output
1	2


-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
c2                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	COMPENSATION        	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1, c2]


-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c1 INT NOT NULL) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "INCOMPATIBLE_VIEW_SCHEMA_CHANGE",
  "sqlState" : "51024",
  "messageParameters" : {
    "actualCols" : "[]",
    "colName" : "c2",
    "expectedNum" : "1",
    "suggestion" : "CREATE OR REPLACE VIEW spark_catalog.default.v AS SELECT * FROM t",
    "viewName" : "`spark_catalog`.`default`.`v`"
  }
}


-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
c2                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	COMPENSATION        	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1, c2]


-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output



-- !query
CREATE TABLE t(c3 INT NOT NULL, c2 INT) USING PARQUET
-- !query schema
struct<>
-- !query output



-- !query
SELECT * FROM v
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "INCOMPATIBLE_VIEW_SCHEMA_CHANGE",
  "sqlState" : "51024",
  "messageParameters" : {
    "actualCols" : "[]",
    "colName" : "c1",
    "expectedNum" : "1",
    "suggestion" : "CREATE OR REPLACE VIEW spark_catalog.default.v AS SELECT * FROM t",
    "viewName" : "`spark_catalog`.`default`.`v`"
  }
}


-- !query
DESCRIBE EXTENDED v
-- !query schema
struct<col_name:string,data_type:string,comment:string>
-- !query output
c1                  	int                 	                    
c2                  	int                 	                    
                    	                    	                    
# Detailed Table Information	                    	                    
Catalog             	spark_catalog       	                    
Database            	default             	                    
Table               	v                   	                    
Created Time [not included in comparison]
Last Access [not included in comparison]
Created By [not included in comparison]
Type                	VIEW                	                    
View Text           	SELECT * FROM t     	                    
View Original Text  	SELECT * FROM t     	                    
View Schema Mode    	COMPENSATION        	                    
View Catalog and Namespace	spark_catalog.default	                    
View Query Output Columns	[c1, c2]


-- !query
DROP VIEW IF EXISTS v
-- !query schema
struct<>
-- !query output



-- !query
DROP TABLE IF EXISTS t
-- !query schema
struct<>
-- !query output

