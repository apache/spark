-- Automatically generated by SQLQueryTestSuite
-- !query
create temporary view t1 as select * from values
  ("one", 1),
  ("two", 2),
  ("three", 3),
  ("one", NULL)
  as t1(k, v)
-- !query schema
struct<>
-- !query output



-- !query
create temporary view t2 as select * from values
  ("one", 1),
  ("two", 22),
  ("one", 5),
  ("one", NULL),
  (NULL, 5)
  as t2(k, v)
-- !query schema
struct<>
-- !query output



-- !query
SELECT udf(k), udf(v) FROM t1 EXCEPT SELECT udf(k), udf(v) FROM t2
-- !query schema
struct<udf(k):string,udf(v):int>
-- !query output
three	3
two	2


-- !query
SELECT * FROM t1 EXCEPT SELECT * FROM t1 where udf(v) <> 1 and v <> udf(2)
-- !query schema
struct<k:string,v:int>
-- !query output
one	1
one	NULL
two	2


-- !query
SELECT * FROM t1 where udf(v) <> 1 and v <> udf(22) EXCEPT SELECT * FROM t1 where udf(v) <> 2 and v >= udf(3)
-- !query schema
struct<k:string,v:int>
-- !query output
two	2


-- !query
SELECT t1.* FROM t1, t2 where t1.k = t2.k
EXCEPT
SELECT t1.* FROM t1, t2 where t1.k = t2.k and t1.k != udf('one')
-- !query schema
struct<k:string,v:int>
-- !query output
one	1
one	NULL


-- !query
SELECT * FROM t2 where v >= udf(1) and udf(v) <> 22 EXCEPT SELECT * FROM t1
-- !query schema
struct<k:string,v:int>
-- !query output
NULL	5
one	5


-- !query
SELECT (SELECT min(udf(k)) FROM t2 WHERE t2.k = t1.k) min_t2 FROM t1
MINUS
SELECT (SELECT udf(min(k)) FROM t2) abs_min_t2 FROM t1 WHERE  t1.k = udf('one')
-- !query schema
struct<min_t2:string>
-- !query output
NULL
two


-- !query
SELECT t1.k
FROM   t1
WHERE  t1.v <= (SELECT   udf(max(udf(t2.v)))
                FROM     t2
                WHERE    udf(t2.k) = udf(t1.k))
MINUS
SELECT t1.k
FROM   t1
WHERE  udf(t1.v) >= (SELECT   min(udf(t2.v))
                FROM     t2
                WHERE    t2.k = t1.k)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Correlated column is not allowed in predicate (CAST(udf(cast(k as string)) AS STRING) = CAST(udf(cast(outer(k#x) as string)) AS STRING)):
Aggregate [cast(udf(cast(max(cast(udf(cast(v#x as string)) as int)) as string)) as int) AS udf(max(udf(v)))#x]
+- Filter (cast(udf(cast(k#x as string)) as string) = cast(udf(cast(outer(k#x) as string)) as string))
   +- SubqueryAlias t2
      +- View (`t2`, [k#x,v#x])
         +- Project [cast(k#x as string) AS k#x, cast(v#x as int) AS v#x]
            +- Project [k#x, v#x]
               +- SubqueryAlias t2
                  +- LocalRelation [k#x, v#x]
