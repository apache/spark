-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE TEMPORARY VIEW m AS SELECT * FROM VALUES
  (null, null),
  (null, 1.0),
  (2, 3.0),
  (4, 5.0)
  AS m(a, b)
-- !query analysis
CreateViewCommand `m`, SELECT * FROM VALUES
  (null, null),
  (null, 1.0),
  (2, 3.0),
  (4, 5.0)
  AS m(a, b), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [a#x, b#x]
      +- SubqueryAlias m
         +- LocalRelation [a#x, b#x]


-- !query
CREATE TEMPORARY VIEW s AS SELECT * FROM VALUES
  (null, null),
  (0, 1.0),
  (2, 3.0),
  (4, null)
  AS s(c, d)
-- !query analysis
CreateViewCommand `s`, SELECT * FROM VALUES
  (null, null),
  (0, 1.0),
  (2, 3.0),
  (4, null)
  AS s(c, d), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [c#x, d#x]
      +- SubqueryAlias s
         +- LocalRelation [c#x, d#x]


-- !query
SELECT *
FROM   m
WHERE  (a, b) NOT IN (SELECT *
                      FROM   s
                      WHERE  d > 5.0) -- Matches no rows
-- !query analysis
Project [a#x, b#x]
+- Filter NOT named_struct(a, a#x, b, b#x) IN (list#x [])
   :  +- Project [c#x, d#x]
   :     +- Filter (d#x > 5.0)
   :        +- SubqueryAlias s
   :           +- View (`s`, [c#x, d#x])
   :              +- Project [cast(c#x as int) AS c#x, cast(d#x as decimal(2,1)) AS d#x]
   :                 +- Project [c#x, d#x]
   :                    +- SubqueryAlias s
   :                       +- LocalRelation [c#x, d#x]
   +- SubqueryAlias m
      +- View (`m`, [a#x, b#x])
         +- Project [cast(a#x as int) AS a#x, cast(b#x as decimal(2,1)) AS b#x]
            +- Project [a#x, b#x]
               +- SubqueryAlias m
                  +- LocalRelation [a#x, b#x]


-- !query
SELECT *
FROM   m
WHERE  (a, b) NOT IN (SELECT *
                      FROM s
                      WHERE c IS NULL AND d IS NULL) -- Matches only (null, null)
-- !query analysis
Project [a#x, b#x]
+- Filter NOT named_struct(a, a#x, b, b#x) IN (list#x [])
   :  +- Project [c#x, d#x]
   :     +- Filter (isnull(c#x) AND isnull(d#x))
   :        +- SubqueryAlias s
   :           +- View (`s`, [c#x, d#x])
   :              +- Project [cast(c#x as int) AS c#x, cast(d#x as decimal(2,1)) AS d#x]
   :                 +- Project [c#x, d#x]
   :                    +- SubqueryAlias s
   :                       +- LocalRelation [c#x, d#x]
   +- SubqueryAlias m
      +- View (`m`, [a#x, b#x])
         +- Project [cast(a#x as int) AS a#x, cast(b#x as decimal(2,1)) AS b#x]
            +- Project [a#x, b#x]
               +- SubqueryAlias m
                  +- LocalRelation [a#x, b#x]


-- !query
SELECT *
FROM   m
WHERE  a IS NULL AND b IS NULL -- Matches only (null, null)
       AND (a, b) NOT IN (SELECT *
                          FROM s
                          WHERE c IS NOT NULL) -- Matches (0, 1.0), (2, 3.0), (4, null)
-- !query analysis
Project [a#x, b#x]
+- Filter ((isnull(a#x) AND isnull(b#x)) AND NOT named_struct(a, a#x, b, b#x) IN (list#x []))
   :  +- Project [c#x, d#x]
   :     +- Filter isnotnull(c#x)
   :        +- SubqueryAlias s
   :           +- View (`s`, [c#x, d#x])
   :              +- Project [cast(c#x as int) AS c#x, cast(d#x as decimal(2,1)) AS d#x]
   :                 +- Project [c#x, d#x]
   :                    +- SubqueryAlias s
   :                       +- LocalRelation [c#x, d#x]
   +- SubqueryAlias m
      +- View (`m`, [a#x, b#x])
         +- Project [cast(a#x as int) AS a#x, cast(b#x as decimal(2,1)) AS b#x]
            +- Project [a#x, b#x]
               +- SubqueryAlias m
                  +- LocalRelation [a#x, b#x]


-- !query
SELECT *
FROM   m
WHERE  b = 1.0 -- Matches (null, 1.0)
       AND (a, b) NOT IN (SELECT *
                          FROM s
                          WHERE c IS NOT NULL) -- Matches (0, 1.0), (2, 3.0), (4, null)
-- !query analysis
Project [a#x, b#x]
+- Filter ((b#x = 1.0) AND NOT named_struct(a, a#x, b, b#x) IN (list#x []))
   :  +- Project [c#x, d#x]
   :     +- Filter isnotnull(c#x)
   :        +- SubqueryAlias s
   :           +- View (`s`, [c#x, d#x])
   :              +- Project [cast(c#x as int) AS c#x, cast(d#x as decimal(2,1)) AS d#x]
   :                 +- Project [c#x, d#x]
   :                    +- SubqueryAlias s
   :                       +- LocalRelation [c#x, d#x]
   +- SubqueryAlias m
      +- View (`m`, [a#x, b#x])
         +- Project [cast(a#x as int) AS a#x, cast(b#x as decimal(2,1)) AS b#x]
            +- Project [a#x, b#x]
               +- SubqueryAlias m
                  +- LocalRelation [a#x, b#x]


-- !query
SELECT *
FROM   m
WHERE  b = 1.0 -- Matches (null, 1.0)
       AND (a, b) NOT IN (SELECT *
                          FROM s
                          WHERE c = 2) -- Matches (2, 3.0)
-- !query analysis
Project [a#x, b#x]
+- Filter ((b#x = 1.0) AND NOT named_struct(a, a#x, b, b#x) IN (list#x []))
   :  +- Project [c#x, d#x]
   :     +- Filter (c#x = 2)
   :        +- SubqueryAlias s
   :           +- View (`s`, [c#x, d#x])
   :              +- Project [cast(c#x as int) AS c#x, cast(d#x as decimal(2,1)) AS d#x]
   :                 +- Project [c#x, d#x]
   :                    +- SubqueryAlias s
   :                       +- LocalRelation [c#x, d#x]
   +- SubqueryAlias m
      +- View (`m`, [a#x, b#x])
         +- Project [cast(a#x as int) AS a#x, cast(b#x as decimal(2,1)) AS b#x]
            +- Project [a#x, b#x]
               +- SubqueryAlias m
                  +- LocalRelation [a#x, b#x]


-- !query
SELECT *
FROM   m
WHERE  b = 3.0 -- Matches (2, 3.0)
       AND (a, b) NOT IN (SELECT *
                          FROM s
                          WHERE c = 2) -- Matches (2, 3.0)
-- !query analysis
Project [a#x, b#x]
+- Filter ((b#x = 3.0) AND NOT named_struct(a, a#x, b, b#x) IN (list#x []))
   :  +- Project [c#x, d#x]
   :     +- Filter (c#x = 2)
   :        +- SubqueryAlias s
   :           +- View (`s`, [c#x, d#x])
   :              +- Project [cast(c#x as int) AS c#x, cast(d#x as decimal(2,1)) AS d#x]
   :                 +- Project [c#x, d#x]
   :                    +- SubqueryAlias s
   :                       +- LocalRelation [c#x, d#x]
   +- SubqueryAlias m
      +- View (`m`, [a#x, b#x])
         +- Project [cast(a#x as int) AS a#x, cast(b#x as decimal(2,1)) AS b#x]
            +- Project [a#x, b#x]
               +- SubqueryAlias m
                  +- LocalRelation [a#x, b#x]


-- !query
SELECT *
FROM   m
WHERE  b = 5.0 -- Matches (4, 5.0)
       AND (a, b) NOT IN (SELECT *
                          FROM s
                          WHERE c = 2) -- Matches (2, 3.0)
-- !query analysis
Project [a#x, b#x]
+- Filter ((b#x = 5.0) AND NOT named_struct(a, a#x, b, b#x) IN (list#x []))
   :  +- Project [c#x, d#x]
   :     +- Filter (c#x = 2)
   :        +- SubqueryAlias s
   :           +- View (`s`, [c#x, d#x])
   :              +- Project [cast(c#x as int) AS c#x, cast(d#x as decimal(2,1)) AS d#x]
   :                 +- Project [c#x, d#x]
   :                    +- SubqueryAlias s
   :                       +- LocalRelation [c#x, d#x]
   +- SubqueryAlias m
      +- View (`m`, [a#x, b#x])
         +- Project [cast(a#x as int) AS a#x, cast(b#x as decimal(2,1)) AS b#x]
            +- Project [a#x, b#x]
               +- SubqueryAlias m
                  +- LocalRelation [a#x, b#x]
