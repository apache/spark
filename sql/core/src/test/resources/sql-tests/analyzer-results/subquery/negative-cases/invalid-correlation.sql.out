-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE TEMPORARY VIEW t1 AS SELECT * FROM VALUES
  (1, 2, 3)
AS t1(t1a, t1b, t1c)
-- !query analysis
CreateViewCommand `t1`, SELECT * FROM VALUES
  (1, 2, 3)
AS t1(t1a, t1b, t1c), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [t1a#x, t1b#x, t1c#x]
      +- SubqueryAlias t1
         +- LocalRelation [t1a#x, t1b#x, t1c#x]


-- !query
CREATE TEMPORARY VIEW t2 AS SELECT * FROM VALUES
  (1, 0, 1)
AS t2(t2a, t2b, t2c)
-- !query analysis
CreateViewCommand `t2`, SELECT * FROM VALUES
  (1, 0, 1)
AS t2(t2a, t2b, t2c), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [t2a#x, t2b#x, t2c#x]
      +- SubqueryAlias t2
         +- LocalRelation [t2a#x, t2b#x, t2c#x]


-- !query
CREATE TEMPORARY VIEW t3 AS SELECT * FROM VALUES
  (3, 1, 2)
AS t3(t3a, t3b, t3c)
-- !query analysis
CreateViewCommand `t3`, SELECT * FROM VALUES
  (3, 1, 2)
AS t3(t3a, t3b, t3c), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [t3a#x, t3b#x, t3c#x]
      +- SubqueryAlias t3
         +- LocalRelation [t3a#x, t3b#x, t3c#x]


-- !query
SELECT t1a, t2b
FROM   t1, t2
WHERE  t1b = t2c
AND    t2b = (SELECT max(avg)
              FROM   (SELECT   t2b, avg(t2b) avg
                      FROM     t2
                      WHERE    t2a = t1.t1b
                     )
             )
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "condition" : "MISSING_GROUP_BY",
  "sqlState" : "42803",
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 100,
    "stopIndex" : 203,
    "fragment" : "SELECT   t2b, avg(t2b) avg\n                      FROM     t2\n                      WHERE    t2a = t1.t1b"
  } ]
}


-- !query
SELECT *
FROM   t1
WHERE  t1a IN (SELECT   min(t2a)
               FROM     t2
               GROUP BY t2c
               HAVING   t2c IN (SELECT   max(t3c)
                                FROM     t3
                                GROUP BY t3b
                                HAVING   t3b > t2b ))
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "condition" : "MISSING_ATTRIBUTES.RESOLVED_ATTRIBUTE_MISSING_FROM_INPUT",
  "sqlState" : "XX000",
  "messageParameters" : {
    "input" : "\"min(t2a)\", \"t2c\"",
    "missingAttributes" : "\"t2b\"",
    "operator" : "!Filter t2c#x IN (list#x [t2b#x])"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 35,
    "stopIndex" : 298,
    "fragment" : "SELECT   min(t2a)\n               FROM     t2\n               GROUP BY t2c\n               HAVING   t2c IN (SELECT   max(t3c)\n                                FROM     t3\n                                GROUP BY t3b\n                                HAVING   t3b > t2b )"
  } ]
}


-- !query
SELECT t1a 
FROM   t1
GROUP  BY 1
HAVING EXISTS (SELECT t2a
               FROM  t2
               GROUP BY 1
               HAVING t2a < min(t1a + t2a))
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "condition" : "UNSUPPORTED_SUBQUERY_EXPRESSION_CATEGORY.AGGREGATE_FUNCTION_MIXED_OUTER_LOCAL_REFERENCES",
  "sqlState" : "0A000",
  "messageParameters" : {
    "function" : "min((outer(t1.t1a) + t2.t2a))"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 139,
    "stopIndex" : 152,
    "fragment" : "min(t1a + t2a)"
  } ]
}


-- !query
SELECT t1a 
FROM   t1
WHERE  t1a IN (SELECT t2a 
               FROM   t2
               WHERE  EXISTS (SELECT 1 
                              FROM   t3
                              GROUP BY 1
                              HAVING min(t2a + t3a) > 1))
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "condition" : "UNSUPPORTED_SUBQUERY_EXPRESSION_CATEGORY.AGGREGATE_FUNCTION_MIXED_OUTER_LOCAL_REFERENCES",
  "sqlState" : "0A000",
  "messageParameters" : {
    "function" : "min((outer(t2.t2a) + t3.t3a))"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 233,
    "stopIndex" : 246,
    "fragment" : "min(t2a + t3a)"
  } ]
}


-- !query
SELECT t1a 
FROM   t1
WHERE  t1a IN (SELECT t2a 
               FROM   t2
               WHERE  EXISTS (SELECT min(t2a) 
                              FROM   t3))
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "condition" : "UNSUPPORTED_SUBQUERY_EXPRESSION_CATEGORY.CORRELATED_REFERENCE",
  "sqlState" : "0A000",
  "messageParameters" : {
    "sqlExprs" : "\"min(t2a) AS `min(outer(t2.t2a))`\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 105,
    "stopIndex" : 160,
    "fragment" : "SELECT min(t2a) \n                              FROM   t3"
  } ]
}


-- !query
CREATE TEMPORARY VIEW t1_copy AS SELECT * FROM VALUES
  (1, 2, 3)
AS t1(t1a, t1b, t1c)
-- !query analysis
CreateViewCommand `t1_copy`, SELECT * FROM VALUES
  (1, 2, 3)
AS t1(t1a, t1b, t1c), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [t1a#x, t1b#x, t1c#x]
      +- SubqueryAlias t1
         +- LocalRelation [t1a#x, t1b#x, t1c#x]


-- !query
SELECT t1.t1a
FROM   t1
JOIN   t1_copy
ON     EXISTS (SELECT 1 FROM t2 WHERE t2a > t1a)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "condition" : "UNRESOLVED_COLUMN.WITH_SUGGESTION",
  "sqlState" : "42703",
  "messageParameters" : {
    "objectName" : "`t1a`",
    "proposal" : "`t2a`, `t2b`, `t2c`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 84,
    "stopIndex" : 86,
    "fragment" : "t1a"
  } ]
}
