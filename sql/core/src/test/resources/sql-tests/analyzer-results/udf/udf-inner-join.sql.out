-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE TEMPORARY VIEW t1 AS SELECT * FROM VALUES (1) AS GROUPING(a)
-- !query analysis
CreateViewCommand `t1`, SELECT * FROM VALUES (1) AS GROUPING(a), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [a#x]
      +- SubqueryAlias GROUPING
         +- LocalRelation [a#x]


-- !query
CREATE TEMPORARY VIEW t2 AS SELECT * FROM VALUES (1) AS GROUPING(a)
-- !query analysis
CreateViewCommand `t2`, SELECT * FROM VALUES (1) AS GROUPING(a), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [a#x]
      +- SubqueryAlias GROUPING
         +- LocalRelation [a#x]


-- !query
CREATE TEMPORARY VIEW t3 AS SELECT * FROM VALUES (1), (1) AS GROUPING(a)
-- !query analysis
CreateViewCommand `t3`, SELECT * FROM VALUES (1), (1) AS GROUPING(a), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [a#x]
      +- SubqueryAlias GROUPING
         +- LocalRelation [a#x]


-- !query
CREATE TEMPORARY VIEW t4 AS SELECT * FROM VALUES (1), (1) AS GROUPING(a)
-- !query analysis
CreateViewCommand `t4`, SELECT * FROM VALUES (1), (1) AS GROUPING(a), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [a#x]
      +- SubqueryAlias GROUPING
         +- LocalRelation [a#x]


-- !query
CREATE TEMPORARY VIEW ta AS
SELECT udf(a) AS a, udf('a') AS tag FROM t1
UNION ALL
SELECT udf(a) AS a, udf('b') AS tag FROM t2
-- !query analysis
CreateViewCommand `ta`, SELECT udf(a) AS a, udf('a') AS tag FROM t1
UNION ALL
SELECT udf(a) AS a, udf('b') AS tag FROM t2, false, false, LocalTempView, UNSUPPORTED, true, [udf]
   +- Union false, false
      :- Project [cast(udf(cast(a#x as string)) as int) AS a#x, cast(udf(cast(a as string)) as string) AS tag#x]
      :  +- SubqueryAlias t1
      :     +- View (`t1`, [a#x])
      :        +- Project [cast(a#x as int) AS a#x]
      :           +- Project [a#x]
      :              +- SubqueryAlias GROUPING
      :                 +- LocalRelation [a#x]
      +- Project [cast(udf(cast(a#x as string)) as int) AS a#x, cast(udf(cast(b as string)) as string) AS tag#x]
         +- SubqueryAlias t2
            +- View (`t2`, [a#x])
               +- Project [cast(a#x as int) AS a#x]
                  +- Project [a#x]
                     +- SubqueryAlias GROUPING
                        +- LocalRelation [a#x]


-- !query
CREATE TEMPORARY VIEW tb AS
SELECT udf(a) AS a, udf('a') AS tag FROM t3
UNION ALL
SELECT udf(a) AS a, udf('b') AS tag FROM t4
-- !query analysis
CreateViewCommand `tb`, SELECT udf(a) AS a, udf('a') AS tag FROM t3
UNION ALL
SELECT udf(a) AS a, udf('b') AS tag FROM t4, false, false, LocalTempView, UNSUPPORTED, true, [udf]
   +- Union false, false
      :- Project [cast(udf(cast(a#x as string)) as int) AS a#x, cast(udf(cast(a as string)) as string) AS tag#x]
      :  +- SubqueryAlias t3
      :     +- View (`t3`, [a#x])
      :        +- Project [cast(a#x as int) AS a#x]
      :           +- Project [a#x]
      :              +- SubqueryAlias GROUPING
      :                 +- LocalRelation [a#x]
      +- Project [cast(udf(cast(a#x as string)) as int) AS a#x, cast(udf(cast(b as string)) as string) AS tag#x]
         +- SubqueryAlias t4
            +- View (`t4`, [a#x])
               +- Project [cast(a#x as int) AS a#x]
                  +- Project [a#x]
                     +- SubqueryAlias GROUPING
                        +- LocalRelation [a#x]


-- !query
SELECT tb.* FROM ta INNER JOIN tb ON ta.a = tb.a AND ta.tag = tb.tag
-- !query analysis
Project [a#x, tag#x]
+- Join Inner, ((a#x = a#x) AND (tag#x = tag#x))
   :- SubqueryAlias ta
   :  +- View (`ta`, [a#x, tag#x])
   :     +- Project [cast(a#x as int) AS a#x, cast(tag#x as string) AS tag#x]
   :        +- Union false, false
   :           :- Project [cast(udf(cast(a#x as string)) as int) AS a#x, cast(udf(cast(a as string)) as string) AS tag#x]
   :           :  +- SubqueryAlias t1
   :           :     +- View (`t1`, [a#x])
   :           :        +- Project [cast(a#x as int) AS a#x]
   :           :           +- Project [a#x]
   :           :              +- SubqueryAlias GROUPING
   :           :                 +- LocalRelation [a#x]
   :           +- Project [cast(udf(cast(a#x as string)) as int) AS a#x, cast(udf(cast(b as string)) as string) AS tag#x]
   :              +- SubqueryAlias t2
   :                 +- View (`t2`, [a#x])
   :                    +- Project [cast(a#x as int) AS a#x]
   :                       +- Project [a#x]
   :                          +- SubqueryAlias GROUPING
   :                             +- LocalRelation [a#x]
   +- SubqueryAlias tb
      +- View (`tb`, [a#x, tag#x])
         +- Project [cast(a#x as int) AS a#x, cast(tag#x as string) AS tag#x]
            +- Union false, false
               :- Project [cast(udf(cast(a#x as string)) as int) AS a#x, cast(udf(cast(a as string)) as string) AS tag#x]
               :  +- SubqueryAlias t3
               :     +- View (`t3`, [a#x])
               :        +- Project [cast(a#x as int) AS a#x]
               :           +- Project [a#x]
               :              +- SubqueryAlias GROUPING
               :                 +- LocalRelation [a#x]
               +- Project [cast(udf(cast(a#x as string)) as int) AS a#x, cast(udf(cast(b as string)) as string) AS tag#x]
                  +- SubqueryAlias t4
                     +- View (`t4`, [a#x])
                        +- Project [cast(a#x as int) AS a#x]
                           +- Project [a#x]
                              +- SubqueryAlias GROUPING
                                 +- LocalRelation [a#x]
