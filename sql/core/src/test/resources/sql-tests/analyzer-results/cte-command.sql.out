-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE TABLE cte_tbl USING csv AS WITH s AS (SELECT 42 AS col) SELECT * FROM s
-- !query analysis
CreateDataSourceTableAsSelectCommand `spark_catalog`.`default`.`cte_tbl`, ErrorIfExists, [col]
   +- WithCTE
      :- CTERelationDef xxxx, false
      :  +- SubqueryAlias s
      :     +- Project [42 AS col#x]
      :        +- OneRowRelation
      +- Project [col#x]
         +- SubqueryAlias s
            +- CTERelationRef xxxx, true, [col#x], false, false, 1


-- !query
SELECT * FROM cte_tbl
-- !query analysis
Project [col#x]
+- SubqueryAlias spark_catalog.default.cte_tbl
   +- Relation spark_catalog.default.cte_tbl[col#x] csv


-- !query
CREATE TEMPORARY VIEW cte_view AS WITH s AS (SELECT 42 AS col) SELECT * FROM s
-- !query analysis
CreateViewCommand `cte_view`, WITH s AS (SELECT 42 AS col) SELECT * FROM s, false, false, LocalTempView, UNSUPPORTED, true
   +- WithCTE
      :- CTERelationDef xxxx, false
      :  +- SubqueryAlias s
      :     +- Project [42 AS col#x]
      :        +- OneRowRelation
      +- Project [col#x]
         +- SubqueryAlias s
            +- CTERelationRef xxxx, true, [col#x], false, false, 1


-- !query
SELECT * FROM cte_view
-- !query analysis
Project [col#x]
+- SubqueryAlias cte_view
   +- View (`cte_view`, [col#x])
      +- Project [cast(col#x as int) AS col#x]
         +- WithCTE
            :- CTERelationDef xxxx, false
            :  +- SubqueryAlias s
            :     +- Project [42 AS col#x]
            :        +- OneRowRelation
            +- Project [col#x]
               +- SubqueryAlias s
                  +- CTERelationRef xxxx, true, [col#x], false, false, 1


-- !query
WITH s AS (SELECT 43 AS col)
INSERT INTO cte_tbl SELECT * FROM S
-- !query analysis
InsertIntoHadoopFsRelationCommand file:[not included in comparison]/{warehouse_dir}/cte_tbl, false, CSV, [path=file:[not included in comparison]/{warehouse_dir}/cte_tbl], Append, `spark_catalog`.`default`.`cte_tbl`, org.apache.spark.sql.execution.datasources.InMemoryFileIndex(file:[not included in comparison]/{warehouse_dir}/cte_tbl), [col]
+- WithCTE
   :- CTERelationDef xxxx, false
   :  +- SubqueryAlias s
   :     +- Project [43 AS col#x]
   :        +- OneRowRelation
   +- Project [col#x]
      +- SubqueryAlias S
         +- CTERelationRef xxxx, true, [col#x], false, false, 1


-- !query
SELECT * FROM cte_tbl
-- !query analysis
Project [col#x]
+- SubqueryAlias spark_catalog.default.cte_tbl
   +- Relation spark_catalog.default.cte_tbl[col#x] csv


-- !query
INSERT INTO cte_tbl WITH s AS (SELECT 44 AS col) SELECT * FROM s
-- !query analysis
InsertIntoHadoopFsRelationCommand file:[not included in comparison]/{warehouse_dir}/cte_tbl, false, CSV, [path=file:[not included in comparison]/{warehouse_dir}/cte_tbl], Append, `spark_catalog`.`default`.`cte_tbl`, org.apache.spark.sql.execution.datasources.InMemoryFileIndex(file:[not included in comparison]/{warehouse_dir}/cte_tbl), [col]
+- WithCTE
   :- CTERelationDef xxxx, false
   :  +- SubqueryAlias s
   :     +- Project [44 AS col#x]
   :        +- OneRowRelation
   +- Project [col#x]
      +- SubqueryAlias s
         +- CTERelationRef xxxx, true, [col#x], false, false, 1


-- !query
SELECT * FROM cte_tbl
-- !query analysis
Project [col#x]
+- SubqueryAlias spark_catalog.default.cte_tbl
   +- Relation spark_catalog.default.cte_tbl[col#x] csv


-- !query
CREATE TABLE cte_tbl2 (col INT) USING csv
-- !query analysis
CreateDataSourceTableCommand `spark_catalog`.`default`.`cte_tbl2`, false


-- !query
WITH s AS (SELECT 45 AS col)
FROM s
INSERT INTO cte_tbl SELECT col
INSERT INTO cte_tbl2 SELECT col
-- !query analysis
Union false, false
:- InsertIntoHadoopFsRelationCommand file:[not included in comparison]/{warehouse_dir}/cte_tbl, false, CSV, [path=file:[not included in comparison]/{warehouse_dir}/cte_tbl], Append, `spark_catalog`.`default`.`cte_tbl`, org.apache.spark.sql.execution.datasources.InMemoryFileIndex(file:[not included in comparison]/{warehouse_dir}/cte_tbl), [col]
:  +- Project [col#x]
:     +- SubqueryAlias s
:        +- Project [45 AS col#x]
:           +- OneRowRelation
+- InsertIntoHadoopFsRelationCommand file:[not included in comparison]/{warehouse_dir}/cte_tbl2, false, CSV, [path=file:[not included in comparison]/{warehouse_dir}/cte_tbl2], Append, `spark_catalog`.`default`.`cte_tbl2`, org.apache.spark.sql.execution.datasources.InMemoryFileIndex(file:[not included in comparison]/{warehouse_dir}/cte_tbl2), [col]
   +- Project [col#x]
      +- SubqueryAlias s
         +- Project [45 AS col#x]
            +- OneRowRelation


-- !query
SELECT * FROM cte_tbl
-- !query analysis
Project [col#x]
+- SubqueryAlias spark_catalog.default.cte_tbl
   +- Relation spark_catalog.default.cte_tbl[col#x] csv


-- !query
SELECT * FROM cte_tbl2
-- !query analysis
Project [col#x]
+- SubqueryAlias spark_catalog.default.cte_tbl2
   +- Relation spark_catalog.default.cte_tbl2[col#x] csv


-- !query
DROP TABLE cte_tbl
-- !query analysis
DropTable false, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.cte_tbl


-- !query
DROP TABLE cte_tbl2
-- !query analysis
DropTable false, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.cte_tbl2
