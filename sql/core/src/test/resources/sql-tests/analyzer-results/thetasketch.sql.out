-- Automatically generated by SQLQueryTestSuite
-- !query
DROP TABLE IF EXISTS t1
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t1


-- !query
CREATE TABLE t1 USING JSON AS VALUES (0), (1), (2), (2), (2), (3), (4) as tab(col)
-- !query analysis
CreateDataSourceTableAsSelectCommand `spark_catalog`.`default`.`t1`, ErrorIfExists, [col]
   +- SubqueryAlias tab
      +- LocalRelation [col#x]


-- !query
SELECT theta_sketch_estimate(theta_sketch_agg(col)) AS result FROM t1
-- !query analysis
Aggregate [theta_sketch_estimate(theta_sketch_agg(col#x, 12, 0, 0)) AS result#xL]
+- SubqueryAlias spark_catalog.default.t1
   +- Relation spark_catalog.default.t1[col#x] json


-- !query
SELECT theta_sketch_estimate(theta_sketch_agg(col, 12))
FROM VALUES (50), (60), (60), (60), (75), (100) tab(col)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_sketch_agg(col#x, 12, 0, 0)) AS theta_sketch_estimate(theta_sketch_agg(col, 12))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col#x]


-- !query
SELECT theta_sketch_estimate(theta_sketch_agg(col))
FROM VALUES ('abc'), ('def'), ('abc'), ('ghi'), ('abc') tab(col)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_sketch_agg(col#x, 12, 0, 0)) AS theta_sketch_estimate(theta_sketch_agg(col, 12))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col#x]


-- !query
SELECT theta_sketch_estimate(theta_sketch_agg(col))
FROM VALUES (ARRAY(1, 2)), (ARRAY(3, 4)), (ARRAY(1, 2)) tab(col)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_sketch_agg(col#x, 12, 0, 0)) AS theta_sketch_estimate(theta_sketch_agg(col, 12))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col#x]


-- !query
SELECT theta_sketch_estimate(
  theta_union(
    theta_sketch_agg(col1),
    theta_sketch_agg(col2)))
  FROM VALUES
    (1, 4),
    (1, 4),
    (2, 5),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_union(theta_sketch_agg(col1#x, 12, 0, 0), theta_sketch_agg(col2#x, 12, 0, 0), 12)) AS theta_sketch_estimate(theta_union(theta_sketch_agg(col1, 12), theta_sketch_agg(col2, 12), 12))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col1#x, col2#x]


-- !query
SELECT theta_sketch_estimate(theta_union_agg(sketch, 15))
    FROM (SELECT theta_sketch_agg(col) as sketch
            FROM VALUES (1) AS tab(col)
          UNION ALL
          SELECT theta_sketch_agg(col, 20) as sketch
            FROM VALUES (1) AS tab(col))
-- !query analysis
Aggregate [theta_sketch_estimate(theta_union_agg(sketch#x, 15, 0, 0)) AS theta_sketch_estimate(theta_union_agg(sketch, 15))#xL]
+- SubqueryAlias __auto_generated_subquery_name
   +- Union false, false
      :- Aggregate [theta_sketch_agg(col#x, 12, 0, 0) AS sketch#x]
      :  +- SubqueryAlias tab
      :     +- LocalRelation [col#x]
      +- Aggregate [theta_sketch_agg(col#x, 20, 0, 0) AS sketch#x]
         +- SubqueryAlias tab
            +- LocalRelation [col#x]


-- !query
SELECT theta_sketch_estimate(
  theta_intersection(
    theta_sketch_agg(col1),
    theta_sketch_agg(col2)))
  FROM VALUES
    (1, 1),
    (2, 1),
    (3, 2),
    (3, 3) AS tab(col1, col2)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_intersection(theta_sketch_agg(col1#x, 12, 0, 0), theta_sketch_agg(col2#x, 12, 0, 0), 12)) AS theta_sketch_estimate(theta_intersection(theta_sketch_agg(col1, 12), theta_sketch_agg(col2, 12), 12))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col1#x, col2#x]


-- !query
SELECT theta_sketch_estimate(
  theta_difference(
    theta_sketch_agg(col1),
    theta_sketch_agg(col2)))
  FROM VALUES
    (1, 4),
    (2, 4),
    (3, 5),
    (4, 5) AS tab(col1, col2)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_difference(theta_sketch_agg(col1#x, 12, 0, 0), theta_sketch_agg(col2#x, 12, 0, 0), 12)) AS theta_sketch_estimate(theta_difference(theta_sketch_agg(col1, 12), theta_sketch_agg(col2, 12), 12))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col1#x, col2#x]


-- !query
SELECT theta_sketch_estimate(theta_intersection_agg(sketch, 15))
    FROM (SELECT theta_sketch_agg(col) as sketch
            FROM VALUES (1), (2) AS tab(col)
          UNION ALL
          SELECT theta_sketch_agg(col) as sketch
            FROM VALUES (1), (3) AS tab(col)
          UNION ALL  
          SELECT theta_sketch_agg(col) as sketch
            FROM VALUES (1), (4) AS tab(col))
-- !query analysis
Aggregate [theta_sketch_estimate(theta_intersection_agg(sketch#x, 15, 0, 0)) AS theta_sketch_estimate(theta_intersection_agg(sketch, 15))#xL]
+- SubqueryAlias __auto_generated_subquery_name
   +- Union false, false
      :- Union false, false
      :  :- Aggregate [theta_sketch_agg(col#x, 12, 0, 0) AS sketch#x]
      :  :  +- SubqueryAlias tab
      :  :     +- LocalRelation [col#x]
      :  +- Aggregate [theta_sketch_agg(col#x, 12, 0, 0) AS sketch#x]
      :     +- SubqueryAlias tab
      :        +- LocalRelation [col#x]
      +- Aggregate [theta_sketch_agg(col#x, 12, 0, 0) AS sketch#x]
         +- SubqueryAlias tab
            +- LocalRelation [col#x]


-- !query
SELECT theta_sketch_estimate(theta_union(
    theta_sketch_agg(col1, 12),
    theta_sketch_agg(col2, 12), 15))
  FROM VALUES
    (1, 4),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_union(theta_sketch_agg(col1#x, 12, 0, 0), theta_sketch_agg(col2#x, 12, 0, 0), 15)) AS theta_sketch_estimate(theta_union(theta_sketch_agg(col1, 12), theta_sketch_agg(col2, 12), 15))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col1#x, col2#x]


-- !query
SELECT theta_sketch_estimate(theta_intersection(
    theta_sketch_agg(col1, 12),
    theta_sketch_agg(col2, 12), 15))
  FROM VALUES
    (1, 1),
    (2, 2),
    (3, 4) AS tab(col1, col2)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_intersection(theta_sketch_agg(col1#x, 12, 0, 0), theta_sketch_agg(col2#x, 12, 0, 0), 15)) AS theta_sketch_estimate(theta_intersection(theta_sketch_agg(col1, 12), theta_sketch_agg(col2, 12), 15))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col1#x, col2#x]


-- !query
SELECT theta_sketch_estimate(theta_difference(
    theta_sketch_agg(col1, 12),
    theta_sketch_agg(col2, 12), 15))
  FROM VALUES
    (1, 4),
    (2, 4),
    (3, 5) AS tab(col1, col2)
-- !query analysis
Aggregate [theta_sketch_estimate(theta_difference(theta_sketch_agg(col1#x, 12, 0, 0), theta_sketch_agg(col2#x, 12, 0, 0), 15)) AS theta_sketch_estimate(theta_difference(theta_sketch_agg(col1, 12), theta_sketch_agg(col2, 12), 15))#xL]
+- SubqueryAlias tab
   +- LocalRelation [col1#x, col2#x]


-- !query
SELECT theta_sketch_agg(col)
FROM VALUES (ARRAY(1, 2)), (ARRAY(3, 4)) tab(col)
-- !query analysis
Aggregate [theta_sketch_agg(col#x, 12, 0, 0) AS theta_sketch_agg(col, 12)#x]
+- SubqueryAlias tab
   +- LocalRelation [col#x]


-- !query
SELECT theta_sketch_agg(col, 2)
FROM VALUES (50), (60), (60) tab(col)
-- !query analysis
Aggregate [theta_sketch_agg(col#x, 2, 0, 0) AS theta_sketch_agg(col, 2)#x]
+- SubqueryAlias tab
   +- LocalRelation [col#x]


-- !query
SELECT theta_sketch_agg(col, 40)
FROM VALUES (50), (60), (60) tab(col)
-- !query analysis
Aggregate [theta_sketch_agg(col#x, 40, 0, 0) AS theta_sketch_agg(col, 40)#x]
+- SubqueryAlias tab
   +- LocalRelation [col#x]


-- !query
SELECT theta_union_agg(sketch, 3)
FROM (SELECT theta_sketch_agg(col, 12) as sketch
        FROM VALUES (1) AS tab(col)
      UNION ALL
      SELECT theta_sketch_agg(col, 20) as sketch
        FROM VALUES (1) AS tab(col))
-- !query analysis
Aggregate [theta_union_agg(sketch#x, 3, 0, 0) AS theta_union_agg(sketch, 3)#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Union false, false
      :- Aggregate [theta_sketch_agg(col#x, 12, 0, 0) AS sketch#x]
      :  +- SubqueryAlias tab
      :     +- LocalRelation [col#x]
      +- Aggregate [theta_sketch_agg(col#x, 20, 0, 0) AS sketch#x]
         +- SubqueryAlias tab
            +- LocalRelation [col#x]


-- !query
SELECT theta_union_agg(sketch, 27)
FROM (SELECT theta_sketch_agg(col, 12) as sketch
        FROM VALUES (1) AS tab(col)
      UNION ALL
      SELECT theta_sketch_agg(col, 20) as sketch
        FROM VALUES (1) AS tab(col))
-- !query analysis
Aggregate [theta_union_agg(sketch#x, 27, 0, 0) AS theta_union_agg(sketch, 27)#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Union false, false
      :- Aggregate [theta_sketch_agg(col#x, 12, 0, 0) AS sketch#x]
      :  +- SubqueryAlias tab
      :     +- LocalRelation [col#x]
      +- Aggregate [theta_sketch_agg(col#x, 20, 0, 0) AS sketch#x]
         +- SubqueryAlias tab
            +- LocalRelation [col#x]


-- !query
SELECT theta_intersection_agg(sketch, 3)
FROM (SELECT theta_sketch_agg(col, 12) as sketch
        FROM VALUES (1) AS tab(col)
      UNION ALL
      SELECT theta_sketch_agg(col, 20) as sketch
        FROM VALUES (1) AS tab(col))
-- !query analysis
Aggregate [theta_intersection_agg(sketch#x, 3, 0, 0) AS theta_intersection_agg(sketch, 3)#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Union false, false
      :- Aggregate [theta_sketch_agg(col#x, 12, 0, 0) AS sketch#x]
      :  +- SubqueryAlias tab
      :     +- LocalRelation [col#x]
      +- Aggregate [theta_sketch_agg(col#x, 20, 0, 0) AS sketch#x]
         +- SubqueryAlias tab
            +- LocalRelation [col#x]


-- !query
SELECT theta_union(1, 2)
  FROM VALUES
    (1, 4),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"theta_union(1, 2, 12)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 24,
    "fragment" : "theta_union(1, 2)"
  } ]
}


-- !query
SELECT theta_intersection(1, 2)
  FROM VALUES
    (1, 4),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"theta_intersection(1, 2, 12)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 31,
    "fragment" : "theta_intersection(1, 2)"
  } ]
}


-- !query
SELECT theta_difference(1, 2)
  FROM VALUES
    (1, 4),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"theta_difference(1, 2, 12)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 29,
    "fragment" : "theta_difference(1, 2)"
  } ]
}


-- !query
SELECT theta_union(
    theta_sketch_agg(col1),
    theta_sketch_agg(col2), 'invalid')
  FROM VALUES
    (1, 4),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"invalid\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "third",
    "requiredType" : "\"INT\"",
    "sqlExpr" : "\"theta_union(theta_sketch_agg(col1, 12), theta_sketch_agg(col2, 12), invalid)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 86,
    "fragment" : "theta_union(\n    theta_sketch_agg(col1),\n    theta_sketch_agg(col2), 'invalid')"
  } ]
}


-- !query
SELECT theta_intersection(
    theta_sketch_agg(col1),
    'invalid_sketch')
  FROM VALUES
    (1, 4),
    (2, 5),
    (3, 6) AS tab(col1, col2)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"invalid_sketch\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "second",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"theta_intersection(theta_sketch_agg(col1, 12), invalid_sketch, 12)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 76,
    "fragment" : "theta_intersection(\n    theta_sketch_agg(col1),\n    'invalid_sketch')"
  } ]
}


-- !query
SELECT theta_intersection_agg(sketch, 'invalid')
FROM (SELECT theta_sketch_agg(col) as sketch
        FROM VALUES (1) AS tab(col))
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"invalid\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "second",
    "requiredType" : "\"INT\"",
    "sqlExpr" : "\"theta_intersection_agg(sketch, invalid)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 48,
    "fragment" : "theta_intersection_agg(sketch, 'invalid')"
  } ]
}


-- !query
SELECT theta_sketch_estimate(CAST('abc' AS BINARY))
-- !query analysis
Project [theta_sketch_estimate(cast(abc as binary)) AS theta_sketch_estimate(CAST(abc AS BINARY))#xL]
+- OneRowRelation


-- !query
SELECT theta_union(CAST('abc' AS BINARY), CAST('def' AS BINARY))
-- !query analysis
Project [theta_union(cast(abc as binary), cast(def as binary), 12) AS theta_union(CAST(abc AS BINARY), CAST(def AS BINARY), 12)#x]
+- OneRowRelation


-- !query
SELECT theta_intersection(CAST('abc' AS BINARY), CAST('def' AS BINARY))
-- !query analysis
Project [theta_intersection(cast(abc as binary), cast(def as binary), 12) AS theta_intersection(CAST(abc AS BINARY), CAST(def AS BINARY), 12)#x]
+- OneRowRelation


-- !query
SELECT theta_difference(CAST('abc' AS BINARY), CAST('def' AS BINARY))
-- !query analysis
Project [theta_difference(cast(abc as binary), cast(def as binary), 12) AS theta_difference(CAST(abc AS BINARY), CAST(def AS BINARY), 12)#x]
+- OneRowRelation


-- !query
SELECT theta_union_agg(buffer, 15)
FROM (SELECT CAST('abc' AS BINARY) AS buffer)
-- !query analysis
Aggregate [theta_union_agg(buffer#x, 15, 0, 0) AS theta_union_agg(buffer, 15)#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Project [cast(abc as binary) AS buffer#x]
      +- OneRowRelation


-- !query
SELECT theta_intersection_agg(buffer, 15)
FROM (SELECT CAST('abc' AS BINARY) AS buffer)
-- !query analysis
Aggregate [theta_intersection_agg(buffer#x, 15, 0, 0) AS theta_intersection_agg(buffer, 15)#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Project [cast(abc as binary) AS buffer#x]
      +- OneRowRelation


-- !query
DROP TABLE IF EXISTS t1
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t1
