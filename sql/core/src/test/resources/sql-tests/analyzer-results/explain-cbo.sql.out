-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE TABLE explain_temp1(a INT, b INT) USING PARQUET
-- !query analysis
CreateDataSourceTableCommand `spark_catalog`.`default`.`explain_temp1`, false


-- !query
CREATE TABLE explain_temp2(c INT, d INT) USING PARQUET
-- !query analysis
CreateDataSourceTableCommand `spark_catalog`.`default`.`explain_temp2`, false


-- !query
ANALYZE TABLE explain_temp1 COMPUTE STATISTICS FOR ALL COLUMNS
-- !query analysis
AnalyzeColumnCommand `spark_catalog`.`default`.`explain_temp1`, true


-- !query
ANALYZE TABLE explain_temp2 COMPUTE STATISTICS FOR ALL COLUMNS
-- !query analysis
AnalyzeColumnCommand `spark_catalog`.`default`.`explain_temp2`, true


-- !query
EXPLAIN COST WITH max_store_sales AS
(
  SELECT max(csales) tpcds_cmax
  FROM (
    SELECT sum(b) csales
    FROM explain_temp1 WHERE a < 100
  ) x
),
best_ss_customer AS
(
  SELECT c
  FROM explain_temp2
  WHERE d > (SELECT * FROM max_store_sales)
)
SELECT c FROM best_ss_customer
-- !query analysis
ExplainCommand CTE [max_store_sales, best_ss_customer], CostMode


-- !query
DROP TABLE explain_temp1
-- !query analysis
DropTable false, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.explain_temp1


-- !query
DROP TABLE explain_temp2
-- !query analysis
DropTable false, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.explain_temp2
