-- Automatically generated by SQLQueryTestSuite
-- !query
create temporary view nt1 as select * from values
  ("one", 1),
  ("two", 2),
  ("three", 3)
  as nt1(k, v1)
-- !query analysis
CreateViewCommand `nt1`, select * from values
  ("one", 1),
  ("two", 2),
  ("three", 3)
  as nt1(k, v1), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [k#x, v1#x]
      +- SubqueryAlias nt1
         +- LocalRelation [k#x, v1#x]


-- !query
create temporary view nt2 as select * from values
  ("one", 1),
  ("two", 22),
  ("one", 5)
  as nt2(k, v2)
-- !query analysis
CreateViewCommand `nt2`, select * from values
  ("one", 1),
  ("two", 22),
  ("one", 5)
  as nt2(k, v2), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [k#x, v2#x]
      +- SubqueryAlias nt2
         +- LocalRelation [k#x, v2#x]


-- !query
create temporary view nt3 as select * from values
  ("one", 4),
  ("two", 5),
  ("one", 6)
  as nt3(k, v3)
-- !query analysis
CreateViewCommand `nt3`, select * from values
  ("one", 4),
  ("two", 5),
  ("one", 6)
  as nt3(k, v3), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [k#x, v3#x]
      +- SubqueryAlias nt3
         +- LocalRelation [k#x, v3#x]


-- !query
create temporary view nt4 as select * from values
  ("one", 7),
  ("two", 8),
  ("one", 9)
  as nt4(k, v4)
-- !query analysis
CreateViewCommand `nt4`, select * from values
  ("one", 7),
  ("two", 8),
  ("one", 9)
  as nt4(k, v4), false, false, LocalTempView, UNSUPPORTED, true
   +- Project [k#x, v4#x]
      +- SubqueryAlias nt4
         +- LocalRelation [k#x, v4#x]


-- !query
SELECT * FROM nt1 natural join nt2
-- !query analysis
Project [k#x, v1#x, v2#x]
+- Project [k#x, v1#x, v2#x]
   +- Join Inner, (k#x = k#x)
      :- SubqueryAlias nt1
      :  +- View (`nt1`, [k#x, v1#x])
      :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :        +- Project [k#x, v1#x]
      :           +- SubqueryAlias nt1
      :              +- LocalRelation [k#x, v1#x]
      +- SubqueryAlias nt2
         +- View (`nt2`, [k#x, v2#x])
            +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
               +- Project [k#x, v2#x]
                  +- SubqueryAlias nt2
                     +- LocalRelation [k#x, v2#x]


-- !query
SELECT * FROM nt1 natural join nt2 where k = "one"
-- !query analysis
Project [k#x, v1#x, v2#x]
+- Filter (k#x = one)
   +- Project [k#x, v1#x, v2#x]
      +- Join Inner, (k#x = k#x)
         :- SubqueryAlias nt1
         :  +- View (`nt1`, [k#x, v1#x])
         :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
         :        +- Project [k#x, v1#x]
         :           +- SubqueryAlias nt1
         :              +- LocalRelation [k#x, v1#x]
         +- SubqueryAlias nt2
            +- View (`nt2`, [k#x, v2#x])
               +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                  +- Project [k#x, v2#x]
                     +- SubqueryAlias nt2
                        +- LocalRelation [k#x, v2#x]


-- !query
SELECT * FROM nt1 natural left join nt2 order by v1, v2
-- !query analysis
Sort [v1#x ASC NULLS FIRST, v2#x ASC NULLS FIRST], true
+- Project [k#x, v1#x, v2#x]
   +- Project [k#x, v1#x, v2#x]
      +- Join LeftOuter, (k#x = k#x)
         :- SubqueryAlias nt1
         :  +- View (`nt1`, [k#x, v1#x])
         :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
         :        +- Project [k#x, v1#x]
         :           +- SubqueryAlias nt1
         :              +- LocalRelation [k#x, v1#x]
         +- SubqueryAlias nt2
            +- View (`nt2`, [k#x, v2#x])
               +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                  +- Project [k#x, v2#x]
                     +- SubqueryAlias nt2
                        +- LocalRelation [k#x, v2#x]


-- !query
SELECT * FROM nt1 natural right join nt2 order by v1, v2
-- !query analysis
Sort [v1#x ASC NULLS FIRST, v2#x ASC NULLS FIRST], true
+- Project [k#x, v1#x, v2#x]
   +- Project [k#x, v1#x, v2#x]
      +- Join RightOuter, (k#x = k#x)
         :- SubqueryAlias nt1
         :  +- View (`nt1`, [k#x, v1#x])
         :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
         :        +- Project [k#x, v1#x]
         :           +- SubqueryAlias nt1
         :              +- LocalRelation [k#x, v1#x]
         +- SubqueryAlias nt2
            +- View (`nt2`, [k#x, v2#x])
               +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                  +- Project [k#x, v2#x]
                     +- SubqueryAlias nt2
                        +- LocalRelation [k#x, v2#x]


-- !query
SELECT count(*) FROM nt1 natural full outer join nt2
-- !query analysis
Aggregate [count(1) AS count(1)#xL]
+- Project [coalesce(k#x, k#x) AS k#x, v1#x, v2#x]
   +- Join FullOuter, (k#x = k#x)
      :- SubqueryAlias nt1
      :  +- View (`nt1`, [k#x, v1#x])
      :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :        +- Project [k#x, v1#x]
      :           +- SubqueryAlias nt1
      :              +- LocalRelation [k#x, v1#x]
      +- SubqueryAlias nt2
         +- View (`nt2`, [k#x, v2#x])
            +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
               +- Project [k#x, v2#x]
                  +- SubqueryAlias nt2
                     +- LocalRelation [k#x, v2#x]


-- !query
SELECT k FROM nt1 natural join nt2
-- !query analysis
Project [k#x]
+- Project [k#x, v1#x, v2#x]
   +- Join Inner, (k#x = k#x)
      :- SubqueryAlias nt1
      :  +- View (`nt1`, [k#x, v1#x])
      :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :        +- Project [k#x, v1#x]
      :           +- SubqueryAlias nt1
      :              +- LocalRelation [k#x, v1#x]
      +- SubqueryAlias nt2
         +- View (`nt2`, [k#x, v2#x])
            +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
               +- Project [k#x, v2#x]
                  +- SubqueryAlias nt2
                     +- LocalRelation [k#x, v2#x]


-- !query
SELECT k FROM nt1 natural join nt2 where k = "one"
-- !query analysis
Project [k#x]
+- Filter (k#x = one)
   +- Project [k#x, v1#x, v2#x]
      +- Join Inner, (k#x = k#x)
         :- SubqueryAlias nt1
         :  +- View (`nt1`, [k#x, v1#x])
         :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
         :        +- Project [k#x, v1#x]
         :           +- SubqueryAlias nt1
         :              +- LocalRelation [k#x, v1#x]
         +- SubqueryAlias nt2
            +- View (`nt2`, [k#x, v2#x])
               +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                  +- Project [k#x, v2#x]
                     +- SubqueryAlias nt2
                        +- LocalRelation [k#x, v2#x]


-- !query
SELECT nt1.* FROM nt1 natural join nt2
-- !query analysis
Project [k#x, v1#x]
+- Project [k#x, v1#x, v2#x]
   +- Join Inner, (k#x = k#x)
      :- SubqueryAlias nt1
      :  +- View (`nt1`, [k#x, v1#x])
      :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :        +- Project [k#x, v1#x]
      :           +- SubqueryAlias nt1
      :              +- LocalRelation [k#x, v1#x]
      +- SubqueryAlias nt2
         +- View (`nt2`, [k#x, v2#x])
            +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
               +- Project [k#x, v2#x]
                  +- SubqueryAlias nt2
                     +- LocalRelation [k#x, v2#x]


-- !query
SELECT nt2.* FROM nt1 natural join nt2
-- !query analysis
Project [k#x, v2#x]
+- Project [k#x, v1#x, v2#x, k#x]
   +- Join Inner, (k#x = k#x)
      :- SubqueryAlias nt1
      :  +- View (`nt1`, [k#x, v1#x])
      :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :        +- Project [k#x, v1#x]
      :           +- SubqueryAlias nt1
      :              +- LocalRelation [k#x, v1#x]
      +- SubqueryAlias nt2
         +- View (`nt2`, [k#x, v2#x])
            +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
               +- Project [k#x, v2#x]
                  +- SubqueryAlias nt2
                     +- LocalRelation [k#x, v2#x]


-- !query
SELECT sbq.* from (SELECT * FROM nt1 natural join nt2) sbq
-- !query analysis
Project [k#x, v1#x, v2#x]
+- SubqueryAlias sbq
   +- Project [k#x, v1#x, v2#x]
      +- Project [k#x, v1#x, v2#x]
         +- Join Inner, (k#x = k#x)
            :- SubqueryAlias nt1
            :  +- View (`nt1`, [k#x, v1#x])
            :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
            :        +- Project [k#x, v1#x]
            :           +- SubqueryAlias nt1
            :              +- LocalRelation [k#x, v1#x]
            +- SubqueryAlias nt2
               +- View (`nt2`, [k#x, v2#x])
                  +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                     +- Project [k#x, v2#x]
                        +- SubqueryAlias nt2
                           +- LocalRelation [k#x, v2#x]


-- !query
SELECT sbq.k from (SELECT * FROM nt1 natural join nt2) sbq
-- !query analysis
Project [k#x]
+- SubqueryAlias sbq
   +- Project [k#x, v1#x, v2#x]
      +- Project [k#x, v1#x, v2#x]
         +- Join Inner, (k#x = k#x)
            :- SubqueryAlias nt1
            :  +- View (`nt1`, [k#x, v1#x])
            :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
            :        +- Project [k#x, v1#x]
            :           +- SubqueryAlias nt1
            :              +- LocalRelation [k#x, v1#x]
            +- SubqueryAlias nt2
               +- View (`nt2`, [k#x, v2#x])
                  +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                     +- Project [k#x, v2#x]
                        +- SubqueryAlias nt2
                           +- LocalRelation [k#x, v2#x]


-- !query
SELECT nt1.*, nt2.* FROM nt1 natural join nt2
-- !query analysis
Project [k#x, v1#x, k#x, v2#x]
+- Project [k#x, v1#x, v2#x, k#x]
   +- Join Inner, (k#x = k#x)
      :- SubqueryAlias nt1
      :  +- View (`nt1`, [k#x, v1#x])
      :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :        +- Project [k#x, v1#x]
      :           +- SubqueryAlias nt1
      :              +- LocalRelation [k#x, v1#x]
      +- SubqueryAlias nt2
         +- View (`nt2`, [k#x, v2#x])
            +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
               +- Project [k#x, v2#x]
                  +- SubqueryAlias nt2
                     +- LocalRelation [k#x, v2#x]


-- !query
SELECT *, nt2.k FROM nt1 natural join nt2
-- !query analysis
Project [k#x, v1#x, v2#x, k#x]
+- Project [k#x, v1#x, v2#x, k#x]
   +- Join Inner, (k#x = k#x)
      :- SubqueryAlias nt1
      :  +- View (`nt1`, [k#x, v1#x])
      :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :        +- Project [k#x, v1#x]
      :           +- SubqueryAlias nt1
      :              +- LocalRelation [k#x, v1#x]
      +- SubqueryAlias nt2
         +- View (`nt2`, [k#x, v2#x])
            +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
               +- Project [k#x, v2#x]
                  +- SubqueryAlias nt2
                     +- LocalRelation [k#x, v2#x]


-- !query
SELECT nt1.k, nt2.k FROM nt1 natural join nt2
-- !query analysis
Project [k#x, k#x]
+- Project [k#x, v1#x, v2#x, k#x]
   +- Join Inner, (k#x = k#x)
      :- SubqueryAlias nt1
      :  +- View (`nt1`, [k#x, v1#x])
      :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :        +- Project [k#x, v1#x]
      :           +- SubqueryAlias nt1
      :              +- LocalRelation [k#x, v1#x]
      +- SubqueryAlias nt2
         +- View (`nt2`, [k#x, v2#x])
            +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
               +- Project [k#x, v2#x]
                  +- SubqueryAlias nt2
                     +- LocalRelation [k#x, v2#x]


-- !query
SELECT k FROM (SELECT nt2.k FROM nt1 natural join nt2)
-- !query analysis
Project [k#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Project [k#x]
      +- Project [k#x, v1#x, v2#x, k#x]
         +- Join Inner, (k#x = k#x)
            :- SubqueryAlias nt1
            :  +- View (`nt1`, [k#x, v1#x])
            :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
            :        +- Project [k#x, v1#x]
            :           +- SubqueryAlias nt1
            :              +- LocalRelation [k#x, v1#x]
            +- SubqueryAlias nt2
               +- View (`nt2`, [k#x, v2#x])
                  +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                     +- Project [k#x, v2#x]
                        +- SubqueryAlias nt2
                           +- LocalRelation [k#x, v2#x]


-- !query
SELECT nt2.k AS key FROM nt1 natural join nt2 ORDER BY key
-- !query analysis
Sort [key#x ASC NULLS FIRST], true
+- Project [k#x AS key#x]
   +- Project [k#x, v1#x, v2#x, k#x]
      +- Join Inner, (k#x = k#x)
         :- SubqueryAlias nt1
         :  +- View (`nt1`, [k#x, v1#x])
         :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
         :        +- Project [k#x, v1#x]
         :           +- SubqueryAlias nt1
         :              +- LocalRelation [k#x, v1#x]
         +- SubqueryAlias nt2
            +- View (`nt2`, [k#x, v2#x])
               +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                  +- Project [k#x, v2#x]
                     +- SubqueryAlias nt2
                        +- LocalRelation [k#x, v2#x]


-- !query
SELECT nt1.k, nt2.k FROM nt1 natural join nt2 where k = "one"
-- !query analysis
Project [k#x, k#x]
+- Filter (k#x = one)
   +- Project [k#x, v1#x, v2#x, k#x]
      +- Join Inner, (k#x = k#x)
         :- SubqueryAlias nt1
         :  +- View (`nt1`, [k#x, v1#x])
         :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
         :        +- Project [k#x, v1#x]
         :           +- SubqueryAlias nt1
         :              +- LocalRelation [k#x, v1#x]
         +- SubqueryAlias nt2
            +- View (`nt2`, [k#x, v2#x])
               +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                  +- Project [k#x, v2#x]
                     +- SubqueryAlias nt2
                        +- LocalRelation [k#x, v2#x]


-- !query
SELECT * FROM (SELECT * FROM nt1 natural join nt2)
-- !query analysis
Project [k#x, v1#x, v2#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Project [k#x, v1#x, v2#x]
      +- Project [k#x, v1#x, v2#x]
         +- Join Inner, (k#x = k#x)
            :- SubqueryAlias nt1
            :  +- View (`nt1`, [k#x, v1#x])
            :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
            :        +- Project [k#x, v1#x]
            :           +- SubqueryAlias nt1
            :              +- LocalRelation [k#x, v1#x]
            +- SubqueryAlias nt2
               +- View (`nt2`, [k#x, v2#x])
                  +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                     +- Project [k#x, v2#x]
                        +- SubqueryAlias nt2
                           +- LocalRelation [k#x, v2#x]


-- !query
SELECT * FROM (SELECT nt1.*, nt2.* FROM nt1 natural join nt2)
-- !query analysis
Project [k#x, v1#x, k#x, v2#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Project [k#x, v1#x, k#x, v2#x]
      +- Project [k#x, v1#x, v2#x, k#x]
         +- Join Inner, (k#x = k#x)
            :- SubqueryAlias nt1
            :  +- View (`nt1`, [k#x, v1#x])
            :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
            :        +- Project [k#x, v1#x]
            :           +- SubqueryAlias nt1
            :              +- LocalRelation [k#x, v1#x]
            +- SubqueryAlias nt2
               +- View (`nt2`, [k#x, v2#x])
                  +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                     +- Project [k#x, v2#x]
                        +- SubqueryAlias nt2
                           +- LocalRelation [k#x, v2#x]


-- !query
SELECT * FROM (SELECT nt1.v1, nt2.k FROM nt1 natural join nt2)
-- !query analysis
Project [v1#x, k#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Project [v1#x, k#x]
      +- Project [k#x, v1#x, v2#x, k#x]
         +- Join Inner, (k#x = k#x)
            :- SubqueryAlias nt1
            :  +- View (`nt1`, [k#x, v1#x])
            :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
            :        +- Project [k#x, v1#x]
            :           +- SubqueryAlias nt1
            :              +- LocalRelation [k#x, v1#x]
            +- SubqueryAlias nt2
               +- View (`nt2`, [k#x, v2#x])
                  +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
                     +- Project [k#x, v2#x]
                        +- SubqueryAlias nt2
                           +- LocalRelation [k#x, v2#x]


-- !query
SELECT nt2.k FROM (SELECT * FROM nt1 natural join nt2)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "UNRESOLVED_COLUMN.WITH_SUGGESTION",
  "sqlState" : "42703",
  "messageParameters" : {
    "objectName" : "`nt2`.`k`",
    "proposal" : "`k`, `v1`, `v2`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 12,
    "fragment" : "nt2.k"
  } ]
}


-- !query
SELECT * FROM nt1 natural join nt2 natural join nt3
-- !query analysis
Project [k#x, v1#x, v2#x, v3#x]
+- Project [k#x, v1#x, v2#x, v3#x]
   +- Join Inner, (k#x = k#x)
      :- Project [k#x, v1#x, v2#x]
      :  +- Join Inner, (k#x = k#x)
      :     :- SubqueryAlias nt1
      :     :  +- View (`nt1`, [k#x, v1#x])
      :     :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :     :        +- Project [k#x, v1#x]
      :     :           +- SubqueryAlias nt1
      :     :              +- LocalRelation [k#x, v1#x]
      :     +- SubqueryAlias nt2
      :        +- View (`nt2`, [k#x, v2#x])
      :           +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
      :              +- Project [k#x, v2#x]
      :                 +- SubqueryAlias nt2
      :                    +- LocalRelation [k#x, v2#x]
      +- SubqueryAlias nt3
         +- View (`nt3`, [k#x, v3#x])
            +- Project [cast(k#x as string) AS k#x, cast(v3#x as int) AS v3#x]
               +- Project [k#x, v3#x]
                  +- SubqueryAlias nt3
                     +- LocalRelation [k#x, v3#x]


-- !query
SELECT nt1.*, nt2.*, nt3.* FROM nt1 natural join nt2 natural join nt3
-- !query analysis
Project [k#x, v1#x, k#x, v2#x, k#x, v3#x]
+- Project [k#x, v1#x, v2#x, v3#x, k#x, k#x]
   +- Join Inner, (k#x = k#x)
      :- Project [k#x, v1#x, v2#x, k#x]
      :  +- Join Inner, (k#x = k#x)
      :     :- SubqueryAlias nt1
      :     :  +- View (`nt1`, [k#x, v1#x])
      :     :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :     :        +- Project [k#x, v1#x]
      :     :           +- SubqueryAlias nt1
      :     :              +- LocalRelation [k#x, v1#x]
      :     +- SubqueryAlias nt2
      :        +- View (`nt2`, [k#x, v2#x])
      :           +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
      :              +- Project [k#x, v2#x]
      :                 +- SubqueryAlias nt2
      :                    +- LocalRelation [k#x, v2#x]
      +- SubqueryAlias nt3
         +- View (`nt3`, [k#x, v3#x])
            +- Project [cast(k#x as string) AS k#x, cast(v3#x as int) AS v3#x]
               +- Project [k#x, v3#x]
                  +- SubqueryAlias nt3
                     +- LocalRelation [k#x, v3#x]


-- !query
SELECT nt1.*, nt2.*, nt3.* FROM nt1 natural join nt2 join nt3 on nt2.k = nt3.k
-- !query analysis
Project [k#x, v1#x, k#x, v2#x, k#x, v3#x]
+- Join Inner, (k#x = k#x)
   :- Project [k#x, v1#x, v2#x, k#x]
   :  +- Join Inner, (k#x = k#x)
   :     :- SubqueryAlias nt1
   :     :  +- View (`nt1`, [k#x, v1#x])
   :     :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
   :     :        +- Project [k#x, v1#x]
   :     :           +- SubqueryAlias nt1
   :     :              +- LocalRelation [k#x, v1#x]
   :     +- SubqueryAlias nt2
   :        +- View (`nt2`, [k#x, v2#x])
   :           +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
   :              +- Project [k#x, v2#x]
   :                 +- SubqueryAlias nt2
   :                    +- LocalRelation [k#x, v2#x]
   +- SubqueryAlias nt3
      +- View (`nt3`, [k#x, v3#x])
         +- Project [cast(k#x as string) AS k#x, cast(v3#x as int) AS v3#x]
            +- Project [k#x, v3#x]
               +- SubqueryAlias nt3
                  +- LocalRelation [k#x, v3#x]


-- !query
SELECT * FROM nt1 natural join nt2 join nt3 on nt1.k = nt3.k
-- !query analysis
Project [k#x, v1#x, v2#x, k#x, v3#x]
+- Join Inner, (k#x = k#x)
   :- Project [k#x, v1#x, v2#x]
   :  +- Join Inner, (k#x = k#x)
   :     :- SubqueryAlias nt1
   :     :  +- View (`nt1`, [k#x, v1#x])
   :     :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
   :     :        +- Project [k#x, v1#x]
   :     :           +- SubqueryAlias nt1
   :     :              +- LocalRelation [k#x, v1#x]
   :     +- SubqueryAlias nt2
   :        +- View (`nt2`, [k#x, v2#x])
   :           +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
   :              +- Project [k#x, v2#x]
   :                 +- SubqueryAlias nt2
   :                    +- LocalRelation [k#x, v2#x]
   +- SubqueryAlias nt3
      +- View (`nt3`, [k#x, v3#x])
         +- Project [cast(k#x as string) AS k#x, cast(v3#x as int) AS v3#x]
            +- Project [k#x, v3#x]
               +- SubqueryAlias nt3
                  +- LocalRelation [k#x, v3#x]


-- !query
SELECT * FROM nt1 natural join nt2 join nt3 on nt2.k = nt3.k
-- !query analysis
Project [k#x, v1#x, v2#x, k#x, v3#x]
+- Project [k#x, v1#x, v2#x, k#x, v3#x]
   +- Join Inner, (k#x = k#x)
      :- Project [k#x, v1#x, v2#x, k#x]
      :  +- Join Inner, (k#x = k#x)
      :     :- SubqueryAlias nt1
      :     :  +- View (`nt1`, [k#x, v1#x])
      :     :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :     :        +- Project [k#x, v1#x]
      :     :           +- SubqueryAlias nt1
      :     :              +- LocalRelation [k#x, v1#x]
      :     +- SubqueryAlias nt2
      :        +- View (`nt2`, [k#x, v2#x])
      :           +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
      :              +- Project [k#x, v2#x]
      :                 +- SubqueryAlias nt2
      :                    +- LocalRelation [k#x, v2#x]
      +- SubqueryAlias nt3
         +- View (`nt3`, [k#x, v3#x])
            +- Project [cast(k#x as string) AS k#x, cast(v3#x as int) AS v3#x]
               +- Project [k#x, v3#x]
                  +- SubqueryAlias nt3
                     +- LocalRelation [k#x, v3#x]


-- !query
SELECT nt1.*, nt2.*, nt3.*, nt4.* FROM nt1 natural join nt2 natural join nt3 natural join nt4
-- !query analysis
Project [k#x, v1#x, k#x, v2#x, k#x, v3#x, k#x, v4#x]
+- Project [k#x, v1#x, v2#x, v3#x, v4#x, k#x, k#x, k#x]
   +- Join Inner, (k#x = k#x)
      :- Project [k#x, v1#x, v2#x, v3#x, k#x, k#x]
      :  +- Join Inner, (k#x = k#x)
      :     :- Project [k#x, v1#x, v2#x, k#x]
      :     :  +- Join Inner, (k#x = k#x)
      :     :     :- SubqueryAlias nt1
      :     :     :  +- View (`nt1`, [k#x, v1#x])
      :     :     :     +- Project [cast(k#x as string) AS k#x, cast(v1#x as int) AS v1#x]
      :     :     :        +- Project [k#x, v1#x]
      :     :     :           +- SubqueryAlias nt1
      :     :     :              +- LocalRelation [k#x, v1#x]
      :     :     +- SubqueryAlias nt2
      :     :        +- View (`nt2`, [k#x, v2#x])
      :     :           +- Project [cast(k#x as string) AS k#x, cast(v2#x as int) AS v2#x]
      :     :              +- Project [k#x, v2#x]
      :     :                 +- SubqueryAlias nt2
      :     :                    +- LocalRelation [k#x, v2#x]
      :     +- SubqueryAlias nt3
      :        +- View (`nt3`, [k#x, v3#x])
      :           +- Project [cast(k#x as string) AS k#x, cast(v3#x as int) AS v3#x]
      :              +- Project [k#x, v3#x]
      :                 +- SubqueryAlias nt3
      :                    +- LocalRelation [k#x, v3#x]
      +- SubqueryAlias nt4
         +- View (`nt4`, [k#x, v4#x])
            +- Project [cast(k#x as string) AS k#x, cast(v4#x as int) AS v4#x]
               +- Project [k#x, v4#x]
                  +- SubqueryAlias nt4
                     +- LocalRelation [k#x, v4#x]


-- !query
CREATE TEMPORARY VIEW nat_t2(col1 INT, col2 STRING) AS VALUES (1, 'a'), (2, 'b')
-- !query analysis
org.apache.spark.sql.catalyst.parser.ParseException
{
  "errorClass" : "PARSE_SYNTAX_ERROR",
  "sqlState" : "42601",
  "messageParameters" : {
    "error" : "'AS'",
    "hint" : ": missing 'USING'"
  }
}


-- !query
SELECT * FROM nat_t2 as t2_1 LEFT JOIN nat_t2 as t2_2 ON t2_1.col1 = t2_2.col1
    NATURAL JOIN nat_t2 as t2_3
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`nat_t2`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 20,
    "fragment" : "nat_t2"
  } ]
}


-- !query
SELECT * FROM nat_t2 as t2_1 RIGHT JOIN nat_t2 as t2_2 ON t2_1.col1 = t2_2.col1
    NATURAL JOIN nat_t2 as t2_3
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`nat_t2`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 20,
    "fragment" : "nat_t2"
  } ]
}


-- !query
SELECT * FROM nat_t2 as t2_1 CROSS JOIN nat_t2 as t2_2 ON t2_1.col1 = t2_2.col1
    NATURAL JOIN nat_t2 as t2_3
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`nat_t2`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 20,
    "fragment" : "nat_t2"
  } ]
}


-- !query
SELECT * FROM nat_t2 as t2_1 INNER JOIN nat_t2 as t2_2 ON t2_1.col1 = t2_2.col1
    NATURAL JOIN nat_t2 as t2_3
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`nat_t2`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 20,
    "fragment" : "nat_t2"
  } ]
}


-- !query
CREATE TEMPORARY VIEW nat_t3(col1 INT) AS VALUES (1), (2), (3)
-- !query analysis
org.apache.spark.sql.catalyst.parser.ParseException
{
  "errorClass" : "PARSE_SYNTAX_ERROR",
  "sqlState" : "42601",
  "messageParameters" : {
    "error" : "'AS'",
    "hint" : ": missing 'USING'"
  }
}


-- !query
CREATE TEMPORARY VIEW nat_t4(col1 INT, col2 STRING) AS VALUES (1, 'x'), (2, 'y')
-- !query analysis
org.apache.spark.sql.catalyst.parser.ParseException
{
  "errorClass" : "PARSE_SYNTAX_ERROR",
  "sqlState" : "42601",
  "messageParameters" : {
    "error" : "'AS'",
    "hint" : ": missing 'USING'"
  }
}


-- !query
SELECT 1 FROM nat_t2 NATURAL JOIN nat_t3 JOIN nat_t4 ON nat_t4.col1 = nat_t3.col1 WHERE nat_t4.col2 = 'x'
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`nat_t2`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 20,
    "fragment" : "nat_t2"
  } ]
}


-- !query
SELECT 1 FROM nat_t2 NATURAL JOIN nat_t3 JOIN nat_t4 ON nat_t4.col1 = nat_t3.col1 GROUP BY nat_t4.col2 HAVING nat_t4.col2 = 'x'
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`nat_t2`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 20,
    "fragment" : "nat_t2"
  } ]
}


-- !query
SELECT 1 FROM nat_t2 NATURAL JOIN nat_t3 JOIN nat_t4 ON nat_t4.col1 = nat_t3.col1 ORDER BY nat_t4.col2
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`nat_t2`"
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 15,
    "stopIndex" : 20,
    "fragment" : "nat_t2"
  } ]
}


-- !query
DROP VIEW nat_t2
-- !query analysis
org.apache.spark.sql.catalyst.analysis.NoSuchTableException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`spark_catalog`.`default`.`nat_t2`"
  }
}


-- !query
DROP VIEW nat_t3
-- !query analysis
org.apache.spark.sql.catalyst.analysis.NoSuchTableException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`spark_catalog`.`default`.`nat_t3`"
  }
}


-- !query
DROP VIEW nat_t4
-- !query analysis
org.apache.spark.sql.catalyst.analysis.NoSuchTableException
{
  "errorClass" : "TABLE_OR_VIEW_NOT_FOUND",
  "sqlState" : "42P01",
  "messageParameters" : {
    "relationName" : "`spark_catalog`.`default`.`nat_t4`"
  }
}
