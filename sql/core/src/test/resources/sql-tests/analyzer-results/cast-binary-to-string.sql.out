-- Automatically generated by SQLQueryTestSuite
-- !query
CREATE TEMPORARY VIEW valid_utf8 AS VALUES
  (X'48656C6C6F', 'ASCII Hello'),
  (X'436166C3A9', 'Latin-1: Café'),
  (X'E282AC313030', 'Symbol: €100')
AS data(binary_col, description)
-- !query analysis
CreateViewCommand `valid_utf8`, VALUES
  (X'48656C6C6F', 'ASCII Hello'),
  (X'436166C3A9', 'Latin-1: Café'),
  (X'E282AC313030', 'Symbol: €100')
AS data(binary_col, description), false, false, LocalTempView, UNSUPPORTED, true
   +- SubqueryAlias data
      +- LocalRelation [binary_col#x, description#x]


-- !query
SELECT description, CAST(binary_col AS STRING) AS result FROM valid_utf8
-- !query analysis
Project [description#x, cast(binary_col#x as string) AS result#x]
+- SubqueryAlias valid_utf8
   +- View (`valid_utf8`, [binary_col#x, description#x])
      +- Project [cast(binary_col#x as binary) AS binary_col#x, cast(description#x as string) AS description#x]
         +- SubqueryAlias data
            +- LocalRelation [binary_col#x, description#x]


-- !query
SET spark.sql.ansi.enabled=false
-- !query analysis
SetCommand (spark.sql.ansi.enabled,Some(false))


-- !query
CREATE TEMPORARY VIEW invalid_utf8 AS VALUES
  (X'80', 'Invalid continuation byte'),
  (X'C1', 'Invalid start byte'),
  (X'FF', 'Invalid UTF-8 byte'),
  (X'C080', 'Overlong encoding'),
  (X'E28000', 'Incomplete 3-byte sequence')
AS data(binary_col, description)
-- !query analysis
CreateViewCommand `invalid_utf8`, VALUES
  (X'80', 'Invalid continuation byte'),
  (X'C1', 'Invalid start byte'),
  (X'FF', 'Invalid UTF-8 byte'),
  (X'C080', 'Overlong encoding'),
  (X'E28000', 'Incomplete 3-byte sequence')
AS data(binary_col, description), false, false, LocalTempView, UNSUPPORTED, true
   +- SubqueryAlias data
      +- LocalRelation [binary_col#x, description#x]


-- !query
SELECT description, CAST(binary_col AS STRING) AS result FROM invalid_utf8
-- !query analysis
Project [description#x, cast(binary_col#x as string) AS result#x]
+- SubqueryAlias invalid_utf8
   +- View (`invalid_utf8`, [binary_col#x, description#x])
      +- Project [cast(binary_col#x as binary) AS binary_col#x, cast(description#x as string) AS description#x]
         +- SubqueryAlias data
            +- LocalRelation [binary_col#x, description#x]


-- !query
SET spark.sql.ansi.enabled=true
-- !query analysis
SetCommand (spark.sql.ansi.enabled,Some(true))


-- !query
SELECT CAST(X'80' AS STRING)
-- !query analysis
Project [cast(0x80 as string) AS CAST(X'80' AS STRING)#x]
+- OneRowRelation


-- !query
SET spark.sql.ansi.enabled=false
-- !query analysis
SetCommand (spark.sql.ansi.enabled,Some(false))


-- !query
SELECT
  try_cast(X'48656C6C6F' AS STRING) AS valid_result,
  try_cast(X'80' AS STRING) AS invalid_result
-- !query analysis
Project [try_cast(0x48656C6C6F as string) AS valid_result#x, try_cast(0x80 as string) AS invalid_result#x]
+- OneRowRelation


-- !query
SET spark.sql.castBinaryToString.validateUtf8=false
-- !query analysis
SetCommand (spark.sql.castBinaryToString.validateUtf8,Some(false))


-- !query
SELECT
  CAST(X'80' AS STRING) IS NOT NULL AS invalid_has_value,
  CAST(X'48656C6C6F' AS STRING) AS valid_value
-- !query analysis
Project [isnotnull(cast(0x80 as string)) AS invalid_has_value#x, cast(0x48656C6C6F as string) AS valid_value#x]
+- OneRowRelation


-- !query
SET spark.sql.castBinaryToString.validateUtf8=true
-- !query analysis
SetCommand (spark.sql.castBinaryToString.validateUtf8,Some(true))


-- !query
SELECT CAST(X'48656C6C6F' AS STRING) AS with_validation
-- !query analysis
Project [cast(0x48656C6C6F as string) AS with_validation#x]
+- OneRowRelation


-- !query
SET spark.sql.castBinaryToString.validateUtf8=false
-- !query analysis
SetCommand (spark.sql.castBinaryToString.validateUtf8,Some(false))


-- !query
SELECT CAST(X'48656C6C6F' AS STRING) AS without_validation
-- !query analysis
Project [cast(0x48656C6C6F as string) AS without_validation#x]
+- OneRowRelation


-- !query
DROP VIEW IF EXISTS valid_utf8
-- !query analysis
DropTempViewCommand valid_utf8


-- !query
DROP VIEW IF EXISTS invalid_utf8
-- !query analysis
DropTempViewCommand invalid_utf8
