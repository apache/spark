-- Automatically generated by SQLQueryTestSuite
-- !query
SELECT 'a' AS col1 FROM VALUES (NAMED_STRUCT('a', 1)) t (col1) GROUP BY col1 ORDER BY col1.a
-- !query analysis
Project [col1#x]
+- Sort [col1#x.a ASC NULLS FIRST], true
   +- Aggregate [col1#x], [a AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT 'a' AS col1 FROM VALUES (NAMED_STRUCT('a', 1)) t (col1) GROUP BY col1 HAVING col1.a > 0
-- !query analysis
Project [col1#x]
+- Filter (col1#x.a > 0)
   +- Aggregate [col1#x], [a AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT 'a' AS col1 FROM VALUES (NAMED_STRUCT('a', 1)) t (col1) GROUP BY col1 HAVING col1.a > 0 ORDER BY col1.a
-- !query analysis
Project [col1#x]
+- Sort [col1#x.a ASC NULLS FIRST], true
   +- Project [col1#x, col1#x]
      +- Filter (col1#x.a > 0)
         +- Aggregate [col1#x], [a AS col1#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('a', 1) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 ORDER BY col1.a
-- !query analysis
Sort [col1#x.a ASC NULLS FIRST], true
+- Aggregate [col1#x], [named_struct(a, 1) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('a', 1) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 HAVING col1.a > 0
-- !query analysis
Filter (col1#x.a > 0)
+- Aggregate [col1#x], [named_struct(a, 1) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('a', 1) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 HAVING col1.a > 0 ORDER BY col1.a
-- !query analysis
Sort [col1#x.a ASC NULLS FIRST], true
+- Filter (col1#x.a > 0)
   +- Aggregate [col1#x], [named_struct(a, 1) AS col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('a', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 ORDER BY col1.a
-- !query analysis
Sort [col1#x.a ASC NULLS FIRST], true
+- Aggregate [col1#x], [named_struct(a, 1) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('a', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 HAVING col1.a > 0
-- !query analysis
Project [col1#x]
+- Filter (col1#x.a > 0)
   +- Aggregate [col1#x], [named_struct(a, 1) AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('a', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 HAVING col1.a > 0 ORDER BY col1.a
-- !query analysis
Sort [col1#x.a ASC NULLS FIRST], true
+- Project [col1#x]
   +- Filter (col1#x.a > 0)
      +- Aggregate [col1#x], [named_struct(a, 1) AS col1#x, col1#x]
         +- SubqueryAlias t
            +- LocalRelation [col1#x]


-- !query
SELECT 'a' AS col1 FROM VALUES (ARRAY(1)) t (col1) GROUP BY col1 ORDER BY col1[0]
-- !query analysis
Project [col1#x]
+- Sort [col1#x[0] ASC NULLS FIRST], true
   +- Aggregate [col1#x], [a AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT 'a' AS col1 FROM VALUES (ARRAY(1)) t (col1) GROUP BY col1 HAVING col1[0] > 0
-- !query analysis
Project [col1#x]
+- Filter (col1#x[0] > 0)
   +- Aggregate [col1#x], [a AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT 'a' AS col1 FROM VALUES (ARRAY(1)) t (col1) GROUP BY col1 HAVING col1[0] > 0 ORDER BY col1[0]
-- !query analysis
Project [col1#x]
+- Sort [col1#x[0] ASC NULLS FIRST], true
   +- Project [col1#x, col1#x]
      +- Filter (col1#x[0] > 0)
         +- Aggregate [col1#x], [a AS col1#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT ARRAY(1) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 ORDER BY col1[0]
-- !query analysis
Sort [col1#x[0] ASC NULLS FIRST], true
+- Aggregate [col1#x], [array(1) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT ARRAY(1) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 HAVING col1[0] > 0
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "INVALID_EXTRACT_BASE_FIELD_TYPE",
  "sqlState" : "42000",
  "messageParameters" : {
    "base" : "\"tempresolvedcolumn(col1)\"",
    "other" : "\"STRING\""
  }
}


-- !query
SELECT NAMED_STRUCT('a', NAMED_STRUCT('b', 1)) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 ORDER BY col1.a.b
-- !query analysis
Sort [col1#x.a.b ASC NULLS FIRST], true
+- Aggregate [col1#x], [named_struct(a, named_struct(b, 1)) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('a', NAMED_STRUCT('b', 1)) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 HAVING col1.a.b > 0
-- !query analysis
Filter (col1#x.a.b > 0)
+- Aggregate [col1#x], [named_struct(a, named_struct(b, 1)) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('a', NAMED_STRUCT('b', 1)) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 HAVING col1.a.b > 0 ORDER BY col1.a.b
-- !query analysis
Sort [col1#x.a.b ASC NULLS FIRST], true
+- Filter (col1#x.a.b > 0)
   +- Aggregate [col1#x], [named_struct(a, named_struct(b, 1)) AS col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT ARRAY(NAMED_STRUCT('a', 1)) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 ORDER BY col1[0].a
-- !query analysis
Sort [col1#x[0].a ASC NULLS FIRST], true
+- Aggregate [col1#x], [array(named_struct(a, 1)) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT ARRAY(NAMED_STRUCT('a', 1)) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 HAVING col1[0].a > 0
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "INVALID_EXTRACT_BASE_FIELD_TYPE",
  "sqlState" : "42000",
  "messageParameters" : {
    "base" : "\"tempresolvedcolumn(col1)\"",
    "other" : "\"STRING\""
  }
}


-- !query
SELECT 'a' AS col1 FROM VALUES (MAP('key', 1)) t (col1) GROUP BY col1 ORDER BY col1['key']
-- !query analysis
Project [col1#x]
+- Sort [col1#x[key] ASC NULLS FIRST], true
   +- Aggregate [col1#x], [a AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT 'a' AS col1 FROM VALUES (MAP('key', 1)) t (col1) GROUP BY col1 HAVING col1['key'] > 0
-- !query analysis
Project [col1#x]
+- Filter (col1#x[key] > 0)
   +- Aggregate [col1#x], [a AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT 'a' AS col1 FROM VALUES (MAP('key', 1)) t (col1) GROUP BY col1 HAVING col1['key'] > 0 ORDER BY col1['key']
-- !query analysis
Project [col1#x]
+- Sort [col1#x[key] ASC NULLS FIRST], true
   +- Project [col1#x, col1#x]
      +- Filter (col1#x[key] > 0)
         +- Aggregate [col1#x], [a AS col1#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT MAP('key', 1) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 ORDER BY col1['key']
-- !query analysis
Sort [col1#x[key] ASC NULLS FIRST], true
+- Aggregate [col1#x], [map(key, 1) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT MAP('key', 1) AS col1 FROM VALUES ('a') t (col1) GROUP BY col1 HAVING col1['key'] > 0
-- !query analysis
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "INVALID_EXTRACT_BASE_FIELD_TYPE",
  "sqlState" : "42000",
  "messageParameters" : {
    "base" : "\"tempresolvedcolumn(col1)\"",
    "other" : "\"STRING\""
  }
}


-- !query
SELECT named_struct('a',1) as col, col1
FROM values(named_struct('a',1))
ORDER BY col1.a
-- !query analysis
Sort [col1#x.a ASC NULLS FIRST], true
+- Project [named_struct(a, 1) AS col#x, col1#x]
   +- LocalRelation [col1#x]


-- !query
SELECT named_struct('a', 1) AS col1, col1
FROM values(named_struct('a', 1))
GROUP BY col1
HAVING col1.a > 0
-- !query analysis
Filter (col1#x.a > 0)
+- Aggregate [col1#x], [named_struct(a, 1) AS col1#x, col1#x]
   +- LocalRelation [col1#x]


-- !query
SELECT array(1, 2, 3) AS col1, col1
FROM values(array(1, 2, 3))
ORDER BY col1[0]
-- !query analysis
Sort [col1#x[0] ASC NULLS FIRST], true
+- Project [array(1, 2, 3) AS col1#x, col1#x]
   +- LocalRelation [col1#x]


-- !query
SELECT array(1, 2, 3) AS col1, col1
FROM values(array(1, 2, 3))
GROUP BY col1
HAVING col1[1] > 1
-- !query analysis
Filter (col1#x[1] > 1)
+- Aggregate [col1#x], [array(1, 2, 3) AS col1#x, col1#x]
   +- LocalRelation [col1#x]


-- !query
SELECT map('a', 1, 'b', 2) AS col1, col1
FROM values(map('a', 1, 'b', 2))
ORDER BY col1['a']
-- !query analysis
Sort [col1#x[a] ASC NULLS FIRST], true
+- Project [map(a, 1, b, 2) AS col1#x, col1#x]
   +- LocalRelation [col1#x]


-- !query
SELECT map('a', 1, 'b', 2) AS col1, col1
FROM values(map('a', 1, 'b', 2))
GROUP BY col1
HAVING col1['b'] > 1
-- !query analysis
Filter (col1#x[b] > 1)
+- Aggregate [col1#x], [map(a, 1, b, 2) AS col1#x, col1#x]
   +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('b', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 ORDER BY col1.a
-- !query analysis
Project [col1#x]
+- Sort [col1#x.a ASC NULLS FIRST], true
   +- Aggregate [col1#x], [named_struct(b, 1) AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('b', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 HAVING col1.a > 0
-- !query analysis
Project [col1#x]
+- Filter (col1#x.a > 0)
   +- Aggregate [col1#x], [named_struct(b, 1) AS col1#x, col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('b', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 HAVING col1.a > 0 ORDER BY col1.a
-- !query analysis
Project [col1#x]
+- Sort [col1#x.a ASC NULLS FIRST], true
   +- Project [col1#x, col1#x]
      +- Filter (col1#x.a > 0)
         +- Aggregate [col1#x], [named_struct(b, 1) AS col1#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('b', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 ORDER BY col1.b
-- !query analysis
Sort [col1#x.b ASC NULLS FIRST], true
+- Aggregate [col1#x], [named_struct(b, 1) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('b', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 HAVING col1.b > 0
-- !query analysis
Filter (col1#x.b > 0)
+- Aggregate [col1#x], [named_struct(b, 1) AS col1#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT NAMED_STRUCT('b', 1) AS col1 FROM VALUES (NAMED_STRUCT('a', 0)) t (col1) GROUP BY col1 HAVING col1.b > 0 ORDER BY col1.b
-- !query analysis
Sort [col1#x.b ASC NULLS FIRST], true
+- Filter (col1#x.b > 0)
   +- Aggregate [col1#x], [named_struct(b, 1) AS col1#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT col1.name
FROM VALUES (NAMED_STRUCT('name', 'test', 'id', 1)) t (col1)
GROUP BY col1
HAVING col1.id > 0
ORDER BY col1.name
-- !query analysis
Project [name#x]
+- Sort [col1#x.name ASC NULLS FIRST], true
   +- Project [name#x, col1#x]
      +- Filter (col1#x.id > 0)
         +- Aggregate [col1#x], [col1#x.name AS name#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT col1.items[0]
FROM VALUES (NAMED_STRUCT('items', ARRAY(1, 2, 3))) t (col1)
GROUP BY col1
HAVING col1.items[0] > 0
ORDER BY col1.items[0]
-- !query analysis
Sort [col1.items[0]#x ASC NULLS FIRST], true
+- Filter (col1.items[0]#x > 0)
   +- Aggregate [col1#x], [col1#x.items[0] AS col1.items[0]#x]
      +- SubqueryAlias t
         +- LocalRelation [col1#x]


-- !query
SELECT col1.data['key']
FROM VALUES (NAMED_STRUCT('data', MAP('key', 'value', 'num', '42'))) t (col1)
GROUP BY col1
HAVING col1.data['num'] IS NOT NULL
ORDER BY col1.data['key']
-- !query analysis
Project [col1.data[key]#x]
+- Sort [col1#x.data[key] ASC NULLS FIRST], true
   +- Project [col1.data[key]#x, col1#x]
      +- Filter isnotnull(col1#x.data[num])
         +- Aggregate [col1#x], [col1#x.data[key] AS col1.data[key]#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT col1.users[0].name
FROM VALUES (
             NAMED_STRUCT('users', ARRAY(NAMED_STRUCT('name', 'John', 'age', 30)))
     ) t (col1)
GROUP BY col1
HAVING col1.users[0].age > 25
ORDER BY col1.users[0].name
-- !query analysis
Project [col1.users[0].name#x]
+- Sort [col1#x.users[0].name ASC NULLS FIRST], true
   +- Project [col1.users[0].name#x, col1#x]
      +- Filter (col1#x.users[0].age > 25)
         +- Aggregate [col1#x], [col1#x.users[0].name AS col1.users[0].name#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT col1.person.address.city
FROM VALUES (
             NAMED_STRUCT('person', NAMED_STRUCT('address', NAMED_STRUCT('city', 'NYC', 'zip', 10001)))
     ) t (col1)
GROUP BY col1
HAVING col1.person.address.zip > 10000
ORDER BY col1.person.address.city
-- !query analysis
Project [city#x]
+- Sort [col1#x.person.address.city ASC NULLS FIRST], true
   +- Project [city#x, col1#x]
      +- Filter (col1#x.person.address.zip > 10000)
         +- Aggregate [col1#x], [col1#x.person.address.city AS city#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT col1.matrix[0][1]
FROM VALUES (
             NAMED_STRUCT('matrix', ARRAY(ARRAY(1, 2), ARRAY(3, 4)))
     ) t (col1)
GROUP BY col1
HAVING col1.matrix[0][0] < 5
ORDER BY col1.matrix[0][1]
-- !query analysis
Project [col1.matrix[0][1]#x]
+- Sort [col1#x.matrix[0][1] ASC NULLS FIRST], true
   +- Project [col1.matrix[0][1]#x, col1#x]
      +- Filter (col1#x.matrix[0][0] < 5)
         +- Aggregate [col1#x], [col1#x.matrix[0][1] AS col1.matrix[0][1]#x, col1#x]
            +- SubqueryAlias t
               +- LocalRelation [col1#x]


-- !query
SELECT col1.data[0].props['status']
FROM VALUES (
             NAMED_STRUCT('data', ARRAY(NAMED_STRUCT('props', MAP('status', 'active'))))
     ) t (col1)
GROUP BY col1
HAVING col1.data[0].props['status'] = 'active'
-- !query analysis
Filter (col1.data[0].props[status]#x = active)
+- Aggregate [col1#x], [col1#x.data[0].props[status] AS col1.data[0].props[status]#x]
   +- SubqueryAlias t
      +- LocalRelation [col1#x]


-- !query
SELECT col1.nums[0] + col1.nums[1] AS sum_val
FROM VALUES (NAMED_STRUCT('nums', ARRAY(10, 20))) t (col1)
GROUP BY col1
HAVING col1.nums[0] + col1.nums[1] > 25
ORDER BY col1.nums[0]
-- !query analysis
Project [sum_val#x]
+- Sort [col1#x.nums[0] ASC NULLS FIRST], true
   +- Filter (sum_val#x > 25)
      +- Aggregate [col1#x], [(col1#x.nums[0] + col1#x.nums[1]) AS sum_val#x, col1#x]
         +- SubqueryAlias t
            +- LocalRelation [col1#x]
