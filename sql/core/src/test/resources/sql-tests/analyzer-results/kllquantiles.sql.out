-- Automatically generated by SQLQueryTestSuite
-- !query
DROP TABLE IF EXISTS t_int_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_int_1_5_through_7_11


-- !query
CREATE TABLE t_int_1_5_through_7_11 AS
VALUES 
  (1, 5), (2, 6), (3, 7), (4, 8), (5, 9), (6, 10), (7, 11) AS tab(col1, col2)
-- !query analysis
CreateDataSourceTableAsSelectCommand `spark_catalog`.`default`.`t_int_1_5_through_7_11`, ErrorIfExists, [col1, col2]
   +- SubqueryAlias tab
      +- LocalRelation [col1#x, col2#x]


-- !query
DROP TABLE IF EXISTS t_long_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_long_1_5_through_7_11


-- !query
CREATE TABLE t_long_1_5_through_7_11 AS
VALUES
  (1L, 5L), (2L, 6L), (3L, 7L), (4L, 8L), (5L, 9L), (6L, 10L), (7L, 11L) AS tab(col1, col2)
-- !query analysis
CreateDataSourceTableAsSelectCommand `spark_catalog`.`default`.`t_long_1_5_through_7_11`, ErrorIfExists, [col1, col2]
   +- SubqueryAlias tab
      +- LocalRelation [col1#xL, col2#xL]


-- !query
DROP TABLE IF EXISTS t_short_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_short_1_5_through_7_11


-- !query
CREATE TABLE t_short_1_5_through_7_11 AS
VALUES
    (CAST(1 AS SMALLINT), CAST(5 AS SMALLINT)),
    (CAST(2 AS SMALLINT), CAST(6 AS SMALLINT)),
    (CAST(3 AS SMALLINT), CAST(7 AS SMALLINT)),
    (CAST(4 AS SMALLINT), CAST(8 AS SMALLINT)),
    (CAST(5 AS SMALLINT), CAST(9 AS SMALLINT)),
    (CAST(6 AS SMALLINT), CAST(10 AS SMALLINT)),
    (CAST(7 AS SMALLINT), CAST(11 AS SMALLINT))
    AS tab(col1, col2)
-- !query analysis
CreateDataSourceTableAsSelectCommand `spark_catalog`.`default`.`t_short_1_5_through_7_11`, ErrorIfExists, [col1, col2]
   +- SubqueryAlias tab
      +- LocalRelation [col1#x, col2#x]


-- !query
DROP TABLE IF EXISTS t_byte_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_byte_1_5_through_7_11


-- !query
CREATE TABLE t_byte_1_5_through_7_11 AS
VALUES
    (CAST(1 AS TINYINT), CAST(5 AS TINYINT)),
    (CAST(2 AS TINYINT), CAST(6 AS TINYINT)),
    (CAST(3 AS TINYINT), CAST(7 AS TINYINT)),
    (CAST(4 AS TINYINT), CAST(8 AS TINYINT)),
    (CAST(5 AS TINYINT), CAST(9 AS TINYINT)),
    (CAST(6 AS TINYINT), CAST(10 AS TINYINT)),
    (CAST(7 AS TINYINT), CAST(11 AS TINYINT))
    AS tab(col1, col2)
-- !query analysis
CreateDataSourceTableAsSelectCommand `spark_catalog`.`default`.`t_byte_1_5_through_7_11`, ErrorIfExists, [col1, col2]
   +- SubqueryAlias tab
      +- LocalRelation [col1#x, col2#x]


-- !query
DROP TABLE IF EXISTS t_float_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_float_1_5_through_7_11


-- !query
CREATE TABLE t_float_1_5_through_7_11 AS
VALUES
    (CAST(1 AS FLOAT), CAST(5 AS FLOAT)),
    (CAST(2 AS FLOAT), CAST(6 AS FLOAT)),
    (CAST(3 AS FLOAT), CAST(7 AS FLOAT)),
    (CAST(4 AS FLOAT), CAST(8 AS FLOAT)),
    (CAST(5 AS FLOAT), CAST(9 AS FLOAT)),
    (CAST(6 AS FLOAT), CAST(10 AS FLOAT)),
    (CAST(7 AS FLOAT), CAST(11 AS FLOAT)) AS tab(col1, col2)
-- !query analysis
CreateDataSourceTableAsSelectCommand `spark_catalog`.`default`.`t_float_1_5_through_7_11`, ErrorIfExists, [col1, col2]
   +- SubqueryAlias tab
      +- LocalRelation [col1#x, col2#x]


-- !query
DROP TABLE IF EXISTS t_double_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_double_1_5_through_7_11


-- !query
CREATE TABLE t_double_1_5_through_7_11 AS
VALUES
    (CAST(1 AS DOUBLE), CAST(5 AS DOUBLE)),
    (CAST(2 AS DOUBLE), CAST(6 AS DOUBLE)),
    (CAST(3 AS DOUBLE), CAST(7 AS DOUBLE)),
    (CAST(4 AS DOUBLE), CAST(8 AS DOUBLE)),
    (CAST(5 AS DOUBLE), CAST(9 AS DOUBLE)),
    (CAST(6 AS DOUBLE), CAST(10 AS DOUBLE)),
    (CAST(7 AS DOUBLE), CAST(11 AS DOUBLE)) AS tab(col1, col2)
-- !query analysis
CreateDataSourceTableAsSelectCommand `spark_catalog`.`default`.`t_double_1_5_through_7_11`, ErrorIfExists, [col1, col2]
   +- SubqueryAlias tab
      +- LocalRelation [col1#x, col2#x]


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_byte_1_5_through_7_11
)
-- !query analysis
Project [split(kll_sketch_to_string_bigint(agg#x), 
, -1)[1] LIKE %Kll% AS str_contains_kll#x, (abs((kll_sketch_get_quantile_bigint(agg#x, cast(0.5 as double)) - cast(4 as bigint))) < cast(1 as bigint)) AS median_close_to_4#x, (abs((kll_sketch_get_rank_bigint(agg#x, cast(3 as bigint)) - cast(0.4 as double))) < cast(0.1 as double)) AS rank3_close_to_0_4#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#x, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_byte_1_5_through_7_11
         +- Relation spark_catalog.default.t_byte_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_int_1_5_through_7_11
)
-- !query analysis
Project [split(kll_sketch_to_string_bigint(agg#x), 
, -1)[1] LIKE %Kll% AS str_contains_kll#x, (abs((kll_sketch_get_quantile_bigint(agg#x, cast(0.5 as double)) - cast(4 as bigint))) < cast(1 as bigint)) AS median_close_to_4#x, (abs((kll_sketch_get_rank_bigint(agg#x, cast(3 as bigint)) - cast(0.4 as double))) < cast(0.1 as double)) AS rank3_close_to_0_4#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#x, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_int_1_5_through_7_11
         +- Relation spark_catalog.default.t_int_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query analysis
Project [split(kll_sketch_to_string_bigint(agg#x), 
, -1)[1] LIKE %Kll% AS str_contains_kll#x, (abs((kll_sketch_get_quantile_bigint(agg#x, cast(0.5 as double)) - cast(4 as bigint))) < cast(1 as bigint)) AS median_close_to_4#x, (abs((kll_sketch_get_rank_bigint(agg#x, cast(3 as bigint)) - cast(0.4 as double))) < cast(0.1 as double)) AS rank3_close_to_0_4#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
         +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_short_1_5_through_7_11
)
-- !query analysis
Project [split(kll_sketch_to_string_bigint(agg#x), 
, -1)[1] LIKE %Kll% AS str_contains_kll#x, (abs((kll_sketch_get_quantile_bigint(agg#x, cast(0.5 as double)) - cast(4 as bigint))) < cast(1 as bigint)) AS median_close_to_4#x, (abs((kll_sketch_get_rank_bigint(agg#x, cast(3 as bigint)) - cast(0.4 as double))) < cast(0.1 as double)) AS rank3_close_to_0_4#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#x, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_short_1_5_through_7_11
         +- Relation spark_catalog.default.t_short_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT split(kll_sketch_to_string_float(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_float(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_float(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query analysis
Project [split(kll_sketch_to_string_float(agg#x), 
, -1)[1] LIKE %Kll% AS str_contains_kll#x, (abs((cast(kll_sketch_get_quantile_float(agg#x, cast(0.5 as double)) as double) - cast(4.0 as double))) < cast(0.5 as double)) AS median_close_to_4#x, (abs((kll_sketch_get_rank_float(agg#x, cast(3 as float)) - cast(0.4 as double))) < cast(0.1 as double)) AS rank3_close_to_0_4#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_float(col1#x, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_float_1_5_through_7_11
         +- Relation spark_catalog.default.t_float_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT split(kll_sketch_to_string_double(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_double(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_double(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query analysis
Project [split(kll_sketch_to_string_double(agg#x), 
, -1)[1] LIKE %Kll% AS str_contains_kll#x, (abs((kll_sketch_get_quantile_double(agg#x, cast(0.5 as double)) - cast(4.0 as double))) < cast(0.5 as double)) AS median_close_to_4#x, (abs((kll_sketch_get_rank_double(agg#x, cast(3 as double)) - cast(0.4 as double))) < cast(0.1 as double)) AS rank3_close_to_0_4#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_double(col1#x, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_double_1_5_through_7_11
         +- Relation spark_catalog.default.t_double_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT split(kll_sketch_to_string_double(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_double(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_double(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query analysis
Project [split(kll_sketch_to_string_double(agg#x), 
, -1)[1] LIKE %Kll% AS str_contains_kll#x, (abs((kll_sketch_get_quantile_double(agg#x, cast(0.5 as double)) - cast(4.0 as double))) < cast(0.5 as double)) AS median_close_to_4#x, (abs((kll_sketch_get_rank_double(agg#x, cast(3 as double)) - cast(0.4 as double))) < cast(0.1 as double)) AS rank3_close_to_0_4#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_double(col1#x, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_float_1_5_through_7_11
         +- Relation spark_catalog.default.t_float_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT
  split(
    kll_sketch_to_string_bigint(
      kll_sketch_merge_bigint(
        kll_sketch_agg_bigint(col1),
        kll_sketch_agg_bigint(col1)
      )
    ),
    '\n'
  )[1] AS result
  FROM t_byte_1_5_through_7_11
-- !query analysis
Aggregate [split(kll_sketch_to_string_bigint(kll_sketch_merge_bigint(kll_sketch_agg_bigint(col1#x, None, 0, 0), kll_sketch_agg_bigint(col1#x, None, 0, 0))), 
, -1)[1] AS result#x]
+- SubqueryAlias spark_catalog.default.t_byte_1_5_through_7_11
   +- Relation spark_catalog.default.t_byte_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT
  split(
    kll_sketch_to_string_float(
      kll_sketch_merge_float(
        kll_sketch_agg_float(col1),
        kll_sketch_agg_float(col1)
      )
    ),
    '\n'
  )[1] AS result
FROM t_byte_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"TINYINT\"",
    "paramIndex" : "first",
    "requiredType" : "\"FLOAT\"",
    "sqlExpr" : "\"kll_sketch_agg_float(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 87,
    "stopIndex" : 112,
    "fragment" : "kll_sketch_agg_float(col1)"
  } ]
}


-- !query
SELECT
  split(
    kll_sketch_to_string_double(
      kll_sketch_merge_double(
        kll_sketch_agg_double(col1),
        kll_sketch_agg_double(col1)
      )
    ),
    '\n'
  )[1] AS result
FROM t_byte_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"TINYINT\"",
    "paramIndex" : "first",
    "requiredType" : "(\"FLOAT\" or \"DOUBLE\")",
    "sqlExpr" : "\"kll_sketch_agg_double(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 89,
    "stopIndex" : 115,
    "fragment" : "kll_sketch_agg_double(col1)"
  } ]
}


-- !query
SELECT abs(kll_sketch_get_quantile_bigint(agg_with_nulls, 0.5) - 
           kll_sketch_get_quantile_bigint(agg_without_nulls, 0.5)) < 1 AS medians_match,
       abs(kll_sketch_get_rank_bigint(agg_with_nulls, 4) - 
           kll_sketch_get_rank_bigint(agg_without_nulls, 4)) < 0.1 AS ranks_match
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg_with_nulls
    FROM (VALUES (1L), (CAST(NULL AS BIGINT)), (3L), (5L), (CAST(NULL AS BIGINT)), (7L)) AS tab(col1)
) WITH_NULLS,
(
    SELECT kll_sketch_agg_bigint(col1) AS agg_without_nulls
    FROM (VALUES (1L), (3L), (5L), (7L)) AS tab(col1)
) WITHOUT_NULLS
-- !query analysis
Project [(abs((kll_sketch_get_quantile_bigint(agg_with_nulls#x, cast(0.5 as double)) - kll_sketch_get_quantile_bigint(agg_without_nulls#x, cast(0.5 as double)))) < cast(1 as bigint)) AS medians_match#x, (abs((kll_sketch_get_rank_bigint(agg_with_nulls#x, cast(4 as bigint)) - kll_sketch_get_rank_bigint(agg_without_nulls#x, cast(4 as bigint)))) < cast(0.1 as double)) AS ranks_match#x]
+- Join Inner
   :- SubqueryAlias WITH_NULLS
   :  +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg_with_nulls#x]
   :     +- SubqueryAlias tab
   :        +- Project [col1#xL AS col1#xL]
   :           +- LocalRelation [col1#xL]
   +- SubqueryAlias WITHOUT_NULLS
      +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg_without_nulls#x]
         +- SubqueryAlias tab
            +- Project [col1#xL AS col1#xL]
               +- LocalRelation [col1#xL]


-- !query
SELECT abs(kll_sketch_get_quantile_float(agg_with_nulls, 0.5) - 
           kll_sketch_get_quantile_float(agg_without_nulls, 0.5)) < 0.5 AS medians_match,
       abs(kll_sketch_get_rank_float(agg_with_nulls, 4.0) - 
           kll_sketch_get_rank_float(agg_without_nulls, 4.0)) < 0.1 AS ranks_match
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg_with_nulls
    FROM (VALUES (1.0F), (CAST(NULL AS FLOAT)), (3.0F), (5.0F), (CAST(NULL AS FLOAT)), (7.0F)) AS tab(col1)
) WITH_NULLS,
(
    SELECT kll_sketch_agg_float(col1) AS agg_without_nulls
    FROM (VALUES (1.0F), (3.0F), (5.0F), (7.0F)) AS tab(col1)
) WITHOUT_NULLS
-- !query analysis
Project [(cast(abs((kll_sketch_get_quantile_float(agg_with_nulls#x, cast(0.5 as double)) - kll_sketch_get_quantile_float(agg_without_nulls#x, cast(0.5 as double)))) as double) < cast(0.5 as double)) AS medians_match#x, (abs((kll_sketch_get_rank_float(agg_with_nulls#x, cast(4.0 as float)) - kll_sketch_get_rank_float(agg_without_nulls#x, cast(4.0 as float)))) < cast(0.1 as double)) AS ranks_match#x]
+- Join Inner
   :- SubqueryAlias WITH_NULLS
   :  +- Aggregate [kll_sketch_agg_float(col1#x, None, 0, 0) AS agg_with_nulls#x]
   :     +- SubqueryAlias tab
   :        +- Project [col1#x AS col1#x]
   :           +- LocalRelation [col1#x]
   +- SubqueryAlias WITHOUT_NULLS
      +- Aggregate [kll_sketch_agg_float(col1#x, None, 0, 0) AS agg_without_nulls#x]
         +- SubqueryAlias tab
            +- Project [col1#x AS col1#x]
               +- LocalRelation [col1#x]


-- !query
SELECT abs(kll_sketch_get_quantile_double(agg_with_nulls, 0.5) - 
           kll_sketch_get_quantile_double(agg_without_nulls, 0.5)) < 0.5 AS medians_match,
       abs(kll_sketch_get_rank_double(agg_with_nulls, 4.0) - 
           kll_sketch_get_rank_double(agg_without_nulls, 4.0)) < 0.1 AS ranks_match
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg_with_nulls
    FROM (VALUES (1.0D), (CAST(NULL AS DOUBLE)), (3.0D), (5.0D), (CAST(NULL AS DOUBLE)), (7.0D)) AS tab(col1)
) WITH_NULLS,
(
    SELECT kll_sketch_agg_double(col1) AS agg_without_nulls
    FROM (VALUES (1.0D), (3.0D), (5.0D), (7.0D)) AS tab(col1)
) WITHOUT_NULLS
-- !query analysis
Project [(abs((kll_sketch_get_quantile_double(agg_with_nulls#x, cast(0.5 as double)) - kll_sketch_get_quantile_double(agg_without_nulls#x, cast(0.5 as double)))) < cast(0.5 as double)) AS medians_match#x, (abs((kll_sketch_get_rank_double(agg_with_nulls#x, cast(4.0 as double)) - kll_sketch_get_rank_double(agg_without_nulls#x, cast(4.0 as double)))) < cast(0.1 as double)) AS ranks_match#x]
+- Join Inner
   :- SubqueryAlias WITH_NULLS
   :  +- Aggregate [kll_sketch_agg_double(col1#x, None, 0, 0) AS agg_with_nulls#x]
   :     +- SubqueryAlias tab
   :        +- Project [col1#x AS col1#x]
   :           +- LocalRelation [col1#x]
   +- SubqueryAlias WITHOUT_NULLS
      +- Aggregate [kll_sketch_agg_double(col1#x, None, 0, 0) AS agg_without_nulls#x]
         +- SubqueryAlias tab
            +- Project [col1#x AS col1#x]
               +- LocalRelation [col1#x]


-- !query
SELECT kll_sketch_get_quantile_bigint(CAST(NULL AS BINARY), 0.5) AS null_sketch
-- !query analysis
Project [kll_sketch_get_quantile_bigint(cast(null as binary), cast(0.5 as double)) AS null_sketch#xL]
+- OneRowRelation


-- !query
SELECT kll_sketch_get_rank_float(CAST(NULL AS BINARY), 5.0) AS null_sketch
-- !query analysis
Project [kll_sketch_get_rank_float(cast(null as binary), cast(5.0 as float)) AS null_sketch#x]
+- OneRowRelation


-- !query
SELECT LENGTH(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1, 8))) > 0 AS k_min_value
FROM t_long_1_5_through_7_11
-- !query analysis
Aggregate [(length(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1#xL, Some(8), 0, 0))) > 0) AS k_min_value#x]
+- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
   +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT LENGTH(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1, 200))) > 0 AS k_default_value
FROM t_long_1_5_through_7_11
-- !query analysis
Aggregate [(length(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1#xL, Some(200), 0, 0))) > 0) AS k_default_value#x]
+- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
   +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT LENGTH(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1, 400))) > 0 AS k_custom_value
FROM t_long_1_5_through_7_11
-- !query analysis
Aggregate [(length(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1#xL, Some(400), 0, 0))) > 0) AS k_custom_value#x]
+- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
   +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT LENGTH(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1, 65535))) > 0 AS k_max_value
FROM t_long_1_5_through_7_11
-- !query analysis
Aggregate [(length(kll_sketch_to_string_bigint(kll_sketch_agg_bigint(col1#xL, Some(65535), 0, 0))) > 0) AS k_max_value#x]
+- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
   +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT LENGTH(kll_sketch_to_string_float(kll_sketch_agg_float(col1, 100))) > 0 AS k_float_sketch
FROM t_float_1_5_through_7_11
-- !query analysis
Aggregate [(length(kll_sketch_to_string_float(kll_sketch_agg_float(col1#x, Some(100), 0, 0))) > 0) AS k_float_sketch#x]
+- SubqueryAlias spark_catalog.default.t_float_1_5_through_7_11
   +- Relation spark_catalog.default.t_float_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT LENGTH(kll_sketch_to_string_double(kll_sketch_agg_double(col1, 300))) > 0 AS k_double_sketch
FROM t_double_1_5_through_7_11
-- !query analysis
Aggregate [(length(kll_sketch_to_string_double(kll_sketch_agg_double(col1#x, Some(300), 0, 0))) > 0) AS k_double_sketch#x]
+- SubqueryAlias spark_catalog.default.t_double_1_5_through_7_11
   +- Relation spark_catalog.default.t_double_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1)) AS n_bigint
FROM t_long_1_5_through_7_11
-- !query analysis
Aggregate [kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1#xL, None, 0, 0)) AS n_bigint#xL]
+- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
   +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1)) AS n_byte
FROM t_byte_1_5_through_7_11
-- !query analysis
Aggregate [kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1#x, None, 0, 0)) AS n_byte#xL]
+- SubqueryAlias spark_catalog.default.t_byte_1_5_through_7_11
   +- Relation spark_catalog.default.t_byte_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1)) AS n_short
FROM t_short_1_5_through_7_11
-- !query analysis
Aggregate [kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1#x, None, 0, 0)) AS n_short#xL]
+- SubqueryAlias spark_catalog.default.t_short_1_5_through_7_11
   +- Relation spark_catalog.default.t_short_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1)) AS n_int
FROM t_int_1_5_through_7_11
-- !query analysis
Aggregate [kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1#x, None, 0, 0)) AS n_int#xL]
+- SubqueryAlias spark_catalog.default.t_int_1_5_through_7_11
   +- Relation spark_catalog.default.t_int_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT kll_sketch_get_n_float(kll_sketch_agg_float(col1)) AS n_float
FROM t_float_1_5_through_7_11
-- !query analysis
Aggregate [kll_sketch_get_n_float(kll_sketch_agg_float(col1#x, None, 0, 0)) AS n_float#xL]
+- SubqueryAlias spark_catalog.default.t_float_1_5_through_7_11
   +- Relation spark_catalog.default.t_float_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT kll_sketch_get_n_double(kll_sketch_agg_double(col1)) AS n_double
FROM t_double_1_5_through_7_11
-- !query analysis
Aggregate [kll_sketch_get_n_double(kll_sketch_agg_double(col1#x, None, 0, 0)) AS n_double#xL]
+- SubqueryAlias spark_catalog.default.t_double_1_5_through_7_11
   +- Relation spark_catalog.default.t_double_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1, 100)) AS n_k_100
FROM t_long_1_5_through_7_11
-- !query analysis
Aggregate [kll_sketch_get_n_bigint(kll_sketch_agg_bigint(col1#xL, Some(100), 0, 0)) AS n_k_100#xL]
+- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
   +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"DOUBLE\"",
    "paramIndex" : "first",
    "requiredType" : "(\"TINYINT\" or \"INT\" or \"BIGINT\" or \"SMALLINT\")",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 273,
    "stopIndex" : 299,
    "fragment" : "kll_sketch_agg_bigint(col1)"
  } ]
}


-- !query
SELECT split(kll_sketch_to_string_bigint(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_bigint(agg, 0.5) - 4) < 1 AS median_close_to_4,
       abs(kll_sketch_get_rank_bigint(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"FLOAT\"",
    "paramIndex" : "first",
    "requiredType" : "(\"TINYINT\" or \"INT\" or \"BIGINT\" or \"SMALLINT\")",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 273,
    "stopIndex" : 299,
    "fragment" : "kll_sketch_agg_bigint(col1)"
  } ]
}


-- !query
SELECT split(kll_sketch_to_string_float(agg), '\n')[1] LIKE '%Kll%' AS str_contains_kll,
       abs(kll_sketch_get_quantile_float(agg, 0.5) - 4.0) < 0.5 AS median_close_to_4,
       abs(kll_sketch_get_rank_float(agg, 3) - 0.4) < 0.1 AS rank3_close_to_0_4
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"DOUBLE\"",
    "paramIndex" : "first",
    "requiredType" : "\"FLOAT\"",
    "sqlExpr" : "\"kll_sketch_agg_float(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 274,
    "stopIndex" : 299,
    "fragment" : "kll_sketch_agg_float(col1)"
  } ]
}


-- !query
SELECT kll_sketch_agg_float(col1) AS invalid_float_bigint
FROM t_long_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"BIGINT\"",
    "paramIndex" : "first",
    "requiredType" : "\"FLOAT\"",
    "sqlExpr" : "\"kll_sketch_agg_float(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 33,
    "fragment" : "kll_sketch_agg_float(col1)"
  } ]
}


-- !query
SELECT kll_sketch_agg_float(col1) AS invalid_float_int
FROM t_int_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"FLOAT\"",
    "sqlExpr" : "\"kll_sketch_agg_float(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 33,
    "fragment" : "kll_sketch_agg_float(col1)"
  } ]
}


-- !query
SELECT kll_sketch_agg_float(col1) AS invalid_float_short
FROM t_short_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"SMALLINT\"",
    "paramIndex" : "first",
    "requiredType" : "\"FLOAT\"",
    "sqlExpr" : "\"kll_sketch_agg_float(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 33,
    "fragment" : "kll_sketch_agg_float(col1)"
  } ]
}


-- !query
SELECT kll_sketch_agg_float(col1) AS invalid_float_byte
FROM t_byte_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"TINYINT\"",
    "paramIndex" : "first",
    "requiredType" : "\"FLOAT\"",
    "sqlExpr" : "\"kll_sketch_agg_float(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 33,
    "fragment" : "kll_sketch_agg_float(col1)"
  } ]
}


-- !query
SELECT kll_sketch_agg_double(col1) AS invalid_double_bigint
FROM t_long_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"BIGINT\"",
    "paramIndex" : "first",
    "requiredType" : "(\"FLOAT\" or \"DOUBLE\")",
    "sqlExpr" : "\"kll_sketch_agg_double(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 34,
    "fragment" : "kll_sketch_agg_double(col1)"
  } ]
}


-- !query
SELECT kll_sketch_agg_double(col1) AS invalid_double_int
FROM t_int_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "(\"FLOAT\" or \"DOUBLE\")",
    "sqlExpr" : "\"kll_sketch_agg_double(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 34,
    "fragment" : "kll_sketch_agg_double(col1)"
  } ]
}


-- !query
SELECT kll_sketch_agg_double(col1) AS invalid_double_short
FROM t_short_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"SMALLINT\"",
    "paramIndex" : "first",
    "requiredType" : "(\"FLOAT\" or \"DOUBLE\")",
    "sqlExpr" : "\"kll_sketch_agg_double(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 34,
    "fragment" : "kll_sketch_agg_double(col1)"
  } ]
}


-- !query
SELECT kll_sketch_agg_double(col1) AS invalid_double_byte
FROM t_byte_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"col1\"",
    "inputType" : "\"TINYINT\"",
    "paramIndex" : "first",
    "requiredType" : "(\"FLOAT\" or \"DOUBLE\")",
    "sqlExpr" : "\"kll_sketch_agg_double(col1)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 34,
    "fragment" : "kll_sketch_agg_double(col1)"
  } ]
}


-- !query
SELECT kll_sketch_get_quantile_bigint(agg, -0.5) AS invalid_quantile
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query analysis
Project [kll_sketch_get_quantile_bigint(agg#x, cast(-0.5 as double)) AS invalid_quantile#xL]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
         +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT kll_sketch_get_quantile_bigint(agg, 1.5) AS invalid_quantile
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query analysis
Project [kll_sketch_get_quantile_bigint(agg#x, cast(1.5 as double)) AS invalid_quantile#xL]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
         +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT kll_sketch_get_quantile_float(agg, array(-0.1, 0.5, 1.5)) AS invalid_quantiles
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query analysis
Project [kll_sketch_get_quantile_float(agg#x, cast(array(cast(-0.1 as decimal(2,1)), cast(0.5 as decimal(2,1)), 1.5) as array<double>)) AS invalid_quantiles#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_float(col1#x, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_float_1_5_through_7_11
         +- Relation spark_catalog.default.t_float_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT kll_sketch_get_rank_bigint(agg, 5) AS wrong_type
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query analysis
Project [kll_sketch_get_rank_bigint(agg#x, cast(5 as bigint)) AS wrong_type#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_float(col1#x, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_float_1_5_through_7_11
         +- Relation spark_catalog.default.t_float_1_5_through_7_11[col1#x,col2#x] parquet


-- !query
SELECT kll_sketch_merge_bigint(agg1, agg2) AS incompatible_merge
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg1,
           kll_sketch_agg_float(CAST(col1 AS FLOAT)) AS agg2
    FROM t_long_1_5_through_7_11
)
-- !query analysis
Project [kll_sketch_merge_bigint(agg1#x, agg2#x) AS incompatible_merge#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg1#x, kll_sketch_agg_float(cast(col1#xL as float), None, 0, 0) AS agg2#x]
      +- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
         +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT kll_sketch_get_quantile_bigint(CAST('not_a_sketch' AS BINARY), 0.5) AS invalid_binary
-- !query analysis
Project [kll_sketch_get_quantile_bigint(cast(not_a_sketch as binary), cast(0.5 as double)) AS invalid_binary#xL]
+- OneRowRelation


-- !query
SELECT kll_sketch_get_quantile_float(agg, 0.5) IS NOT NULL AS returns_value
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query analysis
Project [isnotnull(kll_sketch_get_quantile_float(agg#x, cast(0.5 as double))) AS returns_value#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
         +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT kll_sketch_to_string_double(agg) LIKE '%Kll%' AS contains_kll_header
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query analysis
Project [kll_sketch_to_string_double(agg#x) LIKE %Kll% AS contains_kll_header#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
         +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT kll_sketch_agg_bigint(col1, 7) AS k_too_small
FROM t_long_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.TYPE_CHECK_FAILURE_WITH_HINT",
  "sqlState" : "42K09",
  "messageParameters" : {
    "hint" : "",
    "msg" : "[KLL_SKETCH_K_OUT_OF_RANGE] For function `kll_sketch_agg_bigint`, the k parameter must be between 8 and 65535 (inclusive), but got 7. SQLSTATE: 22003",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1, 7)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 37,
    "fragment" : "kll_sketch_agg_bigint(col1, 7)"
  } ]
}


-- !query
SELECT kll_sketch_agg_bigint(col1, 65536) AS k_too_large
FROM t_long_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.TYPE_CHECK_FAILURE_WITH_HINT",
  "sqlState" : "42K09",
  "messageParameters" : {
    "hint" : "",
    "msg" : "[KLL_SKETCH_K_OUT_OF_RANGE] For function `kll_sketch_agg_bigint`, the k parameter must be between 8 and 65535 (inclusive), but got 65536. SQLSTATE: 22003",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1, 65536)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 41,
    "fragment" : "kll_sketch_agg_bigint(col1, 65536)"
  } ]
}


-- !query
SELECT kll_sketch_agg_float(col1, CAST(NULL AS INT)) AS k_is_null
FROM t_float_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_NULL",
  "sqlState" : "42K09",
  "messageParameters" : {
    "exprName" : "k",
    "sqlExpr" : "\"kll_sketch_agg_float(col1, CAST(NULL AS INT))\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 52,
    "fragment" : "kll_sketch_agg_float(col1, CAST(NULL AS INT))"
  } ]
}


-- !query
SELECT kll_sketch_agg_double(col1, CAST(col1 AS INT)) AS k_non_constant
FROM t_double_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.NON_FOLDABLE_INPUT",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputExpr" : "CAST(spark_catalog.default.t_double_1_5_through_7_11.col1 AS INT)",
    "inputName" : "k",
    "inputType" : "int",
    "sqlExpr" : "\"kll_sketch_agg_double(col1, CAST(col1 AS INT))\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 53,
    "fragment" : "kll_sketch_agg_double(col1, CAST(col1 AS INT))"
  } ]
}


-- !query
SELECT kll_sketch_agg_bigint(col1, '100') AS k_wrong_type
FROM t_long_1_5_through_7_11
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"100\"",
    "inputType" : "\"STRING\"",
    "paramIndex" : "second",
    "requiredType" : "\"INT\"",
    "sqlExpr" : "\"kll_sketch_agg_bigint(col1, 100)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 41,
    "fragment" : "kll_sketch_agg_bigint(col1, '100')"
  } ]
}


-- !query
SELECT kll_sketch_get_n_bigint(X'deadbeef') AS invalid_binary_bigint
-- !query analysis
Project [kll_sketch_get_n_bigint(0xDEADBEEF) AS invalid_binary_bigint#xL]
+- OneRowRelation


-- !query
SELECT kll_sketch_get_n_float(X'cafebabe') AS invalid_binary_float
-- !query analysis
Project [kll_sketch_get_n_float(0xCAFEBABE) AS invalid_binary_float#xL]
+- OneRowRelation


-- !query
SELECT kll_sketch_get_n_double(X'12345678') AS invalid_binary_double
-- !query analysis
Project [kll_sketch_get_n_double(0x12345678) AS invalid_binary_double#xL]
+- OneRowRelation


-- !query
SELECT kll_sketch_get_n_bigint(42) AS wrong_argument_type
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"42\"",
    "inputType" : "\"INT\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"kll_sketch_get_n_bigint(42)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 34,
    "fragment" : "kll_sketch_get_n_bigint(42)"
  } ]
}


-- !query
SELECT kll_sketch_get_n_float(42.0) AS wrong_argument_type
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"42.0\"",
    "inputType" : "\"DECIMAL(3,1)\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"kll_sketch_get_n_float(42.0)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 35,
    "fragment" : "kll_sketch_get_n_float(42.0)"
  } ]
}


-- !query
SELECT kll_sketch_get_n_double(42.0D) AS wrong_argument_type
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"42.0\"",
    "inputType" : "\"DOUBLE\"",
    "paramIndex" : "first",
    "requiredType" : "\"BINARY\"",
    "sqlExpr" : "\"kll_sketch_get_n_double(42.0)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 37,
    "fragment" : "kll_sketch_get_n_double(42.0D)"
  } ]
}


-- !query
SELECT kll_sketch_get_quantile_bigint(agg, 'invalid') AS quantile_string
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query analysis
Project [kll_sketch_get_quantile_bigint(agg#x, cast(invalid as double)) AS quantile_string#xL]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
         +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT kll_sketch_get_quantile_float(agg, X'deadbeef') AS quantile_binary
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"X'DEADBEEF'\"",
    "inputType" : "\"BINARY\"",
    "paramIndex" : "second",
    "requiredType" : "(\"DOUBLE\" or \"ARRAY<DOUBLE>\")",
    "sqlExpr" : "\"kll_sketch_get_quantile_float(agg, X'DEADBEEF')\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 54,
    "fragment" : "kll_sketch_get_quantile_float(agg, X'deadbeef')"
  } ]
}


-- !query
SELECT kll_sketch_get_quantile_double(agg, true) AS quantile_boolean
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"true\"",
    "inputType" : "\"BOOLEAN\"",
    "paramIndex" : "second",
    "requiredType" : "(\"DOUBLE\" or \"ARRAY<DOUBLE>\")",
    "sqlExpr" : "\"kll_sketch_get_quantile_double(agg, true)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 48,
    "fragment" : "kll_sketch_get_quantile_double(agg, true)"
  } ]
}


-- !query
SELECT kll_sketch_get_rank_bigint(agg, 'invalid') AS rank_string
FROM (
    SELECT kll_sketch_agg_bigint(col1) AS agg
    FROM t_long_1_5_through_7_11
)
-- !query analysis
Project [kll_sketch_get_rank_bigint(agg#x, cast(invalid as bigint)) AS rank_string#x]
+- SubqueryAlias __auto_generated_subquery_name
   +- Aggregate [kll_sketch_agg_bigint(col1#xL, None, 0, 0) AS agg#x]
      +- SubqueryAlias spark_catalog.default.t_long_1_5_through_7_11
         +- Relation spark_catalog.default.t_long_1_5_through_7_11[col1#xL,col2#xL] parquet


-- !query
SELECT kll_sketch_get_rank_float(agg, X'cafebabe') AS rank_binary
FROM (
    SELECT kll_sketch_agg_float(col1) AS agg
    FROM t_float_1_5_through_7_11
)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"X'CAFEBABE'\"",
    "inputType" : "\"BINARY\"",
    "paramIndex" : "second",
    "requiredType" : "(\"FLOAT\" or \"ARRAY<FLOAT>\")",
    "sqlExpr" : "\"kll_sketch_get_rank_float(agg, X'CAFEBABE')\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 50,
    "fragment" : "kll_sketch_get_rank_float(agg, X'cafebabe')"
  } ]
}


-- !query
SELECT kll_sketch_get_rank_double(agg, false) AS rank_boolean
FROM (
    SELECT kll_sketch_agg_double(col1) AS agg
    FROM t_double_1_5_through_7_11
)
-- !query analysis
org.apache.spark.sql.catalyst.ExtendedAnalysisException
{
  "errorClass" : "DATATYPE_MISMATCH.UNEXPECTED_INPUT_TYPE",
  "sqlState" : "42K09",
  "messageParameters" : {
    "inputSql" : "\"false\"",
    "inputType" : "\"BOOLEAN\"",
    "paramIndex" : "second",
    "requiredType" : "(\"DOUBLE\" or \"ARRAY<DOUBLE>\")",
    "sqlExpr" : "\"kll_sketch_get_rank_double(agg, false)\""
  },
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 8,
    "stopIndex" : 45,
    "fragment" : "kll_sketch_get_rank_double(agg, false)"
  } ]
}


-- !query
DROP TABLE IF EXISTS t_int_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_int_1_5_through_7_11


-- !query
DROP TABLE IF EXISTS t_long_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_long_1_5_through_7_11


-- !query
DROP TABLE IF EXISTS t_short_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_short_1_5_through_7_11


-- !query
DROP TABLE IF EXISTS t_byte_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_byte_1_5_through_7_11


-- !query
DROP TABLE IF EXISTS t_float_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_float_1_5_through_7_11


-- !query
DROP TABLE IF EXISTS t_double_1_5_through_7_11
-- !query analysis
DropTable true, false
+- ResolvedIdentifier V2SessionCatalog(spark_catalog), default.t_double_1_5_through_7_11
