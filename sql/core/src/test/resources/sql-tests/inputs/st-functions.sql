-- Create the table of WKB values and insert test values.
DROP TABLE IF EXISTS geodata;
CREATE TABLE geodata(wkb BINARY) USING parquet;
-- See: https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry#Well-known_binary
-- to understand the formatting/layout of the input Well-Known Binary (WKB) values.
INSERT INTO geodata VALUES
(NULL),
(X'0101000000000000000000F03F0000000000000040');

--- Casting geospatial data types

-- GEOGRAPHY data type cannot be cast to/from other data types.
SELECT CAST(ST_GeogFromWKB(X'0101000000000000000000f03f0000000000000040') AS BOOLEAN) AS result;
SELECT CAST(ST_GeogFromWKB(X'0101000000000000000000f03f0000000000000040') AS BINARY) AS result;
SELECT CAST(ST_GeogFromWKB(X'0101000000000000000000f03f0000000000000040') AS STRING) AS result;
SELECT CAST(ST_GeogFromWKB(X'0101000000000000000000f03f0000000000000040') AS STRING COLLATE UTF8_LCASE) AS result;
-- GEOMETRY data type cannot be cast to/from other data types.
SELECT CAST(ST_GeomFromWKB(X'0101000000000000000000f03f0000000000000040') AS BOOLEAN) AS result;
SELECT CAST(ST_GeomFromWKB(X'0101000000000000000000f03f0000000000000040') AS BINARY) AS result;
SELECT CAST(ST_GeomFromWKB(X'0101000000000000000000f03f0000000000000040') AS STRING) AS result;
SELECT CAST(ST_GeomFromWKB(X'0101000000000000000000f03f0000000000000040') AS STRING COLLATE UTF8_LCASE) AS result;
-- Other data types cannot be cast to GEOGRAPHY.
SELECT CAST(TRUE AS GEOGRAPHY) AS result;
SELECT CAST(X'0101000000000000000000f03f0000000000000040' AS GEOGRAPHY) AS result;
SELECT CAST('POINT(1 2)' AS GEOGRAPHY) AS result;
SELECT CAST('POINT(1 2)' COLLATE UNICODE_CI AS GEOGRAPHY) AS result;
-- Other data types cannot be cast to GEOMETRY.
SELECT CAST(TRUE AS GEOMETRY) AS result;
SELECT CAST(X'0101000000000000000000f03f0000000000000040' AS GEOMETRY) AS result;
SELECT CAST('POINT(1 2)' AS GEOMETRY) AS result;
SELECT CAST('POINT(1 2)' COLLATE UNICODE_CI AS GEOMETRY) AS result;

---- ST reader/writer expressions

-- WKB (Well-Known Binary) round-trip tests for GEOGRAPHY and GEOMETRY types.
SELECT hex(ST_AsBinary(ST_GeogFromWKB(X'0101000000000000000000f03f0000000000000040'))) AS result;
SELECT hex(ST_AsBinary(ST_GeomFromWKB(X'0101000000000000000000f03f0000000000000040'))) AS result;

------ ST accessor expressions

---- ST_Srid

-- 1. Driver-level queries.
SELECT ST_Srid(NULL);
SELECT ST_Srid(ST_GeogFromWKB(X'0101000000000000000000F03F0000000000000040'));
SELECT ST_Srid(ST_GeomFromWKB(X'0101000000000000000000F03F0000000000000040'));

-- 2. Table-level queries.
SELECT COUNT(*) FROM geodata WHERE ST_Srid(ST_GeogFromWKB(wkb)) <> 4326;
SELECT COUNT(*) FROM geodata WHERE ST_Srid(ST_GeomFromWKB(wkb)) <> 0;

-- Drop the test table.
DROP TABLE geodata;
