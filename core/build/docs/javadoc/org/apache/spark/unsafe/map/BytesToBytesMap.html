<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>BytesToBytesMap (core 4.1.0-SNAPSHOT API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: org.apache.spark.unsafe.map, class: BytesToBytesMap">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.apache.spark.unsafe.map</a></div>
<h1 title="Class BytesToBytesMap" class="title">Class BytesToBytesMap</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance"><a href="../../memory/MemoryConsumer.html" title="class in org.apache.spark.memory">org.apache.spark.memory.MemoryConsumer</a>
<div class="inheritance">org.apache.spark.unsafe.map.BytesToBytesMap</div>
</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public final class </span><span class="element-name type-name-label">BytesToBytesMap</span>
<span class="extends-implements">extends <a href="../../memory/MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a></span></div>
<div class="block">An append-only hash map where keys and values are contiguous regions of bytes.

 This is backed by a power-of-2-sized hash table, using quadratic probing with triangular numbers,
 which is guaranteed to exhaust the space.

 The map can support up to 2^29 keys. If the key cardinality is higher than this, you should
 probably be using sorting instead of hashing for better cache locality.

 The key and values under the hood are stored together, in the following format:
   First uaoSize bytes: len(k) (key length in bytes) + len(v) (value length in bytes) + uaoSize
   Next uaoSize bytes: len(k)
   Next len(k) bytes: key data
   Next len(v) bytes: value data
   Last 8 bytes: pointer to next pair

 It means first uaoSize bytes store the entire record (key + value + uaoSize) length. This format
 is compatible with <a href="../../util/collection/unsafe/sort/UnsafeExternalSorter.html" title="class in org.apache.spark.util.collection.unsafe.sort"><code>UnsafeExternalSorter</code></a>,
 so we can pass records from this map directly into the sorter to sort records in place.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>final class&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="BytesToBytesMap.Location.html" class="type-name-link" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.Location</a></code></div>
<div class="col-last even-row-color">
<div class="block">Handle returned by <a href="#lookup(java.lang.Object,long,int)"><code>lookup(Object, long, int)</code></a> function.</div>
</div>
<div class="col-first odd-row-color"><code>final class&nbsp;</code></div>
<div class="col-second odd-row-color"><code><a href="BytesToBytesMap.MapIterator.html" class="type-name-link" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.MapIterator</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>final class&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="BytesToBytesMap.MapIteratorWithKeyIndex.html" class="type-name-link" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.MapIteratorWithKeyIndex</a></code></div>
<div class="col-last even-row-color">
<div class="block">Iterator for the entries of this map.</div>
</div>
</div>
</section>
</li>
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static final int</code></div>
<div class="col-second even-row-color"><code><a href="#MAX_CAPACITY" class="member-name-link">MAX_CAPACITY</a></code></div>
<div class="col-last even-row-color">
<div class="block">The maximum number of keys that BytesToBytesMap supports.</div>
</div>
</div>
<div class="inherited-list">
<h3 id="fields-inherited-from-class-org.apache.spark.memory.MemoryConsumer">Fields inherited from class&nbsp;org.apache.spark.memory.<a href="../../memory/MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a></h3>
<code><a href="../../memory/MemoryConsumer.html#used">used</a></code></div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(org.apache.spark.memory.TaskMemoryManager,int,long)" class="member-name-link">BytesToBytesMap</a><wbr>(<a href="../../memory/TaskMemoryManager.html" title="class in org.apache.spark.memory">TaskMemoryManager</a>&nbsp;taskMemoryManager,
 int&nbsp;initialCapacity,
 long&nbsp;pageSizeBytes)</code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-constructor-name odd-row-color"><code><a href="#%3Cinit%3E(org.apache.spark.memory.TaskMemoryManager,org.apache.spark.storage.BlockManager,org.apache.spark.serializer.SerializerManager,int,double,long)" class="member-name-link">BytesToBytesMap</a><wbr>(<a href="../../memory/TaskMemoryManager.html" title="class in org.apache.spark.memory">TaskMemoryManager</a>&nbsp;taskMemoryManager,
 org.apache.spark.storage.BlockManager&nbsp;blockManager,
 org.apache.spark.serializer.SerializerManager&nbsp;serializerManager,
 int&nbsp;initialCapacity,
 double&nbsp;loadFactor,
 long&nbsp;pageSizeBytes)</code></div>
<div class="col-last odd-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="BytesToBytesMap.MapIterator.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.MapIterator</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#destructiveIterator()" class="member-name-link">destructiveIterator</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns a destructive iterator for iterating over the entries of this map.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#free()" class="member-name-link">free</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Free all allocated memory associated with this map, including the storage for keys and values
 as well as the hash map array itself.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>org.apache.spark.unsafe.array.LongArray</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getArray()" class="member-name-link">getArray</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns the underline long[] of longArray.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>double</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getAvgHashProbesPerKey()" class="member-name-link">getAvgHashProbesPerKey</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns the average number of probes per key lookup.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>int</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getNumDataPages()" class="member-name-link">getNumDataPages</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getPageSizeBytes()" class="member-name-link">getPageSizeBytes</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getPeakMemoryUsedBytes()" class="member-name-link">getPeakMemoryUsedBytes</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Return the peak memory used so far, in bytes.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../../memory/TaskMemoryManager.html" title="class in org.apache.spark.memory">TaskMemoryManager</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getTaskMemoryManager()" class="member-name-link">getTaskMemoryManager</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getTotalMemoryConsumption()" class="member-name-link">getTotalMemoryConsumption</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns the total amount of memory, in bytes, consumed by this map's managed structures.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="BytesToBytesMap.MapIterator.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.MapIterator</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#iterator()" class="member-name-link">iterator</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns an iterator for iterating over the entries of this map.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="BytesToBytesMap.MapIteratorWithKeyIndex.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.MapIteratorWithKeyIndex</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#iteratorWithKeyIndex()" class="member-name-link">iteratorWithKeyIndex</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns an iterator for iterating over the entries of this map,
 by first iterating over the key index inside hash map's `longArray`.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.Location</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#lookup(java.lang.Object,long,int)" class="member-name-link">lookup</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;keyBase,
 long&nbsp;keyOffset,
 int&nbsp;keyLength)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Looks up a key, and return a <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> handle that can be used to test existence
 and read/write values.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.Location</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#lookup(java.lang.Object,long,int,int)" class="member-name-link">lookup</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;keyBase,
 long&nbsp;keyOffset,
 int&nbsp;keyLength,
 int&nbsp;hash)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Looks up a key, and return a <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> handle that can be used to test existence
 and read/write values.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>int</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#maxNumKeysIndex()" class="member-name-link">maxNumKeysIndex</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">The maximum number of allowed keys index.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>int</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#numKeys()" class="member-name-link">numKeys</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns the number of keys defined in the map.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>int</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#numValues()" class="member-name-link">numValues</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns the number of values defined in the map.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#reset()" class="member-name-link">reset</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Reset this map to initialized state.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#safeLookup(java.lang.Object,long,int,org.apache.spark.unsafe.map.BytesToBytesMap.Location,int)" class="member-name-link">safeLookup</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;keyBase,
 long&nbsp;keyOffset,
 int&nbsp;keyLength,
 <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.Location</a>&nbsp;loc,
 int&nbsp;hash)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Looks up a key, and saves the result in provided `loc`.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#spill(long,org.apache.spark.memory.MemoryConsumer)" class="member-name-link">spill</a><wbr>(long&nbsp;size,
 <a href="../../memory/MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;trigger)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Spill some data to disk to release memory, which will be called by TaskMemoryManager
 when there is not enough memory for the task.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-org.apache.spark.memory.MemoryConsumer">Methods inherited from class&nbsp;org.apache.spark.memory.<a href="../../memory/MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a></h3>
<code><a href="../../memory/MemoryConsumer.html#acquireMemory(long)">acquireMemory</a>, <a href="../../memory/MemoryConsumer.html#allocateArray(long)">allocateArray</a>, <a href="../../memory/MemoryConsumer.html#allocatePage(long)">allocatePage</a>, <a href="../../memory/MemoryConsumer.html#freeArray(org.apache.spark.unsafe.array.LongArray)">freeArray</a>, <a href="../../memory/MemoryConsumer.html#freeMemory(long)">freeMemory</a>, <a href="../../memory/MemoryConsumer.html#freePage(org.apache.spark.unsafe.memory.MemoryBlock)">freePage</a>, <a href="../../memory/MemoryConsumer.html#getMode()">getMode</a>, <a href="../../memory/MemoryConsumer.html#getUsed()">getUsed</a>, <a href="../../memory/MemoryConsumer.html#spill()">spill</a></code></div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="MAX_CAPACITY">
<h3>MAX_CAPACITY</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">MAX_CAPACITY</span></div>
<div class="block">The maximum number of keys that BytesToBytesMap supports. The hash table has to be
 power-of-2-sized and its backing Java array can contain at most (1 &lt;&lt; 30) elements,
 since that's the largest power-of-2 that's less than Integer.MAX_VALUE. We need two long array
 entries per key, giving us a maximum capacity of (1 &lt;&lt; 29).</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../../../../../constant-values.html#org.apache.spark.unsafe.map.BytesToBytesMap.MAX_CAPACITY">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(org.apache.spark.memory.TaskMemoryManager,org.apache.spark.storage.BlockManager,org.apache.spark.serializer.SerializerManager,int,double,long)">
<h3>BytesToBytesMap</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">BytesToBytesMap</span><wbr><span class="parameters">(<a href="../../memory/TaskMemoryManager.html" title="class in org.apache.spark.memory">TaskMemoryManager</a>&nbsp;taskMemoryManager,
 org.apache.spark.storage.BlockManager&nbsp;blockManager,
 org.apache.spark.serializer.SerializerManager&nbsp;serializerManager,
 int&nbsp;initialCapacity,
 double&nbsp;loadFactor,
 long&nbsp;pageSizeBytes)</span></div>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;(org.apache.spark.memory.TaskMemoryManager,int,long)">
<h3>BytesToBytesMap</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">BytesToBytesMap</span><wbr><span class="parameters">(<a href="../../memory/TaskMemoryManager.html" title="class in org.apache.spark.memory">TaskMemoryManager</a>&nbsp;taskMemoryManager,
 int&nbsp;initialCapacity,
 long&nbsp;pageSizeBytes)</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="numKeys()">
<h3>numKeys</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">numKeys</span>()</div>
<div class="block">Returns the number of keys defined in the map.</div>
</section>
</li>
<li>
<section class="detail" id="numValues()">
<h3>numValues</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">numValues</span>()</div>
<div class="block">Returns the number of values defined in the map. A key could have multiple values.</div>
</section>
</li>
<li>
<section class="detail" id="iterator()">
<h3>iterator</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="BytesToBytesMap.MapIterator.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.MapIterator</a></span>&nbsp;<span class="element-name">iterator</span>()</div>
<div class="block">Returns an iterator for iterating over the entries of this map.

 For efficiency, all calls to `next()` will return the same <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> object.

 The returned iterator is thread-safe. However if the map is modified while iterating over it,
 the behavior of the returned iterator is undefined.</div>
</section>
</li>
<li>
<section class="detail" id="destructiveIterator()">
<h3>destructiveIterator</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="BytesToBytesMap.MapIterator.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.MapIterator</a></span>&nbsp;<span class="element-name">destructiveIterator</span>()</div>
<div class="block">Returns a destructive iterator for iterating over the entries of this map. It frees each page
 as it moves onto next one. Notice: it is illegal to call any method on the map after
 `destructiveIterator()` has been called.

 For efficiency, all calls to `next()` will return the same <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> object.

 The returned iterator is thread-safe. However if the map is modified while iterating over it,
 the behavior of the returned iterator is undefined.</div>
</section>
</li>
<li>
<section class="detail" id="iteratorWithKeyIndex()">
<h3>iteratorWithKeyIndex</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="BytesToBytesMap.MapIteratorWithKeyIndex.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.MapIteratorWithKeyIndex</a></span>&nbsp;<span class="element-name">iteratorWithKeyIndex</span>()</div>
<div class="block">Returns an iterator for iterating over the entries of this map,
 by first iterating over the key index inside hash map's `longArray`.

 For efficiency, all calls to `next()` will return the same <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> object.

 The returned iterator is NOT thread-safe. If the map is modified while iterating over it,
 the behavior of the returned iterator is undefined.</div>
</section>
</li>
<li>
<section class="detail" id="maxNumKeysIndex()">
<h3>maxNumKeysIndex</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">maxNumKeysIndex</span>()</div>
<div class="block">The maximum number of allowed keys index.

 The value of allowed keys index is in the range of [0, maxNumKeysIndex - 1].</div>
</section>
</li>
<li>
<section class="detail" id="lookup(java.lang.Object,long,int)">
<h3>lookup</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.Location</a></span>&nbsp;<span class="element-name">lookup</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;keyBase,
 long&nbsp;keyOffset,
 int&nbsp;keyLength)</span></div>
<div class="block">Looks up a key, and return a <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> handle that can be used to test existence
 and read/write values.

 This function always returns the same <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> instance to avoid object allocation.
 This function is not thread-safe.</div>
</section>
</li>
<li>
<section class="detail" id="lookup(java.lang.Object,long,int,int)">
<h3>lookup</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.Location</a></span>&nbsp;<span class="element-name">lookup</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;keyBase,
 long&nbsp;keyOffset,
 int&nbsp;keyLength,
 int&nbsp;hash)</span></div>
<div class="block">Looks up a key, and return a <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> handle that can be used to test existence
 and read/write values.

 This function always returns the same <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map"><code>BytesToBytesMap.Location</code></a> instance to avoid object allocation.
 This function is not thread-safe.</div>
</section>
</li>
<li>
<section class="detail" id="safeLookup(java.lang.Object,long,int,org.apache.spark.unsafe.map.BytesToBytesMap.Location,int)">
<h3>safeLookup</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">safeLookup</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;keyBase,
 long&nbsp;keyOffset,
 int&nbsp;keyLength,
 <a href="BytesToBytesMap.Location.html" title="class in org.apache.spark.unsafe.map">BytesToBytesMap.Location</a>&nbsp;loc,
 int&nbsp;hash)</span></div>
<div class="block">Looks up a key, and saves the result in provided `loc`.

 This is a thread-safe version of `lookup`, could be used by multiple threads.</div>
</section>
</li>
<li>
<section class="detail" id="spill(long,org.apache.spark.memory.MemoryConsumer)">
<h3>spill</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">spill</span><wbr><span class="parameters">(long&nbsp;size,
 <a href="../../memory/MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;trigger)</span>
           throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="../../memory/MemoryConsumer.html#spill(long,org.apache.spark.memory.MemoryConsumer)">MemoryConsumer</a></code></span></div>
<div class="block">Spill some data to disk to release memory, which will be called by TaskMemoryManager
 when there is not enough memory for the task.

 This should be implemented by subclass.

 Note: In order to avoid possible deadlock, should not call acquireMemory() from spill().

 Note: today, this only frees Tungsten-managed pages.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="../../memory/MemoryConsumer.html#spill(long,org.apache.spark.memory.MemoryConsumer)">spill</a></code>&nbsp;in class&nbsp;<code><a href="../../memory/MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a></code></dd>
<dt>Parameters:</dt>
<dd><code>size</code> - the amount of memory should be released</dd>
<dd><code>trigger</code> - the MemoryConsumer that trigger this spilling</dd>
<dt>Returns:</dt>
<dd>the amount of released memory in bytes</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="free()">
<h3>free</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">free</span>()</div>
<div class="block">Free all allocated memory associated with this map, including the storage for keys and values
 as well as the hash map array itself.

 This method is idempotent and can be called multiple times.</div>
</section>
</li>
<li>
<section class="detail" id="getTaskMemoryManager()">
<h3>getTaskMemoryManager</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../../memory/TaskMemoryManager.html" title="class in org.apache.spark.memory">TaskMemoryManager</a></span>&nbsp;<span class="element-name">getTaskMemoryManager</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getPageSizeBytes()">
<h3>getPageSizeBytes</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getPageSizeBytes</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getTotalMemoryConsumption()">
<h3>getTotalMemoryConsumption</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getTotalMemoryConsumption</span>()</div>
<div class="block">Returns the total amount of memory, in bytes, consumed by this map's managed structures.</div>
</section>
</li>
<li>
<section class="detail" id="getPeakMemoryUsedBytes()">
<h3>getPeakMemoryUsedBytes</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getPeakMemoryUsedBytes</span>()</div>
<div class="block">Return the peak memory used so far, in bytes.</div>
</section>
</li>
<li>
<section class="detail" id="getAvgHashProbesPerKey()">
<h3>getAvgHashProbesPerKey</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">double</span>&nbsp;<span class="element-name">getAvgHashProbesPerKey</span>()</div>
<div class="block">Returns the average number of probes per key lookup.</div>
</section>
</li>
<li>
<section class="detail" id="getNumDataPages()">
<h3>getNumDataPages</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">getNumDataPages</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getArray()">
<h3>getArray</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">org.apache.spark.unsafe.array.LongArray</span>&nbsp;<span class="element-name">getArray</span>()</div>
<div class="block">Returns the underline long[] of longArray.</div>
</section>
</li>
<li>
<section class="detail" id="reset()">
<h3>reset</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">reset</span>()</div>
<div class="block">Reset this map to initialized state.</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
