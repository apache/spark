<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>TaskMemoryManager (core 4.1.0-SNAPSHOT API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: org.apache.spark.memory, class: TaskMemoryManager">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.apache.spark.memory</a></div>
<h1 title="Class TaskMemoryManager" class="title">Class TaskMemoryManager</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">org.apache.spark.memory.TaskMemoryManager</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">TaskMemoryManager</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">Manages the memory allocated by an individual task.
 <p>
 Most of the complexity in this class deals with encoding of off-heap addresses into 64-bit longs.
 In off-heap mode, memory can be directly addressed with 64-bit longs. In on-heap mode, memory is
 addressed by the combination of a base Object reference and a 64-bit offset within that object.
 This is a problem when we want to store pointers to data structures inside of other structures,
 such as record pointers inside hashmaps or sorting buffers. Even if we decided to use 128 bits
 to address memory, we can't just store the address of the base object since it's not guaranteed
 to remain stable as the heap gets reorganized due to GC.
 <p>
 Instead, we use the following approach to encode record pointers in 64-bit longs: for off-heap
 mode, just store the raw address, and for on-heap mode use the upper 13 bits of the address to
 store a "page number" and the lower 51 bits to store an offset within this page. These page
 numbers are used to index into a "page table" array inside of the MemoryManager in order to
 retrieve the base object.
 <p>
 This allows us to address 8192 pages. In on-heap mode, the maximum page size is limited by the
 maximum size of a long[] array, allowing us to address 8192 * (2^31 - 1) * 8 bytes, which is
 approximately 140 terabytes of memory.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static final long</code></div>
<div class="col-second even-row-color"><code><a href="#MAXIMUM_PAGE_SIZE_BYTES" class="member-name-link">MAXIMUM_PAGE_SIZE_BYTES</a></code></div>
<div class="col-last even-row-color">
<div class="block">Maximum supported data page size (in bytes).</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(org.apache.spark.memory.MemoryManager,long)" class="member-name-link">TaskMemoryManager</a><wbr>(org.apache.spark.memory.MemoryManager&nbsp;memoryManager,
 long&nbsp;taskAttemptId)</code></div>
<div class="col-last even-row-color">
<div class="block">Construct a new TaskMemoryManager.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#acquireExecutionMemory(long,org.apache.spark.memory.MemoryConsumer)" class="member-name-link">acquireExecutionMemory</a><wbr>(long&nbsp;required,
 <a href="MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;requestingConsumer)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Acquire N bytes of memory for a consumer.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>org.apache.spark.unsafe.memory.MemoryBlock</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#allocatePage(long,org.apache.spark.memory.MemoryConsumer)" class="member-name-link">allocatePage</a><wbr>(long&nbsp;size,
 <a href="MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;consumer)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Allocate a block of memory that will be tracked in the MemoryManager's page table; this is
 intended for allocating large blocks of Tungsten memory that will be shared between operators.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#cleanUpAllAllocatedMemory()" class="member-name-link">cleanUpAllAllocatedMemory</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Clean up all allocated memory and pages.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static int</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#decodePageNumber(long)" class="member-name-link">decodePageNumber</a><wbr>(long&nbsp;pagePlusOffsetAddress)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#encodePageNumberAndOffset(int,long)" class="member-name-link">encodePageNumberAndOffset</a><wbr>(int&nbsp;pageNumber,
 long&nbsp;offsetInPage)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#encodePageNumberAndOffset(org.apache.spark.unsafe.memory.MemoryBlock,long)" class="member-name-link">encodePageNumberAndOffset</a><wbr>(org.apache.spark.unsafe.memory.MemoryBlock&nbsp;page,
 long&nbsp;offsetInPage)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Given a memory page and offset within that page, encode this address into a 64-bit long.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#freePage(org.apache.spark.unsafe.memory.MemoryBlock,org.apache.spark.memory.MemoryConsumer)" class="member-name-link">freePage</a><wbr>(org.apache.spark.unsafe.memory.MemoryBlock&nbsp;page,
 <a href="MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;consumer)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Free a block of memory allocated via <a href="#allocatePage(long,org.apache.spark.memory.MemoryConsumer)"><code>allocatePage(long, org.apache.spark.memory.MemoryConsumer)</code></a>.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getMemoryConsumptionForThisTask()" class="member-name-link">getMemoryConsumptionForThisTask</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns the memory consumption, in bytes, for the current task.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getOffsetInPage(long)" class="member-name-link">getOffsetInPage</a><wbr>(long&nbsp;pagePlusOffsetAddress)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the offset associated with an address encoded by
 <a href="#encodePageNumberAndOffset(org.apache.spark.unsafe.memory.MemoryBlock,long)"><code>encodePageNumberAndOffset(MemoryBlock, long)</code></a></div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getPage(long)" class="member-name-link">getPage</a><wbr>(long&nbsp;pagePlusOffsetAddress)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the page associated with an address encoded by
 <a href="#encodePageNumberAndOffset(org.apache.spark.unsafe.memory.MemoryBlock,long)"><code>encodePageNumberAndOffset(MemoryBlock, long)</code></a></div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getPeakOffHeapExecutionMemory()" class="member-name-link">getPeakOffHeapExecutionMemory</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns peak task-level on-heap memory usage in bytes.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getPeakOnHeapExecutionMemory()" class="member-name-link">getPeakOnHeapExecutionMemory</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns peak task-level off-heap memory usage in bytes.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>org.apache.spark.memory.MemoryMode</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getTungstenMemoryMode()" class="member-name-link">getTungstenMemoryMode</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns Tungsten memory mode</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#pageSizeBytes()" class="member-name-link">pageSizeBytes</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Return the page size in bytes.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#releaseExecutionMemory(long,org.apache.spark.memory.MemoryConsumer)" class="member-name-link">releaseExecutionMemory</a><wbr>(long&nbsp;size,
 <a href="MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;consumer)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Release N bytes of execution memory for a MemoryConsumer.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#showMemoryUsage()" class="member-name-link">showMemoryUsage</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Dump the memory usage of all consumers.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="MAXIMUM_PAGE_SIZE_BYTES">
<h3>MAXIMUM_PAGE_SIZE_BYTES</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">MAXIMUM_PAGE_SIZE_BYTES</span></div>
<div class="block">Maximum supported data page size (in bytes). In principle, the maximum addressable page size is
 (1L &lt;&lt; OFFSET_BITS) bytes, which is 2+ petabytes. However, the on-heap allocator's
 maximum page size is limited by the maximum amount of data that can be stored in a long[]
 array, which is (2^31 - 1) * 8 bytes (or about 17 gigabytes). Therefore, we cap this at 17
 gigabytes.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../../../../constant-values.html#org.apache.spark.memory.TaskMemoryManager.MAXIMUM_PAGE_SIZE_BYTES">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(org.apache.spark.memory.MemoryManager,long)">
<h3>TaskMemoryManager</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">TaskMemoryManager</span><wbr><span class="parameters">(org.apache.spark.memory.MemoryManager&nbsp;memoryManager,
 long&nbsp;taskAttemptId)</span></div>
<div class="block">Construct a new TaskMemoryManager.</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="acquireExecutionMemory(long,org.apache.spark.memory.MemoryConsumer)">
<h3>acquireExecutionMemory</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">acquireExecutionMemory</span><wbr><span class="parameters">(long&nbsp;required,
 <a href="MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;requestingConsumer)</span></div>
<div class="block">Acquire N bytes of memory for a consumer. If there is no enough memory, it will call
 spill() of consumers to release more memory.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>number of bytes successfully granted (&lt;= N).</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="releaseExecutionMemory(long,org.apache.spark.memory.MemoryConsumer)">
<h3>releaseExecutionMemory</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">releaseExecutionMemory</span><wbr><span class="parameters">(long&nbsp;size,
 <a href="MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;consumer)</span></div>
<div class="block">Release N bytes of execution memory for a MemoryConsumer.</div>
</section>
</li>
<li>
<section class="detail" id="showMemoryUsage()">
<h3>showMemoryUsage</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">showMemoryUsage</span>()</div>
<div class="block">Dump the memory usage of all consumers.</div>
</section>
</li>
<li>
<section class="detail" id="pageSizeBytes()">
<h3>pageSizeBytes</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">pageSizeBytes</span>()</div>
<div class="block">Return the page size in bytes.</div>
</section>
</li>
<li>
<section class="detail" id="allocatePage(long,org.apache.spark.memory.MemoryConsumer)">
<h3>allocatePage</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">org.apache.spark.unsafe.memory.MemoryBlock</span>&nbsp;<span class="element-name">allocatePage</span><wbr><span class="parameters">(long&nbsp;size,
 <a href="MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;consumer)</span></div>
<div class="block">Allocate a block of memory that will be tracked in the MemoryManager's page table; this is
 intended for allocating large blocks of Tungsten memory that will be shared between operators.

 Returns `null` if there was not enough memory to allocate the page. May return a page that
 contains fewer bytes than requested, so callers should verify the size of returned pages.</div>
<dl class="notes">
<dt>Throws:</dt>
<dd><code><a href="TooLargePageException.html" title="class in org.apache.spark.memory">TooLargePageException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="freePage(org.apache.spark.unsafe.memory.MemoryBlock,org.apache.spark.memory.MemoryConsumer)">
<h3>freePage</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">freePage</span><wbr><span class="parameters">(org.apache.spark.unsafe.memory.MemoryBlock&nbsp;page,
 <a href="MemoryConsumer.html" title="class in org.apache.spark.memory">MemoryConsumer</a>&nbsp;consumer)</span></div>
<div class="block">Free a block of memory allocated via <a href="#allocatePage(long,org.apache.spark.memory.MemoryConsumer)"><code>allocatePage(long, org.apache.spark.memory.MemoryConsumer)</code></a>.</div>
</section>
</li>
<li>
<section class="detail" id="encodePageNumberAndOffset(org.apache.spark.unsafe.memory.MemoryBlock,long)">
<h3>encodePageNumberAndOffset</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">encodePageNumberAndOffset</span><wbr><span class="parameters">(org.apache.spark.unsafe.memory.MemoryBlock&nbsp;page,
 long&nbsp;offsetInPage)</span></div>
<div class="block">Given a memory page and offset within that page, encode this address into a 64-bit long.
 This address will remain valid as long as the corresponding page has not been freed.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>page</code> - a data page allocated by <a href="#allocatePage(long,org.apache.spark.memory.MemoryConsumer)"><code>allocatePage(long, org.apache.spark.memory.MemoryConsumer)</code></a>/</dd>
<dd><code>offsetInPage</code> - an offset in this page which incorporates the base offset. In other words,
                     this should be the value that you would pass as the base offset into an
                     UNSAFE call (e.g. page.baseOffset() + something).</dd>
<dt>Returns:</dt>
<dd>an encoded page address.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="encodePageNumberAndOffset(int,long)">
<h3>encodePageNumberAndOffset</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">encodePageNumberAndOffset</span><wbr><span class="parameters">(int&nbsp;pageNumber,
 long&nbsp;offsetInPage)</span></div>
</section>
</li>
<li>
<section class="detail" id="decodePageNumber(long)">
<h3>decodePageNumber</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">decodePageNumber</span><wbr><span class="parameters">(long&nbsp;pagePlusOffsetAddress)</span></div>
</section>
</li>
<li>
<section class="detail" id="getPage(long)">
<h3>getPage</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span>&nbsp;<span class="element-name">getPage</span><wbr><span class="parameters">(long&nbsp;pagePlusOffsetAddress)</span></div>
<div class="block">Get the page associated with an address encoded by
 <a href="#encodePageNumberAndOffset(org.apache.spark.unsafe.memory.MemoryBlock,long)"><code>encodePageNumberAndOffset(MemoryBlock, long)</code></a></div>
</section>
</li>
<li>
<section class="detail" id="getOffsetInPage(long)">
<h3>getOffsetInPage</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getOffsetInPage</span><wbr><span class="parameters">(long&nbsp;pagePlusOffsetAddress)</span></div>
<div class="block">Get the offset associated with an address encoded by
 <a href="#encodePageNumberAndOffset(org.apache.spark.unsafe.memory.MemoryBlock,long)"><code>encodePageNumberAndOffset(MemoryBlock, long)</code></a></div>
</section>
</li>
<li>
<section class="detail" id="cleanUpAllAllocatedMemory()">
<h3>cleanUpAllAllocatedMemory</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">cleanUpAllAllocatedMemory</span>()</div>
<div class="block">Clean up all allocated memory and pages. Returns the number of bytes freed. A non-zero return
 value can be used to detect memory leaks.</div>
</section>
</li>
<li>
<section class="detail" id="getMemoryConsumptionForThisTask()">
<h3>getMemoryConsumptionForThisTask</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getMemoryConsumptionForThisTask</span>()</div>
<div class="block">Returns the memory consumption, in bytes, for the current task.</div>
</section>
</li>
<li>
<section class="detail" id="getTungstenMemoryMode()">
<h3>getTungstenMemoryMode</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">org.apache.spark.memory.MemoryMode</span>&nbsp;<span class="element-name">getTungstenMemoryMode</span>()</div>
<div class="block">Returns Tungsten memory mode</div>
</section>
</li>
<li>
<section class="detail" id="getPeakOnHeapExecutionMemory()">
<h3>getPeakOnHeapExecutionMemory</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getPeakOnHeapExecutionMemory</span>()</div>
<div class="block">Returns peak task-level off-heap memory usage in bytes.</div>
</section>
</li>
<li>
<section class="detail" id="getPeakOffHeapExecutionMemory()">
<h3>getPeakOffHeapExecutionMemory</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getPeakOffHeapExecutionMemory</span>()</div>
<div class="block">Returns peak task-level on-heap memory usage in bytes.</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
