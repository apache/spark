<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>MergedShuffleFileManager (network-shuffle 4.1.0-SNAPSHOT API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: org.apache.spark.network.shuffle, interface: MergedShuffleFileManager">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.apache.spark.network.shuffle</a></div>
<h1 title="Interface MergedShuffleFileManager" class="title">Interface MergedShuffleFileManager</h1>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="NoOpMergedShuffleFileManager.html" title="class in org.apache.spark.network.shuffle">NoOpMergedShuffleFileManager</a></code>, <code><a href="RemoteBlockPushResolver.html" title="class in org.apache.spark.network.shuffle">RemoteBlockPushResolver</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="annotations">@Evolving
</span><span class="modifiers">public interface </span><span class="element-name type-name-label">MergedShuffleFileManager</span></div>
<div class="block">The MergedShuffleFileManager is used to process push based shuffle when enabled. It works
 along side <a href="ExternalBlockHandler.html" title="class in org.apache.spark.network.shuffle"><code>ExternalBlockHandler</code></a> and serves as an RPCHandler for
 <code>RpcHandler.receiveStream(org.apache.spark.network.client.TransportClient, java.nio.ByteBuffer, org.apache.spark.network.client.RpcResponseCallback)</code>, where it processes the
 remotely pushed streams of shuffle blocks to merge them into merged shuffle files. Right
 now, support for push based shuffle is only implemented for external shuffle service in
 YARN mode.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>3.1.0</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab3" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab3', 3)" class="table-tab">Abstract Methods</button><button id="method-summary-table-tab5" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab5', 3)" class="table-tab">Default Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#applicationRemoved(java.lang.String,boolean)" class="member-name-link">applicationRemoved</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId,
 boolean&nbsp;cleanupLocalDirs)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Invoked when an application finishes.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code>default void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code><a href="#close()" class="member-name-link">close</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5">
<div class="block">Optionally close any resources associated the MergedShuffleFileManager, such as the
 leveldb for state persistence.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="protocol/MergeStatuses.html" title="class in org.apache.spark.network.shuffle.protocol">MergeStatuses</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#finalizeShuffleMerge(org.apache.spark.network.shuffle.protocol.FinalizeShuffleMerge)" class="member-name-link">finalizeShuffleMerge</a><wbr>(<a href="protocol/FinalizeShuffleMerge.html" title="class in org.apache.spark.network.shuffle.protocol">FinalizeShuffleMerge</a>&nbsp;msg)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Handles the request to finalize shuffle merge for a given shuffle.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>org.apache.spark.network.buffer.ManagedBuffer</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#getMergedBlockData(java.lang.String,int,int,int,int)" class="member-name-link">getMergedBlockData</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId,
 int&nbsp;shuffleId,
 int&nbsp;shuffleMergeId,
 int&nbsp;reduceId,
 int&nbsp;chunkId)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Get the buffer for a given merged shuffle chunk when serving merged shuffle to reducers</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>[]</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#getMergedBlockDirs(java.lang.String)" class="member-name-link">getMergedBlockDirs</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Get the local directories which stores the merged shuffle files.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="MergedBlockMeta.html" title="class in org.apache.spark.network.shuffle">MergedBlockMeta</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#getMergedBlockMeta(java.lang.String,int,int,int)" class="member-name-link">getMergedBlockMeta</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId,
 int&nbsp;shuffleId,
 int&nbsp;shuffleMergeId,
 int&nbsp;reduceId)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Get the meta information of a merged block.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code>default com.codahale.metrics.MetricSet</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code><a href="#getMetrics()" class="member-name-link">getMetrics</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5">
<div class="block">Get the metrics associated with the MergedShuffleFileManager.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>org.apache.spark.network.client.StreamCallbackWithID</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#receiveBlockDataAsStream(org.apache.spark.network.shuffle.protocol.PushBlockStream)" class="member-name-link">receiveBlockDataAsStream</a><wbr>(<a href="protocol/PushBlockStream.html" title="class in org.apache.spark.network.shuffle.protocol">PushBlockStream</a>&nbsp;msg)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Provides the stream callback used to process a remotely pushed block.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#registerExecutor(java.lang.String,org.apache.spark.network.shuffle.protocol.ExecutorShuffleInfo)" class="member-name-link">registerExecutor</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId,
 <a href="protocol/ExecutorShuffleInfo.html" title="class in org.apache.spark.network.shuffle.protocol">ExecutorShuffleInfo</a>&nbsp;executorInfo)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Registers an executor with MergedShuffleFileManager.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#removeShuffleMerge(org.apache.spark.network.shuffle.protocol.RemoveShuffleMerge)" class="member-name-link">removeShuffleMerge</a><wbr>(<a href="protocol/RemoveShuffleMerge.html" title="class in org.apache.spark.network.shuffle.protocol">RemoveShuffleMerge</a>&nbsp;removeShuffleMerge)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Remove shuffle merge data files.</div>
</div>
</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="receiveBlockDataAsStream(org.apache.spark.network.shuffle.protocol.PushBlockStream)">
<h3>receiveBlockDataAsStream</h3>
<div class="member-signature"><span class="return-type">org.apache.spark.network.client.StreamCallbackWithID</span>&nbsp;<span class="element-name">receiveBlockDataAsStream</span><wbr><span class="parameters">(<a href="protocol/PushBlockStream.html" title="class in org.apache.spark.network.shuffle.protocol">PushBlockStream</a>&nbsp;msg)</span></div>
<div class="block">Provides the stream callback used to process a remotely pushed block. The callback is
 used by the <code>StreamInterceptor</code> installed on the
 channel to process the block data in the channel outside of the message frame.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>msg</code> - metadata of the remotely pushed blocks. This is processed inside the message frame</dd>
<dt>Returns:</dt>
<dd>A stream callback to process the block data in streaming fashion as it arrives</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="finalizeShuffleMerge(org.apache.spark.network.shuffle.protocol.FinalizeShuffleMerge)">
<h3>finalizeShuffleMerge</h3>
<div class="member-signature"><span class="return-type"><a href="protocol/MergeStatuses.html" title="class in org.apache.spark.network.shuffle.protocol">MergeStatuses</a></span>&nbsp;<span class="element-name">finalizeShuffleMerge</span><wbr><span class="parameters">(<a href="protocol/FinalizeShuffleMerge.html" title="class in org.apache.spark.network.shuffle.protocol">FinalizeShuffleMerge</a>&nbsp;msg)</span>
                            throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">Handles the request to finalize shuffle merge for a given shuffle.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>msg</code> - contains appId and shuffleId to uniquely identify a shuffle to be finalized</dd>
<dt>Returns:</dt>
<dd>The statuses of the merged shuffle partitions for the given shuffle on this
         shuffle service</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="registerExecutor(java.lang.String,org.apache.spark.network.shuffle.protocol.ExecutorShuffleInfo)">
<h3>registerExecutor</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">registerExecutor</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId,
 <a href="protocol/ExecutorShuffleInfo.html" title="class in org.apache.spark.network.shuffle.protocol">ExecutorShuffleInfo</a>&nbsp;executorInfo)</span></div>
<div class="block">Registers an executor with MergedShuffleFileManager. This executor-info provides
 the directories and number of sub-dirs per dir so that MergedShuffleFileManager knows where to
 store and look for shuffle data for a given application. It is invoked by the RPC call when
 executor tries to register with the local shuffle service.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>appId</code> - application ID</dd>
<dd><code>executorInfo</code> - The list of local dirs that this executor gets granted from NodeManager</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="applicationRemoved(java.lang.String,boolean)">
<h3>applicationRemoved</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">applicationRemoved</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId,
 boolean&nbsp;cleanupLocalDirs)</span></div>
<div class="block">Invoked when an application finishes. This cleans up any remaining metadata associated with
 this application, and optionally deletes the application specific directory path.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>appId</code> - application ID</dd>
<dd><code>cleanupLocalDirs</code> - flag indicating whether MergedShuffleFileManager should handle
                         deletion of local dirs itself.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getMergedBlockData(java.lang.String,int,int,int,int)">
<h3>getMergedBlockData</h3>
<div class="member-signature"><span class="return-type">org.apache.spark.network.buffer.ManagedBuffer</span>&nbsp;<span class="element-name">getMergedBlockData</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId,
 int&nbsp;shuffleId,
 int&nbsp;shuffleMergeId,
 int&nbsp;reduceId,
 int&nbsp;chunkId)</span></div>
<div class="block">Get the buffer for a given merged shuffle chunk when serving merged shuffle to reducers</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>appId</code> - application ID</dd>
<dd><code>shuffleId</code> - shuffle ID</dd>
<dd><code>shuffleMergeId</code> - shuffleMergeId is used to uniquely identify merging process
                       of shuffle by an indeterminate stage attempt.</dd>
<dd><code>reduceId</code> - reducer ID</dd>
<dd><code>chunkId</code> - merged shuffle file chunk ID</dd>
<dt>Returns:</dt>
<dd>The <code>ManagedBuffer</code> for the given merged shuffle chunk</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getMergedBlockMeta(java.lang.String,int,int,int)">
<h3>getMergedBlockMeta</h3>
<div class="member-signature"><span class="return-type"><a href="MergedBlockMeta.html" title="class in org.apache.spark.network.shuffle">MergedBlockMeta</a></span>&nbsp;<span class="element-name">getMergedBlockMeta</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId,
 int&nbsp;shuffleId,
 int&nbsp;shuffleMergeId,
 int&nbsp;reduceId)</span></div>
<div class="block">Get the meta information of a merged block.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>appId</code> - application ID</dd>
<dd><code>shuffleId</code> - shuffle ID</dd>
<dd><code>shuffleMergeId</code> - shuffleMergeId is used to uniquely identify merging process
                       of shuffle by an indeterminate stage attempt.</dd>
<dd><code>reduceId</code> - reducer ID</dd>
<dt>Returns:</dt>
<dd>meta information of a merged block</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getMergedBlockDirs(java.lang.String)">
<h3>getMergedBlockDirs</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>[]</span>&nbsp;<span class="element-name">getMergedBlockDirs</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;appId)</span></div>
<div class="block">Get the local directories which stores the merged shuffle files.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>appId</code> - application ID</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="removeShuffleMerge(org.apache.spark.network.shuffle.protocol.RemoveShuffleMerge)">
<h3>removeShuffleMerge</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">removeShuffleMerge</span><wbr><span class="parameters">(<a href="protocol/RemoveShuffleMerge.html" title="class in org.apache.spark.network.shuffle.protocol">RemoveShuffleMerge</a>&nbsp;removeShuffleMerge)</span></div>
<div class="block">Remove shuffle merge data files.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>removeShuffleMerge</code> - contains shuffle details (appId, shuffleId, etc) to uniquely
 identify a shuffle to be removed</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="close()">
<h3>close</h3>
<div class="member-signature"><span class="modifiers">default</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">close</span>()</div>
<div class="block">Optionally close any resources associated the MergedShuffleFileManager, such as the
 leveldb for state persistence.</div>
</section>
</li>
<li>
<section class="detail" id="getMetrics()">
<h3>getMetrics</h3>
<div class="member-signature"><span class="modifiers">default</span>&nbsp;<span class="return-type">com.codahale.metrics.MetricSet</span>&nbsp;<span class="element-name">getMetrics</span>()</div>
<div class="block">Get the metrics associated with the MergedShuffleFileManager. E.g., this is used to collect
 the push merged metrics within RemoteBlockPushResolver.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the map contains the metrics</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
