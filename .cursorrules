# Apache Spark Development Rules

## ðŸš¨ CRITICAL RULE: NEVER SKIP ANY CHECK ðŸš¨

**ABSOLUTE REQUIREMENT:**
- **NEVER skip any check** - If a tool is missing, install it first
- **NEVER assume a check will pass** - Always verify it passes
- **NEVER commit without running ALL applicable checks**
- **NEVER be lazy** - Run every check that CI will run

## CRITICAL: ALWAYS Run These Checks Before Committing/Pushing

**MANDATORY WORKFLOW - DO NOT SKIP:**

When working with Python code in Apache Spark, you **MUST** run these three linting checks **BEFORE** every commit:

1. **Black formatting**: 
   ```bash
   ./dev/lint-python --black
   # OR if black not found: python3 -m black --config dev/pyproject.toml <files>
   ```
   **MUST PASS** - Fix any formatting issues before proceeding

2. **Flake8**: 
   ```bash
   ./dev/lint-python --flake8
   # OR if flake8 not found: python3 -m flake8 --append-config dev/tox.ini --count --show-source --statistics .
   ```
   **MUST PASS** - Fix all style errors (F401, E501, W293, W391, etc.) before proceeding

3. **Mypy**: 
   ```bash
   ./dev/lint-python --mypy
   # OR if mypy not found: python3 -m mypy <files>
   ```
   **MUST PASS** - Fix all type errors before proceeding

## Installation

If flake8 or mypy are not installed, install them FIRST:
```bash
pip3 install flake8 mypy
```

## CRITICAL RULES - NEVER SKIP ANY CHECK

1. **NEVER skip ANY check** - If a tool is missing, install it first, then run the check
2. **NEVER commit without running ALL applicable checks** (black, flake8, mypy, license, packaging, scala, etc.)
3. **NEVER assume a check will pass** - Always verify it actually passes
4. **NEVER push code that fails local checks** - CI will fail, wasting everyone's time
5. **NEVER be lazy** - Run every check that CI will run, locally first
6. If `./dev/lint-python` skips a check due to missing tool, use `python3 -m <tool>` directly - DO NOT SKIP
7. If a check seems unnecessary, run it anyway - CI will run it, so you should too
8. **If you're unsure whether to run a check, RUN IT** - Better safe than sorry

## Pre-Commit Checklist (MANDATORY)

Before EVERY commit, verify ALL applicable checks:

### Python Files:
- [ ] `./dev/lint-python --black` passes (or `python3 -m black` if needed)
- [ ] `./dev/lint-python --flake8` passes (or `python3 -m flake8` if needed)  
- [ ] `./dev/lint-python --mypy` passes (or `python3 -m mypy` if needed)
- [ ] `./dev/check-license` passes (license headers check)
- [ ] Tests pass: `python/run-tests --testnames <test_module>`
- [ ] If packaging changed: `./dev/run-pip-tests` (verify pip install works)

### Scala Files:
- [ ] `./dev/scalastyle` passes (code style validation)
- [ ] `./dev/scalafmt` passes (code formatting)
- [ ] `./dev/lint-scala` passes (comprehensive lint checks)

### Java Files:
- [ ] `./dev/lint-java` or `./dev/sbt-checkstyle` passes

### All Files:
- [ ] `./dev/check-license` passes (Apache RAT license check)
- [ ] Only then: `git commit` and `git push`

## Common Flake8 Errors to Fix

- F401: Unused imports - Remove them
- E501: Line too long (>100 chars) - Split or add `# noqa: E501`
- W293: Blank line contains whitespace - Remove whitespace
- W391: Blank line at end of file - Add newline
- E402: Module level import not at top of file - Move imports

## Example Workflow

```bash
# 1. Make code changes
vim python/pyspark/sql/tests/streaming/test_file.py

# 2. Run ALL linting checks (MANDATORY)
./dev/lint-python --black
./dev/lint-python --flake8  
./dev/lint-python --mypy

# 3. If any fail, fix them and re-run

# 4. Run tests
python/run-tests --testnames pyspark.sql.tests.streaming.test_file

# 5. Only then commit
git add .
git commit -m "Fix: ..."
git push
```

## Remember - NEVER SKIP CHECKS

**ðŸš¨ CRITICAL: NEVER SKIP ANY CHECK ðŸš¨**

- If you don't run ALL checks before committing, CI will fail and waste everyone's time
- If a tool is missing, install it - DO NOT skip the check
- If a check seems redundant, run it anyway - CI will run it
- If you're being lazy and want to skip a check, DON'T - run it
- **When in doubt, RUN THE CHECK** - Better to spend 2 minutes locally than 40 minutes in CI

**The only acceptable reason to skip a check is if it's physically impossible to run (e.g., requires hardware you don't have). Otherwise, RUN IT.**

